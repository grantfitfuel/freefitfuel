<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nutrition – FreeFitFuel</title>

  <!-- Your global stylesheet with blue header + orange accent -->
  <link rel="stylesheet" href="style.css?v=30" />
  <link rel="icon" type="image/svg+xml" href="img/freefitfuel-logo.svg" />

  <!-- Page-specific CSS (SAFE: CSS lives in <style>, NOT inside <script>) -->
  <style>
    .hidden{display:none}
    .wrap{max-width:var(--maxw);margin:0 auto;padding:18px 20px}
    .lead{color:var(--inkdim)}

    /* hero uses your existing .hero-mini sizing from style.css */
    .hero-mini{position:relative;border-bottom:1px solid #1b1b22}
    .hero-mini figure{margin:0;position:relative}
    .hero-mini .overlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.45),rgba(0,0,0,.65))}
    .hero-mini .content{position:absolute;inset:auto 0 0 0;padding:16px 20px 22px;max-width:var(--maxw);margin:0 auto}
    .hero-mini h1{margin:0 0 .35rem}
    .hero-mini p{max-width:70ch;margin:.2rem 0 0;color:#d0d0da}

    /* Toolbar (goals + budget toggle) */
    .toolbar{display:flex;flex-wrap:wrap;gap:.6rem;align-items:center;margin:1rem 0 1.1rem}
    .seg{display:inline-flex;border:1px solid var(--stroke);border-radius:999px;overflow:hidden}
    .seg button{background:var(--glass);color:var(--ink);border:0;padding:.45rem .85rem;cursor:pointer}
    .seg button[aria-pressed="true"]{background:var(--accent);color:#111;font-weight:800}
    .pill{display:inline-flex;align-items:center;gap:.35rem;background:var(--glass);border:1px solid var(--stroke);border-radius:999px;padding:.35rem .65rem;font-size:.92rem}
    .pill input{accent-color:var(--accent)}

    /* Sections + Cards */
    .section{background:var(--glass);border:1px solid var(--stroke);border-radius:14px;margin:12px 0;padding:14px}
    .section>h2{margin:.15rem 0 .45rem;font-size:1.2rem}
    .note{font-size:.92rem;color:var(--inkdim)}

    .grid{display:grid;gap:12px}
    .cols-2{grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .cols-3{grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}

    /* Recipe cards */
    .card{background:var(--glass);border:1px solid var(--stroke);border-radius:12px;overflow:hidden}
    .card figure{height:160px;background:#111;margin:0}
    .card img{width:100%;height:100%;object-fit:cover;display:block}
    .card .body{padding:12px}
    .badge{display:inline-block;font-size:.78rem;padding:.18rem .5rem;border:1px solid var(--stroke);border-radius:999px;margin-right:6px;margin-bottom:6px}
    /* macro badges – readable + tidy */
    .macros{display:flex;gap:10px;flex-wrap:wrap;margin:.4rem 0 .2rem}
    .macros span{display:inline-block;padding:.2rem .5rem;border:1px solid var(--stroke);border-radius:999px;font-size:.9rem}

    /* Filters */
    .filters{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:.6rem}
    .filters .tag{border:1px solid var(--stroke);background:var(--glass);padding:.35rem .7rem;border-radius:999px;cursor:pointer}
    .filters .tag.active{background:var(--accent);color:#111;font-weight:700}

    /* Recipe dialog – SOLID background (fixes “transparent” unreadable issue) */
    dialog#recipeModal{
      background: rgba(20,20,26,0.96);
      color: var(--ink);
      border: 1px solid var(--stroke);
      border-radius: 14px;
      padding: 18px 20px;
      width: min(92vw, 760px);
    }
    dialog::backdrop{ background: rgba(0,0,0,.55); }
    #recipeModal h3{margin:.2rem 0}
    #recipeModal .meta{color:var(--inkdim);font-size:.95rem;margin:.2rem 0 .6rem}
    #recipeModal .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:flex-end;margin-top:.6rem}
    #recipeModal button{border:1px solid var(--stroke);background:var(--glass);color:var(--ink);padding:.4rem .7rem;border-radius:10px}

    /* Planner table */
    table{width:100%;border-collapse:separate;border-spacing:0;margin-top:.6rem;border:1px solid var(--stroke);border-radius:12px;overflow:hidden}
    thead th{background:rgba(255,255,255,.06);text-align:left;font-weight:700}
    th,td{padding:.6rem;border-bottom:1px solid var(--stroke);vertical-align:top}
    tr:last-child td{border-bottom:0}
    .slot{display:flex;flex-direction:column;gap:.35rem}
    .slot .item{display:flex;justify-content:space-between;align-items:center;gap:.6rem;
      background:rgba(255,255,255,.04);border:1px solid var(--stroke);padding:.35rem .5rem;border-radius:8px}
    .slot .item button{border:1px solid var(--stroke);background:var(--glass);color:var(--ink);padding:.2rem .45rem;border-radius:8px;cursor:pointer}

    /* Auto planner */
    .ap-plan-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .ap-day-col{background:var(--glass);border:1px solid var(--stroke);border-radius:10px;padding:10px}
    .ap-slot .row{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .ap-swap{border:1px solid var(--stroke);background:var(--glass);padding:.28rem .6rem;border-radius:999px;cursor:pointer}
    .ap-total{margin-top:.4rem;color:var(--inkdim);font-size:.95rem}
  </style>
</head>
<body>

  <!-- HEADER (uses your global style.css) -->
  <header class="site-header">
    <div class="container">
      <a href="index.html" class="logo"><img src="img/freefitfuel-logo.svg" alt="FreeFitFuel Logo" height="56"></a>
      <button class="hamburger" aria-label="Open menu" aria-controls="primary-nav" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>
      <nav id="primary-nav" class="main-nav" aria-label="Primary">
        <a href="index.html">Home</a>
        <a href="ideas.html">Ideas</a>
        <a href="guides.html">Guides</a>
        <a href="workouts.html">Workouts</a>
        <a href="endurance.html">Endurance</a>
        <a href="nutrition.html" aria-current="page">Nutrition</a>
        <a href="wellbeing.html">Wellbeing</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <!-- HERO (keeps your orange accent + hero image) -->
  <header class="hero-mini" role="banner" aria-label="Nutrition hero">
    <figure>
      <img src="img/nutrition-hero.jpg" alt="Budget-friendly, colourful whole foods on a table">
      <div class="overlay" aria-hidden="true"></div>
    </figure>
    <div class="content wrap">
      <h1><span class="accent">Fuel for real life</span></h1>
      <p>Goal-based macros, budget mode, a weekly planner that builds your shopping list, and a day log that tracks towards your targets.</p>
    </div>
  </header>

  <main class="wrap">
    <p class="lead">Pick a <strong>goal</strong>, calculate your <strong>targets</strong>, then add meals to the <strong>planner</strong> and <strong>daily log</strong>. Toggle <strong>Budget</strong> to favour low-cost options. All data saves on this device.</p>

    <!-- Controls -->
    <div class="toolbar" aria-label="Nutrition controls">
      <div class="seg" role="tablist" aria-label="Goal">
        <button role="tab" aria-pressed="true"  data-goal="maintain">Maintain</button>
        <button role="tab" aria-pressed="false" data-goal="cut">Cut</button>
        <button role="tab" aria-pressed="false" data-goal="build">Build</button>
        <button role="tab" aria-pressed="false" data-goal="transform">Transform</button>
      </div>
      <span class="pill"><input type="checkbox" id="budget"> <label for="budget">Budget mode</label></span>
    </div>

    <!-- Calculator -->
    <section class="section">
      <h2>Macro & Calorie Calculator</h2>
      <div class="grid cols-2">
        <div class="calc card" style="padding:12px">
          <div class="row">
            <label>Sex
              <select id="sex"><option value="female">Female</option><option value="male">Male</option></select>
            </label>
            <label>Age <input id="age" type="number" min="13" max="99" value="35"></label>
            <label>Height (cm) <input id="cm" type="number" min="120" max="220" value="175"></label>
            <label>Weight (kg) <input id="kg" type="number" min="35" max="250" value="75"></label>
            <label>Activity
              <select id="act">
                <option value="1.2">Sedentary</option>
                <option value="1.375">Light (1–3x/wk)</option>
                <option value="1.55" selected>Moderate (3–5x)</option>
                <option value="1.725">Active (6–7x)</option>
                <option value="1.9">Very active</option>
              </select>
            </label>
          </div>
          <div class="row">
            <label>Protein (g/kg) <input id="pkk" type="number" step="0.1" value="1.8"></label>
            <label>Carb bias
              <select id="carbBias">
                <option value="balanced" selected>Balanced</option>
                <option value="lowerCarb">Lower carb</option>
                <option value="higherCarb">Higher carb</option>
              </select>
            </label>
            <label><input type="checkbox" id="knowbf"> I know body fat %</label>
            <label id="bfWrap" class="hidden">Body fat % <input id="bf" type="number" min="3" max="60" step="0.5" value="20"></label>
          </div>
          <div class="row">
            <button class="btn" id="calcBtn">Calculate</button>
            <span id="calcNote" class="out">Uses Mifflin–St Jeor (or Katch–McArdle if body fat is provided), then adjusts by activity and goal.</span>
          </div>
        </div>
        <div class="results">
          <div class="kpi"><strong id="outGoal">Maintain</strong><span id="outCals">— kcal / day</span></div>
          <div class="kpi"><strong>Protein</strong><span id="outP">— g</span><div class="bar"><span id="barP"></span></div></div>
          <div class="kpi"><strong>Carbs</strong><span id="outC">— g</span><div class="bar"><span id="barC"></span></div></div>
          <div class="kpi"><strong>Fats</strong><span id="outF">— g</span><div class="bar"><span id="barF"></span></div></div>
          <div class="note">Fibre: aim ~25–35 g/day. Hydration helper below.</div>
        </div>
      </div>
    </section>

    <!-- Recipes -->
    <section class="section" id="recipes">
      <h2>Recipe Library</h2>
      <p id="recipeCount" class="note"></p>
      <div class="filters" id="recipeFilters" aria-label="Recipe filters">
        <button class="tag" data-tag="budget">Budget</button>
        <button class="tag" data-tag="high-protein">High-Protein</button>
        <button class="tag" data-tag="gluten-free">Gluten-Free</button>
        <button class="tag" data-tag="dairy-free">Dairy-Free</button>
        <button class="tag" data-tag="veg">Vegetarian</button>
        <button class="tag" data-tag="vegan">Vegan</button>
        <button class="tag" data-tag="quick">Quick (≤20m)</button>
        <button class="tag" data-tag="batch">Batch-cook</button>
        <button class="tag" data-tag="world">World cuisines</button>
        <button class="tag" data-tag="simple">Simple</button>
      </div>
      <button class="btn" id="pantryBtn">🧺 Pantry match</button>

      <div class="grid cols-3" id="recipeGrid"></div>
      <p class="note">Allergens are listed on every card (check labels for specific products & cross-contamination). Nutrition values are estimates.</p>
    </section>

    <!-- Weekly Planner (manual) -->
    <section class="section" id="planner">
      <h2>Weekly Meal Planner</h2>
      <p class="note">Tap “Add to Planner” on any recipe to place it in the week. Your plan saves on this device.</p>
      <div class="planner">
        <div class="controls" style="display:flex;gap:.5rem;flex-wrap:wrap">
          <button class="btn" id="clearPlan">Clear week</button>
          <button class="btn" id="printList">Print shopping list</button>
          <button class="btn" id="csvList">Download CSV</button>
        </div>
        <table>
          <thead>
            <tr><th>Day</th><th>Breakfast</th><th>Lunch</th><th>Dinner</th><th>Snacks</th></tr>
          </thead>
          <tbody id="planBody"></tbody>
        </table>
      </div>
    </section>

    <!-- Auto 7-Day Planner -->
    <section class="section" id="auto-planner">
      <h2>Auto 7-Day Meal Planner (smart)</h2>
      <p class="meta">Auto-plans to your kcal target. Click <em>Swap</em> to cycle alternatives in a slot.</p>
      <div class="ap-controls" style="display:flex;gap:.6rem;align-items:center;flex-wrap:wrap">
        <label>Daily kcal target <input id="ap-kcal" type="number" min="1200" max="4500" step="50" value="2200"></label>
        <button id="ap-generate" class="btn">Generate plan</button>
        <button id="ap-clear" class="btn" style="background:rgba(255,255,255,.1);color:var(--ink);border:1px solid var(--stroke)">Clear</button>
      </div>
      <div id="ap-grid" class="ap-plan-grid"></div>
    </section>

    <!-- Food Log -->
    <section class="section" id="foodlog">
      <h2>Daily Food Log</h2>
      <div class="log">
        <div class="row">
          <label>Date <input type="date" id="logDate"></label>
          <button class="btn" id="addCustom">＋ Custom item</button>
          <button class="btn" id="clearLog">Clear day</button>
          <button class="btn" id="exportLog">Export CSV</button>
        </div>
        <div id="logItems"></div>
        <div class="progress">
          <div class="line">
            <strong>Calories</strong>
            <div class="bar"><span id="pbCal"></span></div>
            <span id="txCal">0 / 0</span>
          </div>
          <div class="line">
            <strong>Protein</strong>
            <div class="bar"><span id="pbProt"></span></div>
            <span id="txProt">0 / 0</span>
          </div>
          <div class="line">
            <strong>Carbs</strong>
            <div class="bar"><span id="pbCarb"></span></div>
            <span id="txCarb">0 / 0</span>
          </div>
          <div class="line">
            <strong>Fats</strong>
            <div class="bar"><span id="pbFat"></span></div>
            <span id="txFat">0 / 0</span>
          </div>
        </div>
        <p class="note">Tip: log meals first, then tweak snacks to hit your targets.</p>
      </div>
    </section>

    <!-- Hydration & Fibre -->
    <section class="section">
      <h2>Hydration & Fibre</h2>
      <div class="grid cols-2">
        <article class="card" style="padding:.8rem">
          <h3>Hydration helper</h3>
          <div class="calc">
            <div class="row">
              <label>Body weight (kg) <input id="h-kg" type="number" min="35" max="250" value="75"></label>
              <label>Extra per hour training (ml) <input id="h-train" type="number" min="0" step="50" value="400"></label>
            </div>
            <div class="row">
              <button class="btn" id="h-calc">Calculate</button>
              <span class="out" id="h-out">— ml / day</span>
            </div>
          </div>
        </article>
        <article class="card" style="padding:.8rem">
          <h3>Fibre targets</h3>
          <p>Aim 25–35 g/day from foods. Increase gradually with fluids to avoid gut discomfort.</p>
          <ul><li>Oats/porridge, wholegrains</li><li>Beans/lentils/chickpeas</li><li>Fruit (berries), veg, nuts/seeds</li></ul>
        </article>
      </div>
    </section>

    <!-- Disclaimer -->
    <section class="section">
      <h2>Important Note</h2>
      <p>The content on FreeFitFuel is for general nutrition education only and isn’t a substitute for personalised medical advice.</p>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <img src="img/freefitfuel-logo.svg" alt="FreeFitFuel Logo" height="64">
      <p>© 2025 FreeFitFuel · All rights reserved.</p>
      <p class="credit">Created by Grant Cameron Anthony</p>
    </div>
  </footer>
    <!-- CORE JS (kept separate for stability) -->
  <script>
  /* ===== Header burger ===== */
  document.addEventListener('DOMContentLoaded', () => {
    const btn = document.querySelector('.hamburger');
    const nav = document.querySelector('.main-nav');
    if(btn && nav){
      btn.addEventListener('click', () => {
        const open = btn.classList.toggle('active');
        nav.classList.toggle('open', open);
        btn.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
    }
  });

  /* ===== State ===== */
  let goal = 'maintain';
  let budgetMode = false;
  let targets = {cal:0,p:0,c:0,f:0};
  let lastCalc = false;

  /* Goal buttons */
  document.querySelectorAll('[data-goal]').forEach(b=>{
    b.addEventListener('click', ()=>{
      document.querySelectorAll('[data-goal]').forEach(x=>x.setAttribute('aria-pressed','false'));
      b.setAttribute('aria-pressed','true');
      goal = b.dataset.goal;
      const og = document.getElementById('outGoal');
      if(og) og.textContent = goal[0].toUpperCase()+goal.slice(1);
      if(lastCalc){ doCalc(); updateLogBars(); }
    });
  });

  /* Budget toggle */
  const budgetEl = document.getElementById('budget');
  if(budgetEl){ budgetEl.addEventListener('change', e=>{ budgetMode = e.target.checked; }); }

  /* ===== Calculator ===== */
  const bfWrap = document.getElementById('bfWrap');
  const knowbf = document.getElementById('knowbf');
  if(knowbf){ knowbf.addEventListener('change', e=>{ if(bfWrap) bfWrap.classList.toggle('hidden', !e.target.checked); }); }

  function mifflin(kg, cm, age, sex){ return 10*kg + 6.25*cm - 5*age + (sex==='male'?5:-161); }
  function katch(kg, bfPerc){ const lbm = kg*(1-bfPerc/100); return 370 + 21.6*lbm; }
  function clampTargets(cals,bmr){ const floor=Math.round(bmr*1.2), ceil=Math.round(bmr+1000); return Math.max(floor, Math.min(ceil, Math.round(cals))); }
  function adjustForGoal(cals){ switch(goal){ case'cut':return cals*0.85; case'build':return cals*1.10; case'transform':return cals*0.95; default:return cals; } }
  function splitCarbFat(remain,bias){ let fatK=.5, carbK=.5; if(bias==='lowerCarb'){fatK=.6;carbK=.4} if(bias==='higherCarb'){fatK=.35;carbK=.65} return {fat:Math.round(remain*fatK/9), carb:Math.round(remain*carbK/4)}; }

  function doCalc(){
    const sex = document.getElementById('sex').value;
    const age = +document.getElementById('age').value||0;
    const cm  = +document.getElementById('cm').value||0;
    const kg  = +document.getElementById('kg').value||0;
    const act = +document.getElementById('act').value||1.55;
    const pkk = +document.getElementById('pkk').value||1.8;
    const bias= document.getElementById('carbBias').value;
    const know= (document.getElementById('knowbf')||{}).checked;
    const bf  = +document.getElementById('bf').value||20;

    const bmr = know ? katch(kg,bf) : mifflin(kg,cm,age,sex);
    const tdee = bmr * act;
    const pre  = adjustForGoal(tdee);
    const cal  = clampTargets(pre, bmr);

    const p = Math.round(kg * pkk);
    const pCals = p*4;
    const remain = Math.max(0, cal - pCals);
    const {fat:f, carb:c} = splitCarbFat(remain, bias);

    targets = {cal:Math.round(cal), p, c, f};
    lastCalc = true;
    localStorage.setItem('fff-targets', JSON.stringify({goal,targets}));

    const oc=document.getElementById('outCals'),
          op=document.getElementById('outP'),
          ocb=document.getElementById('outC'),
          of=document.getElementById('outF');
    if(oc) oc.textContent = targets.cal+' kcal / day';
    if(op) op.textContent = targets.p+' g';
    if(ocb) ocb.textContent = targets.c+' g';
    if(of) of.textContent = targets.f+' g';
    setBar('barP',100); setBar('barC',100); setBar('barF',100);
    updateLogBars();
  }
  const calcBtn = document.getElementById('calcBtn'); if(calcBtn) calcBtn.addEventListener('click', doCalc);

  /* Hydration helper */
  const hCalc = document.getElementById('h-calc');
  if(hCalc){
    hCalc.addEventListener('click', ()=>{
      const kg = +document.getElementById('h-kg').value||0;
      const extra = +document.getElementById('h-train').value||0;
      const base = kg * 32; // midpoint 30–35 ml/kg
      document.getElementById('h-out').textContent = Math.round(base + extra)+' ml / day';
    });
  }

  /* ===== Utilities ===== */
  function pct(a,b){ return b? Math.max(0, Math.min(100, Math.round(100*a/b))) : 0; }
  function setBar(id, v){ const el=document.getElementById(id); if(el) el.style.width = v+'%'; }

  /* ===== Budget swaps ===== */
  const budgetSwaps = {
    'greek yoghurt':'plain yoghurt',
    'mixed seeds':'sunflower seeds',
    'frozen berries':'seasonal fruit',
    'tuna':'mackerel (tinned)',
    'chicken thigh':'chicken drumsticks or beans',
    'beef mince':'turkey mince or lentils',
    'parmesan':'cheddar',
    'pesto':'olive oil + herbs',
    'rice':'oats or potatoes'
  };

  /* ===== Recipes store ===== */
  window.RECIPES = window.RECIPES || []; // do NOT overwrite if you already loaded them

  /* Recipe card HTML */
  function recipeCard(r){
    const tags = (r.tags||[]).map(t=>`<span class="badge">${t}</span>`).join(' ');
    const m = r.macros || {kcal:'—',p:'—',c:'—',f:'—'};
    const allerg = (r.allergens && r.allergens.length)
      ? `Allergens: ${r.allergens.join(', ')} (check labels)`
      : 'Allergens: none listed (check labels)';
    const imgHTML = r.img ? `<figure><img src="${r.img}" alt="${r.name}" loading="lazy" onerror="this.style.display='none'"></figure>` : '<figure></figure>';
    return `
    <article class="card" data-tags="${(r.tags||[]).join(',')}">
      ${imgHTML}
      <div class="body">
        <h3>${r.name}</h3>
        <div>${tags} <span class="badge">${r.cuisine||''}</span></div>
        <div class="macros">
          <span>⚡ ${m.kcal} kcal</span>
          <span>🥩 ${m.p} g</span>
          <span>🍚 ${m.c} g</span>
          <span>🫒 ${m.f} g</span>
        </div>
        <div class="allergens">${allerg}</div>
        <div class="actions" style="display:flex;gap:.5rem;flex-wrap:wrap">
          <button class="btn" data-planner="${r.k}">Add to Planner</button>
          <button class="btn" data-log="${r.k}">Log 1 Serving</button>
          <button class="btn" data-view="${r.k}">Open Recipe Card</button>
          <button class="btn" data-print="${r.k}">Print Recipe Card</button>
        </div>
      </div>
    </article>`;
  }

  /* Render recipes + count */
  function renderRecipes(){
    const grid = document.getElementById('recipeGrid');
    const active = [...document.querySelectorAll('.filters .tag.active')].map(x=>x.dataset.tag);
    const list = (window.RECIPES||[]).filter(r => active.length===0 || active.every(t=>r.tags.includes(t)));
    grid.innerHTML = list.map(recipeCard).join('');

    // count
    const rc = document.getElementById('recipeCount');
    if(rc) rc.textContent = `Showing ${list.length} of ${window.RECIPES.length} recipes`;

    // wire buttons
    grid.querySelectorAll('[data-planner]').forEach(b=>b.addEventListener('click', ()=> addToPlanner(b.getAttribute('data-planner')) ));
    grid.querySelectorAll('[data-log]').forEach(b=>b.addEventListener('click', ()=> logRecipeServing(b.getAttribute('data-log'), 1) ));
    grid.querySelectorAll('[data-view]').forEach(b=>b.addEventListener('click', ()=> openRecipeCard(b.getAttribute('data-view')) ));
    grid.querySelectorAll('[data-print]').forEach(b=>b.addEventListener('click', ()=> printRecipe(b.getAttribute('data-print')) ));
  }

  /* Filters */
  const filtersWrap = document.getElementById('recipeFilters');
  if(filtersWrap){
    filtersWrap.addEventListener('click', e=>{
      if(!e.target.classList.contains('tag')) return;
      e.target.classList.toggle('active');
      renderRecipes();
    });
    filtersWrap.addEventListener('keydown', e=>{
      if(e.key==='Enter' && e.target.classList.contains('tag')) e.target.click();
    });
  }

  /* Pantry match (uses adds + ingredients text) */
  const pantryBtn = document.getElementById('pantryBtn');
  function pantryMatch(){
    const raw = prompt('Type ingredients you have (comma-separated):\nExample: rice, chickpeas, tomatoes, onion, eggs');
    if(!raw) return;
    const have = raw.toLowerCase().split(',').map(s=>s.trim()).filter(Boolean);
    const score = (r)=>{
      const list = (r.adds||[]).concat((r.ingredients||[]).map(i=>i.item));
      let hit = 0;
      list.forEach(item=>{
        const it = String(item).toLowerCase();
        if(have.some(h => it.includes(h))) hit++;
      });
      return hit;
    };
    const ranked = (window.RECIPES||[]).map(r=>({r, s:score(r)})).filter(x=>x.s>0).sort((a,b)=>b.s-a.s).slice(0,18).map(x=>x.r);
    const grid = document.getElementById('recipeGrid');
    grid.innerHTML = ranked.length ? ranked.map(recipeCard).join('') : '<p class="note">No strong matches. Try broader ingredients (e.g., "beans", "rice", "eggs").</p>';
    if(ranked.length){
      grid.querySelectorAll('[data-planner]').forEach(b=>b.addEventListener('click', ()=> addToPlanner(b.getAttribute('data-planner')) ));
      grid.querySelectorAll('[data-log]').forEach(b=>b.addEventListener('click', ()=> logRecipeServing(b.getAttribute('data-log'), 1) ));
      grid.querySelectorAll('[data-view]').forEach(b=>b.addEventListener('click', ()=> openRecipeCard(b.getAttribute('data-view')) ));
      grid.querySelectorAll('[data-print]').forEach(b=>b.addEventListener('click', ()=> printRecipe(b.getAttribute('data-print')) ));
    }
  }
  if(pantryBtn){ pantryBtn.addEventListener('click', pantryMatch); }

  /* In-page Recipe Card dialog */
  function openRecipeCard(k){
    const r = (window.RECIPES||[]).find(x=>x.k===k); if(!r) return;
    let dlg = document.getElementById('recipeModal');
    if(!dlg){
      dlg = document.createElement('dialog');
      dlg.id = 'recipeModal';
      dlg.innerHTML = `
        <h3 id="rm-title"></h3>
        <div id="rm-meta" class="meta"></div>
        <h4>Ingredients</h4>
        <ul id="rm-ing"></ul>
        <h4>Method</h4>
        <ol id="rm-steps"></ol>
        <p id="rm-share" class="meta"></p>
        <div class="row">
          <button id="rm-copy">Copy link</button>
          <button id="rm-print">Print</button>
          <button id="rm-close">Close</button>
        </div>`;
      document.body.appendChild(dlg);
    }
    const s = r.servings || 1;
    const fmt = v => (typeof v!=='number') ? v : ((Math.round(v*10)/10).toString());
    document.getElementById('rm-title').textContent = r.name;
    document.getElementById('rm-meta').innerHTML =
      `<strong>Cuisine:</strong> ${r.cuisine||''} · <strong>Base servings:</strong> ${s}<br>
       <strong>Macros per serving:</strong> Calories ${r.macros.kcal} — Protein ${r.macros.p} g / Carbohydrates ${r.macros.c} g / Fats ${r.macros.f} g<br>
       <strong>Allergens:</strong> ${(r.allergens&&r.allergens.length)?r.allergens.join(', '):'none listed'} (check labels)`;
    const ul = document.getElementById('rm-ing');
    ul.innerHTML = (r.ingredients||[]).map(it=>`<li>${fmt(it.qty)} ${it.unit} ${it.item}</li>`).join('');
    const ol = document.getElementById('rm-steps');
    ol.innerHTML = (r.steps||[]).map(step=>`<li>${step}</li>`).join('');
    const share = document.getElementById('rm-share');
    const url = new URL(location.href); url.searchParams.set('recipe', r.k);
    share.textContent = 'Card link: ' + url.toString();
    document.getElementById('rm-close').onclick = ()=> dlg.close();
    document.getElementById('rm-print').onclick = ()=> window.print();
    document.getElementById('rm-copy').onclick = async ()=>{
      try{ await navigator.clipboard.writeText(url.toString()); alert('Link copied'); }
      catch(e){ alert('Copy failed'); }
    };
    if(typeof dlg.showModal === 'function'){ dlg.showModal(); }
    else { dlg.setAttribute('open',''); } // iPad fallback
  }

  /* Print recipe (scaled servings) */
  function printRecipe(k){
    const r = (window.RECIPES||[]).find(x=>x.k===k); if(!r) return;
    const s = +prompt('Servings for print (default '+(r.servings||1)+'):', r.servings||1) || (r.servings||1);
    const scale = s / (r.servings||1);
    const fmtQty = v => { if(typeof v!=='number') return v; const n=Math.round(v*10)/10; return (n%1===0)? n.toString(): n.toFixed(1); };
    let adds = r.adds || [];
    if(budgetMode){
      adds = adds.map(x=>{
        const key = Object.keys(budgetSwaps).find(k=>x.toLowerCase().includes(k));
        return key ? (budgetSwaps[key] + ' (swap)') : x;
      });
    }
    const win = window.open('','PRINT','width=760,height=940'); if(!win) return;
    win.document.write(`
      <h2>${r.name}</h2>
      <p><strong>Cuisine:</strong> ${r.cuisine||''} · <strong>Servings:</strong> ${s}</p>
      <p><strong>Macros per serving (base):</strong> ${r.macros.kcal} kcal — ${r.macros.p}P / ${r.macros.c}C / ${r.macros.f}F</p>
      <p><strong>Allergens:</strong> ${(r.allergens&&r.allergens.length)?r.allergens.join(', '):'none listed'} (check labels & cross-contamination)</p>
      <h3>Ingredients</h3>
      <ul>${(r.ingredients||[]).map(it=>`<li>${fmtQty(it.qty*scale)} ${it.unit} ${it.item}</li>`).join('')}</ul>
      <h3>Method</h3>
      <ol>${(r.steps||[]).map(s=>`<li>${s}</li>`).join('')}</ol>
      <h3>Shopping Items</h3>
      <ul>${(adds||[]).map(a=>`<li>${a}</li>`).join('')}</ul>
      <hr><p style="font-size:0.9rem;color:#555">Nutrition values are estimates. Check labels for allergens.</p>
    `);
    win.document.close(); win.focus(); win.print();
  }

  /* ===== Weekly Planner (manual) ===== */
  const WEEKDAYS = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
  const MEALS = ['Breakfast','Lunch','Dinner','Snacks'];
  const planKey = 'fff-plan-week';

  function loadPlan(){
    try{ const raw = localStorage.getItem(planKey); if(raw) return JSON.parse(raw); }catch(e){}
    const blank = {}; WEEKDAYS.forEach(d=>{ blank[d]={}; MEALS.forEach(m=>blank[d][m]=[]); }); return blank;
  }
  function savePlan(p){ localStorage.setItem(planKey, JSON.stringify(p)); }

  function renderPlanner(){
    const body = document.getElementById('planBody');
    const plan = loadPlan();
    body.innerHTML = WEEKDAYS.map(d=>{
      const tds = MEALS.map(m=>{
        const items = plan[d][m]||[];
        const html = items.map((it,idx)=>`
          <div class="item"><span>${it.name}</span>
            <button title="Remove" data-del="${d}|${m}|${idx}">×</button>
          </div>`).join('');
        return `<td><div class="slot">${html}</div></td>`;
      }).join('');
      return `<tr><th>${d}</th>${tds}</tr>`;
    }).join('');
    body.querySelectorAll('[data-del]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const [dd,mm,i] = btn.getAttribute('data-del').split('|');
        const plan = loadPlan();
        plan[dd][mm].splice(+i,1);
        savePlan(plan); renderPlanner();
      });
    });
  }

  function addToPlanner(k){
    const r = (window.RECIPES||[]).find(x=>x.k===k); if(!r) return;
    const day = prompt('Add to which day? (Mon/Tue/Wed/Thu/Fri/Sat/Sun)','Mon');
    if(!WEEKDAYS.includes(day)) return;
    const meal = prompt('Meal slot? (Breakfast/Lunch/Dinner/Snacks)','Dinner');
    if(!MEALS.includes(meal)) return;
    const plan = loadPlan(); plan[day][meal].push({ref:r.k, name:r.name});
    savePlan(plan); renderPlanner();
  }

  const clearPlanBtn = document.getElementById('clearPlan');
  if(clearPlanBtn){ clearPlanBtn.addEventListener('click', ()=>{ if(confirm('Clear the whole week?')){ localStorage.removeItem(planKey); renderPlanner(); } }); }

  /* Shopping list */
  function aggregateList(){
    const plan = loadPlan(); const items = [];
    WEEKDAYS.forEach(d=>MEALS.forEach(m=>{
      (plan[d][m]||[]).forEach(it=>{
        const r = (window.RECIPES||[]).find(x=>x.k===it.ref); if(!r) return;
        let adds = [...(r.adds||[])];
        if(budgetMode){
          adds = adds.map(x=>{
            const key = Object.keys(budgetSwaps).find(k=>x.toLowerCase().includes(k));
            return key ? (budgetSwaps[key] + ' (swap)') : x;
          });
        }
        items.push(...adds);
      });
    }));
    return [...new Set(items.map(s=>s.toLowerCase()))];
  }
  const printListBtn = document.getElementById('printList');
  if(printListBtn){ printListBtn.addEventListener('click', ()=>{
    const items = aggregateList();
    const w = window.open('','PRINT','width=600,height=700');
    if(!w) return;
    w.document.write('<h3>Shopping List</h3><ul>'+items.map(i=>'<li>'+i+'</li>').join('')+'</ul>');
    w.document.close(); w.focus(); w.print();
  });}
  const csvListBtn = document.getElementById('csvList');
  if(csvListBtn){ csvListBtn.addEventListener('click', ()=>{
    const items = aggregateList();
    const csv = 'item\n' + items.map(x=>'"'+x.replace(/"/g,'""')+'"').join('\n');
    const blob = new Blob([csv], {type:'text/csv'}); const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download='shopping-list.csv'; a.click(); URL.revokeObjectURL(url);
  });}

  /* ===== Food Log ===== */
  const logKey = 'fff-foodlog';
  const dateInput = document.getElementById('logDate');
  if(dateInput){ dateInput.valueAsNumber = Date.now() - (new Date()).getTimezoneOffset()*60000; }

  function getLogStore(){ try{ const raw=localStorage.getItem(logKey); if(raw) return JSON.parse(raw); }catch(e){} return {}; }
  function saveLogStore(s){ localStorage.setItem(logKey, JSON.stringify(s)); }
  function logFor(ds){ const s=getLogStore(); return s[ds] || {items:[]}; }
  function saveLog(ds,data){ const s=getLogStore(); s[ds]=data; saveLogStore(s); }
  function sumDay(ds){ const data = logFor(ds); return data.items.reduce((a,x)=>({kcal:a.kcal+x.kcal,p:a.p+x.p,c:a.c+x.c,f:a.f+x.f}),{kcal:0,p:0,c:0,f:0}); }

  function renderLog(){
    if(!dateInput) return;
    const ds = dateInput.value || new Date().toISOString().slice(0,10);
    const data = logFor(ds);
    const box = document.getElementById('logItems'); if(!box) return;
    if(!data.items.length){
      box.innerHTML='<p class="note">No items logged yet. Use “Log 1 Serving” on a recipe or add a custom item.</p>';
      updateLogBars(); return;
    }
    box.innerHTML = data.items.map((it,i)=>`
      <div class="slot item">
        <div><strong>${it.name}</strong> — ${it.kcal} kcal · ${it.p}P / ${it.c}C / ${it.f}F</div>
        <button title="Remove" data-del="${i}">×</button>
      </div>`).join('');
    box.querySelectorAll('[data-del]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const ds2 = dateInput.value || new Date().toISOString().slice(0,10);
        const idx = +btn.getAttribute('data-del');
        const data2 = logFor(ds2);
        data2.items.splice(idx,1); saveLog(ds2,data2); renderLog(); updateLogBars();
      });
    });
  }
  function updateLogBars(){
    const ds = (dateInput && dateInput.value) || new Date().toISOString().slice(0,10);
    const t = targets || {cal:0,p:0,c:0,f:0};
    const s = sumDay(ds);
    const setTx = (id,txt)=>{ const el=document.getElementById(id); if(el) el.textContent = txt; };
    setTx('txCal',  `${s.kcal} / ${t.cal||0}`);
    setTx('txProt', `${s.p} / ${t.p||0}g`);
    setTx('txCarb', `${s.c} / ${t.c||0}g`);
    setTx('txFat',  `${s.f} / ${t.f||0}g`);
    setBar('pbCal',  pct(s.kcal, t.cal||0));
    setBar('pbProt', pct(s.p,   t.p||0));
    setBar('pbCarb', pct(s.c,   t.c||0));
    setBar('pbFat',  pct(s.f,   t.f||0));
  }
  const addBtn = document.getElementById('addCustom');
  if(addBtn){ addBtn.addEventListener('click', ()=>{
    const name = prompt('Food name (e.g., Apple 150 g or “Custom shake”)','Custom item'); if(!name) return;
    const kcal = +prompt('Calories (kcal per entry):','150')||0;
    const p = +prompt('Protein (g):','10')||0;
    const c = +prompt('Carbohydrates (g):','25')||0;
    const f = +prompt('Fats (g):','5')||0;
    const ds = (dateInput && dateInput.value) || new Date().toISOString().slice(0,10);
    const data = logFor(ds);
    data.items.push({type:'custom', name, servings:1, kcal, p, c, f});
    saveLog(ds, data); renderLog(); updateLogBars();
  });}
  const clrBtn = document.getElementById('clearLog');
  if(clrBtn){ clrBtn.addEventListener('click', ()=>{
    const ds = (dateInput && dateInput.value) || new Date().toISOString().slice(0,10);
    if(confirm('Clear all logged items for '+ds+'?')){ saveLog(ds,{items:[]}); renderLog(); updateLogBars(); }
  });}
  const expBtn = document.getElementById('exportLog');
  if(expBtn){ expBtn.addEventListener('click', ()=>{
    const ds = (dateInput && dateInput.value) || new Date().toISOString().slice(0,10);
    const data = logFor(ds);
    const csv = 'name,servings,calories,protein,carbohydrates,fats\n' + data.items.map(it=>
      [it.name,it.servings,it.kcal,it.p,it.c,it.f].map(v=>'"'+String(v).replace(/"/g,'""')+'"').join(',')
    ).join('\n');
    const blob = new Blob([csv], {type:'text/csv'}); const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download='foodlog-'+ds+'.csv'; a.click(); URL.revokeObjectURL(url);
  });}
  if(dateInput){ dateInput.addEventListener('change', ()=>{ renderLog(); updateLogBars(); }); }
  </script>
    <!-- AUTO PLANNER + BOOT -->
  <script>
  /* ===== Auto Planner (no duplicate lunches across the week) ===== */
  function apGuessCategory(r){
    const nm = (r.name||'').toLowerCase();
    const has = s => nm.includes(s);
    if (has('oat') || has('yoghurt') || has('parfait') || (has('egg') && !has('shakshuka'))) return 'breakfast';
    if (has('wrap') || has('sandwich') || ((has('salad') || has('bowl')) && !has('rice & chicken'))) return 'lunch';
    if (has('banana ice') || has('parfait') || has('chia') || has('bar')) return 'snack';
    return 'dinner';
  }
  function apPoolBy(cat){ return (window.RECIPES||[]).filter(r => apGuessCategory(r)===cat); }
  function apKcal(r){ return r?.macros?.kcal || 400; }
  function shuffle(arr){ const a=arr.slice(); for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
  function takeWithoutReplacement(pool, count){ const bag=shuffle(pool), out=[]; let idx=0; for(let i=0;i<count;i++){ if(!bag.length){ bag.push(...shuffle(pool)); } out.push(bag[idx % bag.length]); idx++; } return out; }

  function apBuildWeek(kcalTarget){
    const shares = {breakfast:.25, lunch:.30, dinner:.35, snack:.10};
    const cats   = ['breakfast','lunch','dinner','snack'];

    const poolBy = {};
    cats.forEach(cat=>{
      const pool = apPoolBy(cat);
      const want = kcalTarget * shares[cat];
      poolBy[cat] = pool.slice().sort((a,b)=>Math.abs(apKcal(a)-want)-Math.abs(apKcal(b)-want));
    });

    // unique picks per category where possible
    const picks = {};
    cats.forEach(cat=>{
      const base = poolBy[cat];
      if (base.length >= 7) {
        const seen = new Set(), out=[];
        for (let i=0,j=0; out.length<7 && j<base.length*3; j++){
          const r = base[(i+j)%base.length];
          if(!seen.has(r.k)){ seen.add(r.k); out.push(r); }
        }
        picks[cat] = out;
      } else {
        picks[cat] = takeWithoutReplacement(base, 7);
      }
    });

    const week = [];
    for(let d=0; d<7; d++){
      const day = {breakfast:null,lunch:null,dinner:null,snack:null,total:0};
      cats.forEach(cat=>{
        let choice = picks[cat][d % picks[cat].length];
        // avoid same as previous day in same slot when alternatives exist
        if(d>0 && week[d-1][cat] && choice.k === week[d-1][cat].k && poolBy[cat].length > 1){
          for(let s=1; s<poolBy[cat].length; s++){
            const alt = poolBy[cat][(d+s) % poolBy[cat].length];
            if(alt.k !== week[d-1][cat].k){ choice = alt; break; }
          }
        }
        day[cat] = choice;
      });
      day.total = ['breakfast','lunch','dinner','snack'].reduce((a,k)=>a+(day[k]?apKcal(day[k]):0),0);
      week.push(day);
    }
    return week;
  }

  /* State & storage for Auto Planner */
  const AP_KEY = 'fff-aplan-v1';
  let AP_PLAN = loadAP() || Array.from({length:7},()=>({breakfast:null,lunch:null,dinner:null,snack:null,total:0}));
  function saveAP(){ localStorage.setItem(AP_KEY, JSON.stringify(AP_PLAN)); }
  function loadAP(){ try{ return JSON.parse(localStorage.getItem(AP_KEY)||'null'); }catch(e){ return null; } }

  /* Render Auto Planner */
  const apGrid = document.getElementById('ap-grid');
  function apDayTotal(day){ return ['breakfast','lunch','dinner','snack'].reduce((a,k)=> a + (day[k]?apKcal(day[k]):0),0); }
  function apSlotHTML(rec,cat,dayIndex){
    if(!rec){
      const nice = cat[0].toUpperCase()+cat.slice(1);
      return `<div class="ap-slot" data-day="${dayIndex}" data-cat="${cat}">
        <div class="row"><span class="name">${nice}</span><button class="ap-swap" data-swap>Swap</button></div>
        <div class="cal">—</div>
      </div>`;
    }
    return `<div class="ap-slot" data-day="${dayIndex}" data-cat="${cat}">
      <div class="row"><span class="name">${rec.name}</span><button class="ap-swap" data-swap>Swap</button></div>
      <div class="cal">${apKcal(rec)} kcal</div>
    </div>`;
  }
  function apHookSwaps(){
    apGrid.querySelectorAll('[data-swap]').forEach(btn=>{
      btn.onclick = ()=>{
        const slot = btn.closest('.ap-slot');
        const day = parseInt(slot.dataset.day,10);
        const cat = slot.dataset.cat;
        const pool = apPoolBy(cat); if(!pool.length) return;
        const current = AP_PLAN[day][cat];
        let i = current ? pool.findIndex(r=>r.k===current.k) : -1;
        for(let j=1;j<=pool.length;j++){
          const cand = pool[(i+j)%pool.length];
          if(!current || cand.k !== current.k){ AP_PLAN[day][cat] = cand; break; }
        }
        AP_PLAN[day].total = apDayTotal(AP_PLAN[day]);
        saveAP(); apRender();
      };
    });
  }
  function apRender(){
    apGrid.innerHTML = '';
    const days = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
    days.forEach((d,dayIdx)=>{
      const day = AP_PLAN[dayIdx] || {};
      const col = document.createElement('div');
      col.className = 'ap-day-col';
      col.innerHTML = `
        <h3>${d}</h3>
        ${apSlotHTML(day.breakfast,'breakfast',dayIdx)}
        ${apSlotHTML(day.lunch,'lunch',dayIdx)}
        ${apSlotHTML(day.dinner,'dinner',dayIdx)}
        ${apSlotHTML(day.snack,'snack',dayIdx)}
        <div class="ap-total">≈ ${Math.round(apDayTotal(day))} kcal</div>
      `;
      apGrid.appendChild(col);
    });
    apHookSwaps();
  }

  const apGen = document.getElementById('ap-generate');
  if(apGen){ apGen.addEventListener('click', ()=>{
    const kcal = +document.getElementById('ap-kcal').value || 2200;
    AP_PLAN = Array.from({length:7}, (_,i)=> apBuildWeek(kcal)[i] );
    saveAP(); apRender();
  });}
  const apClear = document.getElementById('ap-clear');
  if(apClear){ apClear.addEventListener('click', ()=>{
    if(!confirm('Clear auto-plan for the whole week?')) return;
    AP_PLAN = Array.from({length:7},()=>({breakfast:null,lunch:null,dinner:null,snack:null,total:0}));
    saveAP(); apRender();
  });}

  /* ===== Boot ===== */
  (function boot(){
    try{
      const saved = JSON.parse(localStorage.getItem('fff-targets')||'null');
      if(saved && saved.targets){
        goal = saved.goal || goal;
        targets = saved.targets;
        document.querySelectorAll('[data-goal]').forEach(x=>{
          x.setAttribute('aria-pressed', x.dataset.goal===goal ? 'true':'false');
        });
        const og=document.getElementById('outGoal'),
              oc=document.getElementById('outCals'),
              op=document.getElementById('outP'),
              ocb=document.getElementById('outC'),
              of=document.getElementById('outF');
        if(og) og.textContent = goal[0].toUpperCase()+goal.slice(1);
        if(oc) oc.textContent = targets.cal+' kcal / day';
        if(op) op.textContent = targets.p+' g';
        if(ocb) oc.textContent = targets.c+' g';
        if(of) of.textContent = targets.f+' g';
        lastCalc=true;
      }
    }catch(e){}
    // open ?recipe=... if present
    const rid = new URL(location.href).searchParams.get('recipe');
    if(rid){ openRecipeCard(rid); }
    renderRecipes();
    renderPlanner();
    renderLog();
    updateLogBars();
    apRender();
  })();
      <!-- === Fix Pack: seed recipes + All filter (place just above </script> of Block 2) === -->
  <script>
  // 1) Seed a few recipes ONLY if none exist on this page
  (function seedRecipesIfEmpty(){
    if (!Array.isArray(window.RECIPES)) window.RECIPES = [];
    if (window.RECIPES.length) return; // already populated elsewhere

    window.RECIPES = [
      // Breakfast
      {k:'oo-blueberry', name:'Overnight Oats – Blueberry', cuisine:'UK',
        tags:['veg','quick','simple','high-fibre','breakfast'], allergens:['gluten (oats*)','dairy*'],
        img:'', servings:1, macros:{kcal:420,p:22,c:55,f:12},
        adds:['oats','milk or alt','yoghurt','blueberries','chia'],
        ingredients:[{qty:60,unit:'g',item:'oats'},{qty:150,unit:'ml',item:'milk or alt'},{qty:80,unit:'g',item:'yoghurt'},{qty:80,unit:'g',item:'blueberries'},{qty:8,unit:'g',item:'chia seeds'}],
        steps:['Mix everything in a jar.','Chill overnight.']},

      {k:'yog-berry', name:'Greek Yoghurt, Berries & Nuts', cuisine:'Mediterranean',
        tags:['high-protein','quick','simple','breakfast'], allergens:['dairy','tree nuts'],
        img:'', servings:1, macros:{kcal:360,p:30,c:32,f:12},
        adds:['greek yoghurt','berries','nuts','honey'],
        ingredients:[{qty:200,unit:'g',item:'greek yoghurt'},{qty:100,unit:'g',item:'mixed berries'},{qty:15,unit:'g',item:'mixed nuts'},{qty:1,unit:'tsp',item:'honey (optional)'}],
        steps:['Bowl yoghurt; top with berries and nuts.']},

      // Lunch
      {k:'wrap-chicken-hummus', name:'Chicken & Hummus Wrap', cuisine:'Global',
        tags:['high-protein','quick','simple','lunch'], allergens:['gluten (wrap)','sesame'],
        img:'', servings:1, macros:{kcal:520,p:35,c:50,f:18},
        adds:['wrap','chicken','hummus','lettuce','tomato'],
        ingredients:[{qty:1,unit:'',item:'wrap'},{qty:120,unit:'g',item:'cooked chicken'},{qty:40,unit:'g',item:'hummus'},{qty:2,unit:'leaves',item:'lettuce'},{qty:2,unit:'slices',item:'tomato'}],
        steps:['Spread hummus; add chicken & veg; roll.']},

      {k:'greek-salad-beans', name:'Greek Salad + Beans', cuisine:'Greek',
        tags:['veg','gluten-free','quick','simple','world','lunch'], allergens:['dairy'],
        img:'', servings:2, macros:{kcal:420,p:18,c:30,f:24},
        adds:['tomatoes','cucumber','olives','feta','mixed beans'],
        ingredients:[{qty:3,unit:'',item:'tomatoes'},{qty:1,unit:'',item:'cucumber'},{qty:60,unit:'g',item:'olives'},{qty:80,unit:'g',item:'feta'},{qty:1,unit:'tin',item:'mixed beans (drained)'}],
        steps:['Chop veg; toss with beans & olives; add feta.']},

      // Dinner
      {k:'thai-green-tofu', name:'Thai Green Curry (Tofu/Chicken)', cuisine:'Thai',
        tags:['world','gluten-free','dinner'], allergens:['soy*','fish*'],
        img:'', servings:4, macros:{kcal:520,p:32,c:55,f:18},
        adds:['green curry paste','coconut milk','tofu/chicken','mixed veg','rice'],
        ingredients:[{qty:2,unit:'tbsp',item:'green curry paste'},{qty:1,unit:'tin',item:'coconut milk'},{qty:400,unit:'g',item:'firm tofu or chicken'},{qty:400,unit:'g',item:'mixed veg'},{qty:600,unit:'g',item:'cooked rice'}],
        steps:['Fry paste; add protein & veg; add coconut milk; simmer 10m.']},

      {k:'chilli-turkey', name:'Turkey (or Bean) Chilli', cuisine:'US',
        tags:['high-protein','batch','gluten-free','world','dinner'], allergens:[],
        img:'', servings:4, macros:{kcal:540,p:40,c:55,f:14},
        adds:['turkey mince or beans','kidney beans','tomatoes','spices','onion'],
        ingredients:[{qty:500,unit:'g',item:'turkey mince (or 2 tins beans)'},{qty:1,unit:'tin',item:'kidney beans'},{qty:1,unit:'tin',item:'tomatoes'},{qty:1,unit:'',item:'onion (diced)'},{qty:2,unit:'tsp',item:'chilli powder'}],
        steps:['Brown mince with onion; add tomatoes/beans/spices; simmer 20m.']},

      // Snack
      {k:'protein-smoothie', name:'Green Protein Smoothie', cuisine:'Global',
        tags:['quick','high-protein','gluten-free','simple','snack'], allergens:['dairy*'],
        img:'', servings:1, macros:{kcal:330,p:30,c:40,f:6},
        adds:['protein powder','spinach','frozen mango','yoghurt or alt','water'],
        ingredients:[{qty:25,unit:'g',item:'protein powder'},{qty:1,unit:'handful',item:'spinach'},{qty:150,unit:'g',item:'frozen mango'},{qty:100,unit:'g',item:'yoghurt (or alt)'},{qty:150,unit:'ml',item:'water'}],
        steps:['Blend until smooth.']},

      {k:'nuts-berries', name:'Nuts & Berries Pot', cuisine:'UK',
        tags:['simple','quick','snack','high-fibre'], allergens:['tree nuts'],
        img:'', servings:1, macros:{kcal:250,p:6,c:20,f:18},
        adds:['mixed nuts','berries'],
        ingredients:[{qty:25,unit:'g',item:'mixed nuts'},{qty:100,unit:'g',item:'berries'}],
        steps:['Combine in a bowl or tub.']}
    ];
  })();

  // 2) Add an “All” filter that clears every tag and shows everything
  (function ensureAllFilter(){
    const f = document.getElementById('recipeFilters');
    if(!f) return;
    if (!f.querySelector('[data-all]')){
      const all = document.createElement('button');
      all.className = 'tag';
      all.textContent = 'All';
      all.setAttribute('data-all','true');
      f.prepend(all);
      all.addEventListener('click', ()=>{
        // clear ALL tag states (including itself) so active.length === 0
        f.querySelectorAll('.tag').forEach(t=> t.classList.remove('active'));
        renderRecipes();
      });
      // when any other tag is clicked, keep “All” visually off
      f.addEventListener('click', (e)=>{
        if(e.target.classList.contains('tag') && !e.target.hasAttribute('data-all')){
          all.classList.remove('active');
        }
      });
    }
  })();

  // 3) Show recipes now (so the page isn’t empty)
  (function showNow(){
    try { renderRecipes && renderRecipes(); } catch(e){}
  })();
  </script>
</body>
</html>

