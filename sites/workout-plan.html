<!DOCTYPE html>
<html lang="en-GB">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FreeFitFuel — My Weekly Workout Plan</title>
<link rel="icon" type="image/svg+xml" href="img/freefitfuel-logo.svg" />
<link rel="stylesheet" href="style.css?v=26" />

<style>
  :root{ --card:#111418; --br:12px; }
  body{ background:#0b0f14; color:var(--ink); }
  .wrap{ max-width:var(--maxw); margin:0 auto; padding:18px 20px; }
  .lead{ color:var(--inkdim); }
  .controls{ display:flex; gap:.6rem; flex-wrap:wrap; align-items:center; margin:.6rem 0 1rem; }
  .btn, .btn-sm{ background:var(--glass); border:1px solid var(--stroke); color:var(--ink); border-radius:8px; padding:.5rem .8rem; cursor:pointer; }
  .btn-sm{ padding:.35rem .6rem; }
  .grid{ display:grid; gap:12px; }
  @media(min-width:820px){ .grid{ grid-template-columns:repeat(2,1fr); } }
  .day{ background:var(--card); border:1px solid var(--stroke); border-radius:var(--br); overflow:hidden; }
  .day header{ display:flex; justify-content:space-between; align-items:center; gap:.6rem; padding:10px 12px; border-bottom:1px solid var(--stroke); }
  .meta{ color:var(--inkdim); }
  .flags{ display:flex; gap:.6rem; align-items:center; flex-wrap:wrap; }
  .flag{ display:inline-flex; gap:.35rem; align-items:center; background:var(--glass); border:1px solid var(--stroke); border-radius:999px; padding:.25rem .55rem; font-size:.92rem; }
  .flag input{ accent-color:var(--accent); }
  .block{ padding:10px 12px; }
  .mov{ border:1px dashed var(--stroke); border-radius:10px; padding:.55rem .6rem; margin:.45rem 0; }
  .mov-head{ display:flex; gap:.6rem; align-items:center; justify-content:space-between; flex-wrap:wrap; }
  .mov-title a{ color:var(--ink); text-decoration:underline dotted; }
  .mov-title a:hover{ color:var(--accent); }
  .rx{ opacity:.9; }
  .log-grid{ display:grid; gap:.35rem; margin-top:.35rem; }
  .log-row{ display:grid; grid-template-columns:78px 1fr 1fr 1fr auto; gap:.35rem; align-items:center; }
  .log-row input{ background:#0b0f14; border:1px solid var(--stroke); border-radius:8px; color:var(--ink); padding:.35rem .45rem; }
  .meta-row{ display:flex; gap:.5rem; align-items:center; flex-wrap:wrap; margin-top:.35rem; }
  .pb{ color:#90ee90; }
  .badge{ border:1px solid var(--stroke); border-radius:999px; padding:.2rem .5rem; background:rgba(255,255,255,.06); }
  .quote{ font-size:.92rem; color:var(--inkdim); margin-top:.25rem; }
  .tools{ display:flex; gap:.5rem; flex-wrap:wrap; }
</style>
</head>
<body>
  <div id="site-header"></div>
  <script src="/js/header-loader.js" defer></script>

  <main class="wrap">
    <h1><span class="accent">My Weekly Workout Plan</span></h1>
    <p class="lead">
      Click an exercise title to open a YouTube form search. Log sets below; PBs are tracked automatically (best weight×reps).
      Check off <strong>Hydration</strong> and <strong>Sleep</strong> when you hit your daily targets.
      All data is stored locally on this device.
    </p>

    <div class="controls" aria-label="Plan tools">
      <button id="btnExport" class="btn-sm">Export logs (.json)</button>
      <label class="btn-sm" for="importFile" style="cursor:pointer">Import logs</label>
      <input id="importFile" type="file" accept="application/json" style="display:none" />
      <button id="btnResetAll" class="btn-sm" title="Delete all saved logs & flags">Reset all</button>
      <span class="meta">Tip: export occasionally to protect against browser cleanup.</span>
    </div>

    <section id="plan" class="grid" aria-label="Weekly plan"></section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <img src="img/freefitfuel-logo.svg" alt="FreeFitFuel Logo" height="64" />
      <p>&copy; 2025 FreeFitFuel™ · All rights reserved.</p>
      <p class="credit">Created by Grant Cameron Anthony</p>
    </div>
  </footer>

<script>
/* ================== STORAGE / NAMESPACE ================== */
const NS = 'fff.workoutplan.v1.';           // this page’s own data (logs, flags, prefs)
const IMPORT_KEYS_PREFIX = 'fff.';           // allow importing other FFF keys too
const ROADMAP_KEY = 'fff.roadmap.plan.v1';   // if your nutrition page saved a structured plan, read it here

/* ================== HELPERS ================== */
const DAYS = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
function yt(q){ return 'https://www.youtube.com/results?search_query='+encodeURIComponent(q+' form'); }
function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function bestScore(obj){
  let best=0;
  for(let i=1;i<=5;i++){
    const w=parseFloat(obj['w'+i]||'0')||0, r=parseFloat(obj['r'+i]||'0')||0;
    best = Math.max(best, w*r);
  }
  return best;
}
function milestoneText(count){
  const n = typeof count==='number' ? count : parseInt(localStorage.getItem(NS+'saves')||'0',10);
  if(n>=200) return 'Milestone: 200 logs 🔥';
  if(n>=100) return 'Milestone: 100 logs 🎉';
  if(n>=50)  return 'Milestone: 50 logs 💪';
  if(n>=25)  return 'Milestone: 25 logs 🙌';
  if(n>=10)  return 'Milestone: 10 logs ✅';
  if(n>=5)   return 'Milestone: 5 logs ✨';
  return '';
}

/* ================== DEFAULT PLAN (fallback) ==================
   If nothing is saved by the roadmap generator, we build a reasonable
   Push/Pull/Legs/Core + Full-body split and spread it Mon→Sun.        */
const DEFAULT_EXES = {
  push: [
    {name:'Push-up',               rx:'3×8–12', yt:'push up'},
    {name:'DB Overhead Press',     rx:'3×6–10', yt:'dumbbell overhead press'},
    {name:'Lateral Raise',         rx:'3×12–15', yt:'lateral raise'}
  ],
  pull: [
    {name:'Bodyweight Row (table/door)', rx:'3×8–12', yt:'bodyweight row table'}
  , {name:'Band Lat Pulldown',           rx:'3×10–12', yt:'band lat pulldown'}
  ],
  legs: [
    {name:'Step-up',         rx:'3×8–12/leg', yt:'step up exercise'},
    {name:'DB Romanian Deadlift', rx:'3×8–12', yt:'dumbbell romanian deadlift'},
    {name:'Side Plank',      rx:'3×30–45s/side', yt:'side plank'}
  ],
  full: [
    {name:'DB Bench or Push-ups', rx:'4×6–12', yt:'dumbbell bench press'},
    {name:'DB Row / Chest-supported Row', rx:'4×8–12', yt:'dumbbell row'},
    {name:'DB RDL', rx:'4×8–12', yt:'dumbbell romanian deadlift'}
  ],
  core: [
    {name:'Plank or Dead Bug', rx:'3×30–45s', yt:'plank exercise'}
  ],
  conditioning: [
    {name:'LISS: easy jog / cycle', rx:'20–30 min', yt:'how to easy run'},
    {name:'Optional: Jump Rope practice', rx:'5–10 min', yt:'jump rope basics'}
  ]
};
function buildDefaultWeek(){
  return [
    {day:'Mon', blocks:[{title:'Push', items:DEFAULT_EXES.push},{title:'Core', items:DEFAULT_EXES.core}]},
    {day:'Tue', blocks:[{title:'Pull', items:DEFAULT_EXES.pull},{title:'Conditioning', items:DEFAULT_EXES.conditioning}]},
    {day:'Wed', blocks:[{title:'Legs', items:DEFAULT_EXES.legs} ,{title:'Core', items:DEFAULT_EXES.core}]},
    {day:'Thu', blocks:[{title:'Push', items:DEFAULT_EXES.push}]},
    {day:'Fri', blocks:[{title:'Pull', items:DEFAULT_EXES.pull}]},
    {day:'Sat', blocks:[{title:'Full-body', items:DEFAULT_EXES.full},{title:'Conditioning (optional)', items:DEFAULT_EXES.conditioning}]},
    {day:'Sun', blocks:[{title:'Mobility / Walk', items:[{name:'20–40 min walk + stretch', rx:'easy pace', yt:'beginner mobility routine'}]}]}
  ];
}

/* ================== LOAD PLAN (from roadmap or default) ================== */
function loadPlanFromRoadmap(){
  try{
    const raw = localStorage.getItem(ROADMAP_KEY);
    if(!raw) return null;
    const obj = JSON.parse(raw);
    // Expecting: [{day:'Mon', blocks:[{title:'Push', items:[{name, rx, yt?}, ...]}]}...]
    if(Array.isArray(obj) && obj.length===7) return obj;
  }catch{}
  return null;
}
const PLAN = loadPlanFromRoadmap() || buildDefaultWeek();

/* ================== RENDER ================== */
const planEl = document.getElementById('plan');

function hydrationKey(day){ return NS+'hydr.'+day; }
function sleepKey(day){ return NS+'sleep.'+day; }
function exKey(day, title){ return NS+'ex.'+day+'.'+title.replace(/[^a-z0-9]+/gi,'-').toLowerCase(); }

function render(){
  planEl.innerHTML = '';
  PLAN.forEach(dayObj=>{
    const d = dayObj.day; const idDay = d.toLowerCase();

    const day = document.createElement('article');
    day.className='day';

    // Header with daily flags (Hydration/Sleep)
    const hydHit = localStorage.getItem(hydrationKey(d)) === '1';
    const slpHit = localStorage.getItem(sleepKey(d)) === '1';

    day.innerHTML = `
      <header>
        <h3 style="margin:0">${d}</h3>
        <div class="flags">
          <label class="flag"><input type="checkbox" data-flag="hydr" ${hydHit?'checked':''}/> Hydration hit</label>
          <label class="flag"><input type="checkbox" data-flag="sleep" ${slpHit?'checked':''}/> Sleep goal hit</label>
        </div>
      </header>
      <div class="block" data-body></div>
    `;

    const body = day.querySelector('[data-body]');

    dayObj.blocks.forEach(block=>{
      const wrap = document.createElement('div');
      wrap.className='mov';
      const title = block.title || 'Session';

      // Exercises list
      const listHTML = (block.items||[]).map((it,idx)=>{
        const name = it.name || 'Exercise';
        const rx   = it.rx || '';
        const q    = it.yt || name;
        const key  = exKey(d, title+'-'+name);
        const saved = JSON.parse(localStorage.getItem(key) || '{}');
        const bestWas = parseFloat(localStorage.getItem(key+'.best')||'0')||0;

        return `
          <div class="mov" style="margin:.35rem 0">
            <div class="mov-head">
              <div class="mov-title"><a href="${yt(q)}" target="_blank" rel="noopener">${name}</a></div>
              <div class="rx">${rx}</div>
              <div class="tools">
                <button class="btn-sm" data-clear="${key}" title="Clear saved sets">Clear</button>
              </div>
            </div>
            <div class="log-grid" data-log="${key}">
              ${[1,2,3,4,5].map(i=>`
                <div class="log-row">
                  <strong>Set ${i}</strong>
                  <input inputmode="decimal" placeholder="kg"   data-field="w${i}" value="${saved['w'+i]||''}">
                  <input inputmode="numeric" placeholder="reps" data-field="r${i}" value="${saved['r'+i]||''}">
                  <input placeholder="notes" data-field="n${i}" value="${saved['n'+i]||''}">
                  <button class="btn-sm" data-save="${key}">Save</button>
                </div>
              `).join('')}
            </div>
            <div class="meta-row">
              <span class="pb" id="${key}-pb">${bestWas>0?`PB: ${bestWas.toFixed(1)} (w×r best set)`:''}</span>
              <span class="badge" id="${key}-badge">${milestoneText()}</span>
            </div>
          </div>
        `;
      }).join('');

      wrap.innerHTML = `
        <div class="mov-head" style="margin-bottom:.25rem">
          <div class="mov-title"><strong>${title}</strong></div>
          <div class="meta">Tip: type exercise name + “form” on YouTube for quick refresh.</div>
        </div>
        ${listHTML || '<p class="meta">No items.</p>'}
      `;

      body.appendChild(wrap);
    });

    // Wire hydration/sleep flags
    day.querySelector('[data-flag="hydr"]')?.addEventListener('change', (e)=>{
      localStorage.setItem(hydrationKey(d), e.target.checked ? '1' : '0');
    });
    day.querySelector('[data-flag="sleep"]')?.addEventListener('change', (e)=>{
      localStorage.setItem(sleepKey(d), e.target.checked ? '1' : '0');
    });

    // Wire saving / clearing for each exercise block
    day.querySelectorAll('[data-save]').forEach(btn=>{
      const key = btn.getAttribute('data-save');
      const grid = day.querySelector(`[data-log="${key}"]`);
      const pbEl = day.querySelector('#'+CSS.escape(key)+'-pb');
      const badgeEl = day.querySelector('#'+CSS.escape(key)+'-badge');

      btn.addEventListener('click', ()=>{
        const obj = {};
        grid.querySelectorAll('[data-field]').forEach(inp=>{ obj[inp.dataset.field] = inp.value.trim(); });
        localStorage.setItem(key, JSON.stringify(obj));
        const now = bestScore(obj);
        const was = parseFloat(localStorage.getItem(key+'.best')||'0')||0;
        if(now>was){ localStorage.setItem(key+'.best', now); if(pbEl) pbEl.textContent = `New PB! ${now.toFixed(1)} (best w×r)`; }
        else{ if(pbEl) pbEl.textContent = was>0 ? `PB: ${was.toFixed(1)} (w×r)` : 'Saved.'; }
        const total=(parseInt(localStorage.getItem(NS+'saves')||'0',10)+1);
        localStorage.setItem(NS+'saves', total);
        if(badgeEl) badgeEl.textContent = milestoneText(total);
      });
    });

    day.querySelectorAll('[data-clear]').forEach(btn=>{
      const key = btn.getAttribute('data-clear');
      btn.addEventListener('click', ()=>{
        localStorage.removeItem(key);
        localStorage.removeItem(key+'.best');
        render(); // simplest refresh
      });
    });

    planEl.appendChild(day);
  });
}

/* ================== EXPORT / IMPORT / RESET ================== */
document.getElementById('btnExport')?.addEventListener('click', ()=>{
  // export all keys that belong to workout plan + the roadmap plan key if present
  const dump = {};
  for(let i=0;i<localStorage.length;i++){
    const k = localStorage.key(i);
    if(!k) continue;
    if(k.startsWith(NS) || k === ROADMAP_KEY) dump[k] = localStorage.getItem(k);
  }
  const blob = new Blob([JSON.stringify(dump,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'freefitfuel-workout-plan-backup.json';
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});

document.getElementById('importFile')?.addEventListener('change', (e)=>{
  const file = e.target.files?.[0]; if(!file) return;
  const r = new FileReader();
  r.onload = ()=>{
    try{
      const obj = JSON.parse(String(r.result||'{}'));
      Object.keys(obj).forEach(k=>{
        // only accept our namespace or the roadmap plan key
        if(k.startsWith(IMPORT_KEYS_PREFIX) || k===ROADMAP_KEY){
          localStorage.setItem(k, obj[k]);
        }
      });
      alert('Imported ✅'); location.reload();
    }catch{ alert('Import failed — invalid file.'); }
  };
  r.readAsText(file);
});

document.getElementById('btnResetAll')?.addEventListener('click', ()=>{
  if(!confirm('Delete ALL workout plan logs, flags and saved plan on this device?')) return;
  const keys = [];
  for(let i=0;i<localStorage.length;i++){
    const k = localStorage.key(i);
    if(k && (k.startsWith(NS) || k===ROADMAP_KEY)) keys.push(k);
  }
  keys.forEach(k=>localStorage.removeItem(k));
  location.reload();
});

/* ================== GO ================== */
render();
</script>
</body>
</html>
