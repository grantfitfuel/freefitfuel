<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Nutrition – FreeFitFuel</title>

  <link rel="stylesheet" href="style.css?v=29">
  <link rel="icon" type="image/svg+xml" href="img/freefitfuel-logo.svg">

  <style>
    /* === Page-specific styles (adds on top of your global CSS) === */
    .hidden{display:none}
    .wrap{max-width:var(--maxw,1100px);margin:0 auto;padding:18px 20px}
    .lead{color:var(--inkdim,#b9b9c8)}

    .hero-mini{position:relative;border-bottom:1px solid #1b1b22}
    .hero-mini figure{margin:0;position:relative}
    .hero-mini img{width:100%;height:46vh;min-height:320px;object-fit:cover;display:block;filter:brightness(.88) saturate(1.05);object-position:center 35%}
    .hero-mini .overlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.45),rgba(0,0,0,.65))}
    .hero-mini .content{position:absolute;inset:auto 0 0 0;padding:16px 20px 22px;max-width:var(--maxw,1100px);margin:0 auto}
    .hero-mini h1{margin:0 0 .35rem}
    .hero-mini p{max-width:70ch;margin:.2rem 0 0;color:#d0d0da}

    /* Toolbar (goals + budget toggle) */
    .toolbar{display:flex;flex-wrap:wrap;gap:.6rem;align-items:center;margin:1rem 0 1.1rem}
    .seg{display:inline-flex;border:1px solid var(--stroke,#2a2a36);border-radius:999px;overflow:hidden}
    .seg button{background:var(--glass,rgba(255,255,255,.06));color:var(--ink,#eee);border:0;padding:.45rem .85rem;cursor:pointer}
    .seg button[aria-pressed="true"]{background:var(--accent,#62f);color:#111;font-weight:800}
    .pill{display:inline-flex;align-items:center;gap:.35rem;background:var(--glass,rgba(255,255,255,.06));border:1px solid var(--stroke,#2a2a36);border-radius:999px;padding:.35rem .65rem;font-size:.92rem}
    .pill input{accent-color:var(--accent,#62f)}

    /* Sections + Cards */
    .section{background:var(--glass,rgba(255,255,255,.06));border:1px solid var(--stroke,#2a2a36);border-radius:14px;margin:12px 0;padding:14px}
    .section>h2{margin:.15rem 0 .45rem;font-size:1.2rem}
    .note{font-size:.92rem;color:var(--inkdim,#b9b9c8)}

    /* Cards / grids */
    .grid{display:grid;gap:12px}
    .cols-2{grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .cols-3{grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .card{background:var(--glass,rgba(255,255,255,.06));border:1px solid var(--stroke,#2a2a36);border-radius:12px;overflow:hidden}
    .card figure{height:160px;background:#111;margin:0}
    .card img{width:100%;height:100%;object-fit:cover;display:block}
    .card .body{padding:12px}
    .badge{display:inline-block;font-size:.78rem;padding:.18rem .5rem;border:1px solid var(--stroke,#2a2a36);border-radius:999px;margin-right:6px;margin-bottom:6px}
    .macros{display:flex;gap:10px;flex-wrap:wrap;margin:.4rem 0 .2rem}
    .bar{background:rgba(255,255,255,.09);border:1px solid var(--stroke,#2a2a36);height:8px;border-radius:999px;overflow:hidden}
    .bar>span{display:block;height:100%;width:0;transition:width .35s ease}

    /* Buttons */
    .btn{background:var(--accent,#62f);color:#111;border:0;border-radius:10px;padding:.45rem .75rem;cursor:pointer}
    .btn.alt{background:var(--glass,rgba(255,255,255,.06));color:var(--ink,#eee);border:1px solid var(--stroke,#2a2a36)}

    /* Auto planner */
    .ap-plan-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .ap-day-col{background:var(--glass,rgba(255,255,255,.06));border:1px solid var(--stroke,#2a2a36);border-radius:10px;padding:10px}
    .ap-slot .row{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .ap-swap{border:1px solid var(--stroke,#2a2a36);background:var(--glass,rgba(255,255,255,.06));padding:.28rem .6rem;border-radius:999px;cursor:pointer}
    .ap-total{margin-top:.4rem;color:var(--inkdim,#b9b9c8);font-size:.95rem}

    /* Filters */
    .filters{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:.6rem}
    .filters .tag{border:1px solid var(--stroke,#2a2a36);background:var(--glass,rgba(255,255,255,.06));padding:.35rem .7rem;border-radius:999px;cursor:pointer}
    .filters .tag.active{background:var(--accent,#62f);color:#111;font-weight:700}

    /* KPI lines */
    .kpi{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .kpi strong{font-weight:700}

    /* Recipe Card modal (uses <dialog>) */
    dialog#recipeModal{border:1px solid var(--stroke,#2a2a36);background:var(--glass,rgba(0,0,0,.9));border-radius:12px;color:var(--ink,#eee);max-width:720px;width:92%;padding:0}
    #recipeModal .modal-inner{padding:16px}
    #recipeModal header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:8px;border-bottom:1px solid var(--stroke,#2a2a36);padding-bottom:8px}
    #recipeModal .actions{display:flex;gap:8px;flex-wrap:wrap}
    #recipeModal .meta{color:var(--inkdim,#b9b9c8);font-size:.9rem}
    #recipeModal .ing ul, #recipeModal .steps ol{margin:.4rem 0 .6rem}
    #recipeModal .share{margin-top:.5rem;font-size:.9rem;color:var(--inkdim,#b9b9c8)}
    @media print {
      body{background:#fff;color:#000}
      dialog#recipeModal{border:0;background:#fff;color:#000}
      .no-print{display:none !important}
    }
  </style>
</head>
<body>
<!-- HEADER -->
<header class="site-header">
  <div class="container">
    <a href="index.html" class="logo"><img src="img/freefitfuel-logo.svg" alt="FreeFitFuel Logo" height="56"></a>
    <button class="hamburger" aria-label="Open menu" aria-controls="primary-nav" aria-expanded="false">
      <span></span><span></span><span></span>
    </button>
    <nav id="primary-nav" class="main-nav" aria-label="Primary">
      <a href="index.html">Home</a>
      <a href="ideas.html">Ideas</a>
      <a href="guides.html">Guides</a>
      <a href="workouts.html">Workouts</a>
      <a href="endurance.html">Endurance</a>
      <a href="nutrition.html" aria-current="page">Nutrition</a>
      <a href="wellbeing.html">Wellbeing</a>
      <a href="contact.html">Contact</a>
    </nav>
  </div>
</header>
<!-- HERO -->
<header class="hero-mini" role="banner" aria-label="Nutrition hero">
  <figure>
    <img src="img/nutrition-hero.jpg" alt="Budget-friendly, colourful whole foods on a table" onerror="this.style.display='none'">
    <div class="overlay" aria-hidden="true"></div>
  </figure>
  <div class="content wrap">
    <h1><span class="accent">Fuel for real life</span></h1>
    <p>Goal-based macros, budget mode, a weekly planner that builds your shopping list, and a day log that tracks towards your targets.</p>
  </div>
</header>
<main class="wrap">
  <p class="lead">
    Pick a <strong>goal</strong>, calculate your <strong>targets</strong> (BMR → TDEE), then add meals to the <strong>planner</strong> and <strong>daily log</strong>.
    Toggle <strong>Budget</strong> to favour low-cost options. All data saves on this device.
  </p>

  <!-- Controls -->
  <div class="toolbar" aria-label="Nutrition controls">
    <div class="seg" role="tablist" aria-label="Goal">
      <button role="tab" aria-pressed="true"  data-goal="maintain">Maintain</button>
      <button role="tab" aria-pressed="false" data-goal="cut">Cut</button>
      <button role="tab" aria-pressed="false" data-goal="build">Build</button>
      <button role="tab" aria-pressed="false" data-goal="transform">Transform</button>
    </div>
    <span class="pill"><input type="checkbox" id="budget"> <label for="budget">Budget mode</label></span>
  </div>

  <!-- Goal meanings -->
  <section class="section goal-explain">
    <h2>What the goals mean</h2>
    <div class="grid cols-2">
      <article class="kpi"><strong>Maintain</strong> Keep weight steady. Calories ≈ TDEE. Protein high enough to preserve muscle; flexible carbs/fats.</article>
      <article class="kpi"><strong>Cut</strong> Gentle fat loss. Calories ≈ TDEE − 10–20%. Higher protein & fibre to keep you fuller; carbs timed around training.</article>
      <article class="kpi"><strong>Build (Bulk)</strong> Muscle gain. Calories ≈ TDEE + 5–15%. Prioritise protein + carbs; steady surplus with progressive training.</article>
      <article class="kpi"><strong>Transform</strong> Recomp: small deficit/surplus depending on the day; keep protein high; focus on veg, sleep & steps.</article>
    </div>
  </section>
    <!-- Calculator -->
  <section class="section">
    <h2>Macro & Calorie Calculator</h2>
    <div class="grid cols-2">
      <div class="calc card" style="padding:12px">
        <div class="row">
          <label>Sex
            <select id="sex"><option value="female">Female</option><option value="male">Male</option></select>
          </label>
          <label>Age <input id="age" type="number" min="13" max="99" value="35"></label>
          <label>Height (cm) <input id="cm" type="number" min="120" max="220" value="175"></label>
          <label>Weight (kg) <input id="kg" type="number" min="35" max="250" value="75"></label>
          <label>Activity
            <select id="act">
              <option value="1.2">Sedentary</option>
              <option value="1.375">Light (1–3x/wk)</option>
              <option value="1.55" selected>Moderate (3–5x)</option>
              <option value="1.725">Active (6–7x)</option>
              <option value="1.9">Very active</option>
            </select>
          </label>
        </div>
        <div class="row">
          <label>Protein (g/kg) <input id="pkk" type="number" step="0.1" value="1.8"></label>
          <label>Carbohydrate bias
            <select id="carbBias">
              <option value="balanced" selected>Balanced</option>
              <option value="lowerCarb">Lower carbohydrate</option>
              <option value="higherCarb">Higher carbohydrate</option>
            </select>
          </label>
          <label><input type="checkbox" id="knowbf"> I know body fat %</label>
          <label id="bfWrap" class="hidden">Body fat % <input id="bf" type="number" min="3" max="60" step="0.5" value="20"></label>
        </div>
        <div class="row">
          <button class="btn" id="calcBtn">Calculate</button>
          <span id="calcNote" class="out">Uses Mifflin–St Jeor (or Katch–McArdle if body fat is provided), then adjusts by activity and goal.</span>
        </div>
      </div>
      <div class="results">
        <div class="kpi"><strong id="outGoal">Maintain</strong><span id="outCals">— kilocalories / day</span></div>
        <div class="kpi"><strong>Protein</strong><span id="outP">— grams</span><div class="bar"><span id="barP"></span></div></div>
        <div class="kpi"><strong>Carbohydrate</strong><span id="outC">— grams</span><div class="bar"><span id="barC"></span></div></div>
        <div class="kpi"><strong>Fat</strong><span id="outF">— grams</span><div class="bar"><span id="barF"></span></div></div>
        <div class="note">Fibre: aim ~25–35 grams/day. Hydration helper below.</div>
      </div>
    </div>
  </section>
    <!-- Recipes -->
  <section class="section" id="recipes">
    <h2>Recipe Library</h2>
    <div class="filters" id="recipeFilters" aria-label="Recipe filters">
      <button class="tag" data-tag="budget">Budget</button>
      <button class="tag" data-tag="high-protein">High-Protein</button>
      <button class="tag" data-tag="gluten-free">Gluten-Free</button>
      <button class="tag" data-tag="dairy-free">Dairy-Free</button>
      <button class="tag" data-tag="veg">Vegetarian</button>
      <button class="tag" data-tag="vegan">Vegan</button>
      <button class="tag" data-tag="quick">Quick (≤20 min)</button>
      <button class="tag" data-tag="batch">Batch-cook</button>
      <button class="tag" data-tag="world">World cuisines</button>
      <button class="tag" data-tag="simple">Simple</button>
    </div>
    <div class="grid cols-3" id="recipeGrid"></div>
    <p class="note">Allergens are listed on every card (check labels for specific products & cross-contamination). Nutrition values are estimates.</p>
  </section>

  <!-- Recipe Card Modal (in-page card view with print + copy link) -->
  <dialog id="recipeModal">
    <div class="modal-inner">
      <header class="no-print">
        <h3 id="rm-title" style="margin:0">Recipe</h3>
        <div class="actions">
          <button class="btn alt" id="rm-close">Close</button>
          <button class="btn alt" id="rm-copy">Copy card link</button>
          <button class="btn" id="rm-print">Print</button>
        </div>
      </header>
      <div class="meta" id="rm-meta"></div>
      <div class="ing"><h4>Ingredients</h4><ul id="rm-ing"></ul></div>
      <div class="steps"><h4>Method</h4><ol id="rm-steps"></ol></div>
      <div class="share no-print" id="rm-share"></div>
    </div>
  </dialog>
    <!-- Weekly Planner -->
  <section class="section" id="planner">
    <h2>Weekly Meal Planner</h2>
    <p class="note">Click “Add to planner” on any recipe to slot it into the week. Your plan saves on this device.</p>
    <div class="planner">
      <div class="controls">
        <button class="btn" id="clearPlan">Clear week</button>
        <button class="btn" id="printList">Print shopping list</button>
        <button class="btn" id="csvList">Download CSV</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>Day</th>
            <th>Breakfast</th>
            <th>Lunch</th>
            <th>Dinner</th>
            <th>Snacks</th>
          </tr>
        </thead>
        <tbody id="planBody"></tbody>
      </table>
    </div>
  </section>
    <!-- Auto 7-Day Planner (smart) -->
  <section class="section" id="auto-planner">
    <h2>Auto 7-Day Meal Planner (smart)</h2>
    <p class="meta">Auto-plans to your daily kilocalorie target. Click <em>Swap</em> to cycle alternatives in any slot.</p>

    <div class="ap-controls">
      <label>Daily kilocalorie target
        <input id="ap-kcal" type="number" min="1200" max="4500" step="50" value="2200">
      </label>
      <button id="ap-generate" class="btn">Generate plan</button>
      <button id="ap-clear" class="btn alt">Clear</button>
    </div>

    <div id="ap-grid" class="ap-plan-grid"></div>
    <p class="note">Tip: global <strong>Budget mode</strong> (top of page) affects the shopping list & printable recipe cards.</p>
  </section>
    <!-- Food Log (per day) -->
  <section class="section" id="foodlog">
    <h2>Daily Food Log</h2>
    <div class="log">
      <div class="row">
        <label>Date <input type="date" id="logDate"></label>
        <button class="btn" id="addCustom">Add custom item</button>
        <button class="btn alt" id="clearLog">Clear day</button>
        <button class="btn alt" id="exportLog">Export CSV</button>
      </div>
      <div id="logItems"></div>
      <div class="progress">
        <div class="line">
          <strong>Calories</strong>
          <div class="bar"><span id="pbCal"></span></div>
          <span id="txCal">0 / 0</span>
        </div>
        <div class="line">
          <strong>Protein</strong>
          <div class="bar"><span id="pbProt"></span></div>
          <span id="txProt">0 / 0</span>
        </div>
        <div class="line">
          <strong>Carbohydrate</strong>
          <div class="bar"><span id="pbCarb"></span></div>
          <span id="txCarb">0 / 0</span>
        </div>
        <div class="line">
          <strong>Fat</strong>
          <div class="bar"><span id="pbFat"></span></div>
          <span id="txFat">0 / 0</span>
        </div>
      </div>
      <p class="note">Tip: log meals first, then tweak snacks to hit your targets.</p>
    </div>
  </section>
    <!-- Hydration & fibre -->
  <section class="section">
    <h2>Hydration & Fibre</h2>
    <div class="grid cols-2">
      <article class="card" style="padding:.8rem">
        <h3>Hydration helper</h3>
        <div class="calc">
          <div class="row">
            <label>Body weight (kg) <input id="h-kg" type="number" min="35" max="250" value="75"></label>
            <label>Extra per hour training (ml) <input id="h-train" type="number" min="0" step="50" value="400"></label>
          </div>
          <div class="row">
            <button class="btn" id="h-calc">Calculate</button>
            <span class="out" id="h-out">— ml / day</span>
          </div>
        </div>
        <p class="note">Rule of thumb: ~30–35 ml/kg + ~300–600 ml per training hour. Adjust to heat & thirst.</p>
      </article>
      <article class="card" style="padding:.8rem">
        <h3>Fibre targets</h3>
        <p>Aim 25–35 grams/day from foods. Increase gradually with fluids to avoid gut discomfort.</p>
        <ul><li>Oats/porridge, wholegrains</li><li>Beans/lentils/chickpeas</li><li>Fruit (berries), vegetables, nuts/seeds</li></ul>
      </article>
    </div>
  </section>

  <!-- Disclaimer -->
  <section class="section">
    <h2>Important Note</h2>
    <p>The content on FreeFitFuel is for general nutrition education only and isn’t a substitute for personalised medical advice. If you have a medical condition, allergies, or take medications, speak to a qualified professional before making major changes.</p>
  </section>
</main>

<footer class="site-footer">
  <div class="container">
    <img src="img/freefitfuel-logo.svg" alt="FreeFitFuel Logo" height="64" onerror="this.style.display='none'">
    <p>© 2025 FreeFitFuel · All rights reserved.</p>
    <p class="credit">Created by Grant Cameron Anthony</p>
  </div>
</footer>

<!-- === Scripts (single tag; replace everything below this line through the closing </script>) === -->
<script>
/* ============ 1) Header burger ============ */
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.querySelector('.hamburger');
  const nav = document.querySelector('.main-nav');
  if(btn && nav){
    btn.addEventListener('click', () => {
      const open = btn.classList.toggle('active');
      nav.classList.toggle('open', open);
      btn.setAttribute('aria-expanded', open ? 'true' : 'false');
    });
  }
});

/* ============ 2) Global state (ONE copy only) ============ */
let goal = 'maintain';
let budgetMode = false;
let targets = {cal:0,p:0,c:0,f:0};
let lastCalc = false;

/* ============ 3) Calculator ============ */
const bfWrap = document.getElementById('bfWrap');
const knowbf = document.getElementById('knowbf');
if(knowbf){ knowbf.addEventListener('change', e=>{ if(bfWrap) bfWrap.classList.toggle('hidden', !e.target.checked); }); }

function mifflin(kg, cm, age, sex){ return 10*kg + 6.25*cm - 5*age + (sex==='male'?5:-161); }
function katch(kg, bfPerc){ const lbm = kg*(1-bfPerc/100); return 370 + 21.6*lbm; }
function clampTargets(cals,bmr){ const floor=Math.round(bmr*1.2), ceil=Math.round(bmr+1000); return Math.max(floor, Math.min(ceil, Math.round(cals))); }
function adjustForGoal(cals){ switch(goal){ case'cut':return cals*0.85; case'build':return cals*1.10; case'transform':return cals*0.95; default:return cals; } }
function splitCarbFat(remain,bias){ let fatK=.5, carbK=.5; if(bias==='lowerCarb'){fatK=.6;carbK=.4} if(bias==='higherCarb'){fatK=.35;carbK=.65} return {fat:Math.round(remain*fatK/9), carb:Math.round(remain*carbK/4)}; }

function doCalc(){
  const sex = document.getElementById('sex').value;
  const age = +document.getElementById('age').value||0;
  const cm  = +document.getElementById('cm').value||0;
  const kg  = +document.getElementById('kg').value||0;
  const act = +document.getElementById('act').value||1.55;
  const pkk = +document.getElementById('pkk').value||1.8;
  const bias= document.getElementById('carbBias').value;
  const know= (document.getElementById('knowbf')||{}).checked;
  const bf  = +document.getElementById('bf').value||20;

  const bmr = know ? katch(kg,bf) : mifflin(kg,cm,age,sex);
  const tdee = bmr * act;
  const pre  = adjustForGoal(tdee);
  const cal  = clampTargets(pre, bmr);

  const p = Math.round(kg * pkk);
  const pCals = p*4;
  const remain = Math.max(0, cal - pCals);
  const {fat:f, carb:c} = splitCarbFat(remain, bias);

  targets = {cal:Math.round(cal), p, c, f};
  lastCalc = true;
  localStorage.setItem('fff-targets', JSON.stringify({goal,targets}));

  const og=document.getElementById('outGoal'),
        oc=document.getElementById('outCals'),
        op=document.getElementById('outP'),
        ocb=document.getElementById('outC'),
        of=document.getElementById('outF');
  if(og) og.textContent = goal[0].toUpperCase()+goal.slice(1);
  if(oc) oc.textContent = targets.cal+' kilocalories / day';
  if(op) op.textContent = targets.p+' grams';
  if(ocb) ocb.textContent = targets.c+' grams';
  if(of) of.textContent = targets.f+' grams';
  setBar('barP',100); setBar('barC',100); setBar('barF',100);
  updateLogBars();
}
const calcBtn = document.getElementById('calcBtn'); if(calcBtn) calcBtn.addEventListener('click', doCalc);

/* Goal buttons */
document.querySelectorAll('[data-goal]').forEach(b=>{
  b.addEventListener('click', ()=>{
    document.querySelectorAll('[data-goal]').forEach(x=>x.setAttribute('aria-pressed','false'));
    b.setAttribute('aria-pressed','true');
    goal = b.dataset.goal;
    const og = document.getElementById('outGoal');
    if(og) og.textContent = goal[0].toUpperCase()+goal.slice(1);
    if(lastCalc){ doCalc(); updateLogBars(); }
  });
});

/* Budget toggle */
const budgetEl = document.getElementById('budget');
if(budgetEl){ budgetEl.addEventListener('change', e=>{ budgetMode = e.target.checked; }); }

/* Hydration helper */
const hCalc = document.getElementById('h-calc');
if(hCalc){
  hCalc.addEventListener('click', ()=>{
    const kg = +document.getElementById('h-kg').value||0;
    const extra = +document.getElementById('h-train').value||0;
    const base = kg * 32;
    document.getElementById('h-out').textContent = Math.round(base + extra)+' ml / day';
  });
}

/* ============ 4) Utilities ============ */
function pct(a,b){ return b? Math.max(0, Math.min(100, Math.round(100*a/b))) : 0; }
function setBar(id, v){ const el=document.getElementById(id); if(el) el.style.width = v+'%'; }

/* ============ 5) Budget swaps (ONE copy only) ============ */
const budgetSwaps = {
  'greek yoghurt':'plain yoghurt',
  'mixed seeds':'sunflower seeds',
  'frozen berries':'seasonal fruit',
  'tuna':'mackerel (tinned)',
  'chicken thigh':'chicken drumsticks or beans',
  'beef mince':'turkey mince or lentils',
  'parmesan':'cheddar',
  'pesto':'olive oil + herbs',
  'rice':'oats or potatoes'
};

/* ============ 6) Recipes store ============ */
window.RECIPES = window.RECIPES || [];
function addRecipes(list){ RECIPES = RECIPES.concat(list); }

/* >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
   PASTE ALL YOUR existing addRecipes([...]) BLOCKS HERE.
   IMPORTANT: paste them as plain JS — NO extra <script> tags.
   <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< */

addRecipes([
  {k:'nihari', name:'Beef Nihari (Pressure Cooker Option)', cuisine:'Pakistani', tags:['world','batch','gluten-free'], allergens:[], img:'', servings:6,
    macros:{kcal:560,p:45,c:12,f:36},
    adds:['beef shank','onion','ginger garlic','nihari masala','ghee or oil','lemon','coriander'],
    ingredients:[{qty:1.2,unit:'kg',item:'beef shank (large chunks)'},{qty:2,unit:'',item:'onions (sliced)'},{qty:2,unit:'tbsp',item:'ginger garlic paste'},{qty:3,unit:'tbsp',item:'nihari masala'},{qty:2,unit:'tbsp',item:'ghee or oil'},{qty:1,unit:'',item:'lemon (wedges)'},{qty:0.5,unit:'cup',item:'fresh coriander (chopped)'}],
    steps:['Brown onions in ghee/oil.','Add beef; sear.','Stir in ginger garlic and nihari masala.','Cover with water; pressure cook 45–60 minutes (or simmer 3–4 hours) until gelatinous and tender.','Reduce to a thick gravy; garnish with lemon and coriander.']},

  {k:'haleem', name:'Chicken Haleem (Quick Oats Blend)', cuisine:'Pakistani', tags:['world','batch','gluten-free'], allergens:[], img:'', servings:6,
    macros:{kcal:520,p:38,c:58,f:14},
    adds:['chicken','lentils mix','oats','onion','ginger garlic','garam masala','ghee or oil'],
    ingredients:[{qty:800,unit:'g',item:'chicken (boneless thighs)'},{qty:200,unit:'g',item:'mixed lentils (chana + moong + masoor)'},{qty:100,unit:'g',item:'oats'},{qty:2,unit:'',item:'onions (sliced)'},{qty:2,unit:'tbsp',item:'ginger garlic paste'},{qty:1,unit:'tbsp',item:'garam masala'},{qty:2,unit:'tbsp',item:'ghee or oil'}],
    steps:['Boil lentils and oats until very soft; blend coarse.','Sear onions; add chicken and spices; cook through.','Combine with lentil-oat mix; simmer to thick porridge.','Finish with tempered ghee and garam masala.']},

  {k:'aloo-keema', name:'Aloo Keema (Potato Mince Curry)', cuisine:'Pakistani', tags:['world','budget','gluten-free','batch'], allergens:[], img:'', servings:5,
    macros:{kcal:490,p:32,c:35,f:24},
    adds:['beef or lamb mince','potatoes','onion','tomato','ginger garlic','spice blend'],
    ingredients:[{qty:700,unit:'g',item:'minced beef or lamb'},{qty:400,unit:'g',item:'potatoes (cubed)'},{qty:1,unit:'',item:'onion (chopped)'},{qty:2,unit:'',item:'tomatoes (chopped)'},{qty:1,unit:'tbsp',item:'ginger garlic paste'},{qty:2,unit:'tsp',item:'ground coriander + cumin + chilli'}],
    steps:['Brown mince; add onion and ginger garlic.','Add tomatoes and spices; cook down.','Add potatoes and splash of water; simmer until tender and thick.']},

  {k:'lamb-rogan-josh', name:'Lamb Rogan Josh (Lighter)', cuisine:'Indian', tags:['world','gluten-free'], allergens:[], img:'', servings:4,
    macros:{kcal:540,p:38,c:18,f:34},
    adds:['lamb shoulder','yoghurt','onion','ginger garlic','kashmiri chilli','whole spices'],
    ingredients:[{qty:800,unit:'g',item:'lamb shoulder (chunks)'},{qty:150,unit:'g',item:'plain yoghurt'},{qty:1,unit:'',item:'onion (sliced)'},{qty:1,unit:'tbsp',item:'ginger garlic paste'},{qty:2,unit:'tsp',item:'kashmiri chilli powder'},{qty:1,unit:'tsp',item:'whole spices (cardamom, cinnamon, bay)'}],
    steps:['Sear lamb with whole spices.','Add onion and ginger garlic; cook.','Stir in chilli and yoghurt; slow-simmer until tender and red-hued.']},

  {k:'pav-bhaji', name:'Pav Bhaji (Street-Style)', cuisine:'Indian', tags:['veg','world','budget','batch'], allergens:['gluten (pav)*','dairy*'], img:'', servings:5,
    macros:{kcal:470,p:12,c:72,f:16},
    adds:['potatoes','cauliflower','peas','capsicum','tomato','pav bhaji masala','butter'],
    ingredients:[{qty:500,unit:'g',item:'potatoes (boiled, mashed)'},{qty:250,unit:'g',item:'cauliflower (fine chopped)'},{qty:150,unit:'g',item:'peas'},{qty:1,unit:'',item:'green capsicum (diced)'},{qty:3,unit:'',item:'tomatoes (chopped)'},{qty:2,unit:'tbsp',item:'pav bhaji masala'},{qty:30,unit:'g',item:'butter'}],
    steps:['Sauté veg and tomatoes; mash on griddle.','Add masala and butter; cook to a smooth, rich bhaji.','Serve with toasted pav.']},

  {k:'fish-masala', name:'Masala Fish Pan-Fry', cuisine:'Pakistani', tags:['world','high-protein','gluten-free','quick'], allergens:['fish'], img:'', servings:4,
    macros:{kcal:380,p:35,c:6,f:22},
    adds:['firm white fish','chilli','coriander','cumin','lemon'],
    ingredients:[{qty:700,unit:'g',item:'white fish fillets'},{qty:1,unit:'tsp',item:'chilli powder'},{qty:1,unit:'tsp',item:'ground coriander'},{qty:1,unit:'tsp',item:'ground cumin'},{qty:1,unit:'',item:'lemon (juice)'}],
    steps:['Marinate fish with spices and lemon 15 minutes.','Pan-fry 3–4 minutes each side until just cooked.']},

  {k:'palak-chicken', name:'Palak Chicken (Spinach Chicken)', cuisine:'Indian', tags:['world','high-protein','gluten-free'], allergens:[], img:'', servings:4,
    macros:{kcal:480,p:42,c:14,f:26},
    adds:['chicken breast','spinach','onion','tomato','ginger garlic','garam masala'],
    ingredients:[{qty:700,unit:'g',item:'chicken breast (chunks)'},{qty:300,unit:'g',item:'spinach'},{qty:1,unit:'',item:'onion (chopped)'},{qty:1,unit:'',item:'tomato (chopped)'},{qty:1,unit:'tbsp',item:'ginger garlic paste'},{qty:1,unit:'tsp',item:'garam masala'}],
    steps:['Sauté onion and ginger garlic.','Add chicken; sear.','Add tomato and spinach; simmer to a green, thick sauce; finish with garam masala.']},

  {k:'veg-pulao', name:'Vegetable Pulao (One-Pot)', cuisine:'Indian', tags:['veg','world','budget','gluten-free','simple'], allergens:[], img:'', servings:4,
    macros:{kcal:460,p:10,c:82,f:10},
    adds:['basmati rice','mixed vegetables','whole spices','ghee or oil'],
    ingredients:[{qty:300,unit:'g',item:'basmati rice (rinsed)'},{qty:350,unit:'g',item:'mixed vegetables (carrot, peas, beans)'},{qty:1,unit:'tsp',item:'whole spices (cumin, bay, cloves)'},{qty:1,unit:'tbsp',item:'ghee or oil'}],
    steps:['Bloom whole spices in fat.','Add vegetables and rice; sauté.','Add water; cook covered until rice is fluffy.']}
]);

addRecipes([
  {k:'shepherds-pie-light', name:'Shepherd’s Pie (Lean, High Protein)', cuisine:'UK', tags:['high-protein','batch','simple'], allergens:['dairy*'], img:'', servings:6,
    macros:{kcal:480,p:34,c:48,f:16},
    adds:['lean lamb mince','onion','carrot','peas','stock','potatoes','yoghurt'],
    ingredients:[{qty:900,unit:'g',item:'lean lamb mince'},{qty:1,unit:'',item:'onion (chopped)'},{qty:2,unit:'',item:'carrots (diced)'},{qty:150,unit:'g',item:'peas'},{qty:400,unit:'ml',item:'beef stock'},{qty:900,unit:'g',item:'potatoes (for mash)'},{qty:120,unit:'g',item:'yoghurt (to lighten mash)'}],
    steps:['Brown mince with onion and carrots.','Add peas and stock; reduce.','Top with light yoghurt mash; bake until golden.']},

  {k:'fish-pie-simple', name:'Simple Fish Pie', cuisine:'UK', tags:['gluten-free*','simple'], allergens:['fish','dairy'], img:'', servings:5,
    macros:{kcal:560,p:36,c:50,f:22},
    adds:['mixed fish','leek','milk','cheese','potatoes'],
    ingredients:[{qty:700,unit:'g',item:'mixed fish (smoked + white)'},{qty:1,unit:'',item:'leek (sliced)'},{qty:400,unit:'ml',item:'milk'},{qty:60,unit:'g',item:'cheese (grated)'},{qty:900,unit:'g',item:'potatoes (for mash)'}],
    steps:['Poach fish with leek in milk; flake.','Make light sauce with poaching milk and cheese.','Top with mash; bake until bubbling.']},

  {k:'roast-chicken-traybake', name:'Roast Chicken and Veg Traybake', cuisine:'UK', tags:['simple','high-protein','gluten-free'], allergens:[], img:'', servings:4,
    macros:{kcal:520,p:45,c:28,f:24},
    adds:['chicken thighs','potatoes','carrots','onion','rosemary','lemon'],
    ingredients:[{qty:800,unit:'g',item:'chicken thighs'},{qty:500,unit:'g',item:'potatoes (chunks)'},{qty:2,unit:'',item:'carrots (chunks)'},{qty:1,unit:'',item:'onion (wedges)'},{qty:1,unit:'tsp',item:'rosemary'},{qty:1,unit:'',item:'lemon (wedges)'}],
    steps:['Toss everything with oil, salt, rosemary.','Roast at 200°C for 40–45 minutes; finish with lemon.']},

  {k:'jacket-tuna-sweetcorn', name:'Jacket Potato with Tuna and Sweetcorn', cuisine:'UK', tags:['high-protein','budget','simple','quick*'], allergens:['fish','dairy*','egg*','gluten (if not GF potato skin topping)*'], img:'', servings:2,
    macros:{kcal:520,p:32,c:66,f:14},
    adds:['baking potatoes','tuna','sweetcorn','light mayo','yoghurt'],
    ingredients:[{qty:2,unit:'',item:'baking potatoes'},{qty:1,unit:'tin',item:'tuna (drained)'},{qty:80,unit:'g',item:'sweetcorn'},{qty:1,unit:'tbsp',item:'light mayo'},{qty:2,unit:'tbsp',item:'yoghurt'}],
    steps:['Bake or microwave jacket potatoes.','Mix tuna, corn, mayo, yoghurt; top potatoes.']},

  {k:'full-english-light', name:'Light Full English (Grill/Non-stick)', cuisine:'UK', tags:['high-protein','quick','simple'], allergens:['egg','gluten (toast)*'], img:'', servings:1,
    macros:{kcal:520,p:36,c:42,f:20},
    adds:['eggs','turkey sausages','back bacon medallions','mushrooms','tomatoes','beans','toast'],
    ingredients:[{qty:2,unit:'',item:'eggs'},{qty:2,unit:'',item:'lean sausages'},{qty:2,unit:'',item:'bacon medallions'},{qty:100,unit:'g',item:'mushrooms'},{qty:1,unit:'',item:'tomato'},{qty:150,unit:'g',item:'baked beans'},{qty:1,unit:'slice',item:'toast'}],
    steps:['Grill sausages and bacon; pan-cook mushrooms and tomato.','Warm beans; fry eggs in non-stick.','Serve with toast.']},

  {k:'salmon-scramble', name:'Smoked Salmon and Scrambled Eggs', cuisine:'UK', tags:['high-protein','quick','gluten-free'], allergens:['egg','fish','dairy*'], img:'', servings:2,
    macros:{kcal:430,p:32,c:8,f:28},
    adds:['eggs','smoked salmon','chives','butter or oil'],
    ingredients:[{qty:4,unit:'',item:'eggs'},{qty:120,unit:'g',item:'smoked salmon'},{qty:1,unit:'tbsp',item:'chives (chopped)'},{qty:10,unit:'g',item:'butter or oil'}],
    steps:['Soft-scramble eggs in butter/oil.','Fold in salmon and chives off heat.']},

  {k:'prawn-pea-risotto', name:'Prawn and Pea Risotto (Stir-In Method)', cuisine:'UK', tags:['world','simple'], allergens:['crustacean','dairy*'], img:'', servings:4,
    macros:{kcal:520,p:28,c:72,f:12},
    adds:['risotto rice','prawns','peas','stock','parmesan'],
    ingredients:[{qty:320,unit:'g',item:'risotto rice'},{qty:300,unit:'g',item:'prawns (raw, peeled)'},{qty:150,unit:'g',item:'peas'},{qty:1,unit:'L',item:'hot stock'},{qty:30,unit:'g',item:'parmesan (grated)'}],
    steps:['Toast rice; add hot stock gradually, stirring.','Stir in prawns and peas near the end.','Finish with parmesan.']},

  {k:'veg-soup-batch', name:'Roasted Vegetable Soup (Batch)', cuisine:'UK', tags:['veg','budget','batch','gluten-free'], allergens:[], img:'', servings:6,
    macros:{kcal:190,p:6,c:32,f:4},
    adds:['mixed vegetables','onion','garlic','stock'],
    ingredients:[{qty:1.2,unit:'kg',item:'mixed veg (carrot, pepper, tomato, squash)'},{qty:1,unit:'',item:'onion'},{qty:3,unit:'cloves',item:'garlic'},{qty:1.2,unit:'L',item:'veg stock'}],
    steps:['Roast chopped veg until caramelised.','Blend with stock to smooth soup; season.']}
]);

addRecipes([
  {k:'laksa', name:'Quick Chicken Laksa', cuisine:'Malaysian', tags:['world','gluten-free*','quick'], allergens:['fish*','shellfish*','soy*'], img:'', servings:4,
    macros:{kcal:540,p:32,c:62,f:18},
    adds:['laksa paste','coconut milk','chicken','rice noodles','beansprouts','lime'],
    ingredients:[{qty:2,unit:'tbsp',item:'laksa paste'},{qty:1,unit:'tin',item:'coconut milk'},{qty:400,unit:'g',item:'chicken breast (sliced)'},{qty:300,unit:'g',item:'rice noodles (soaked)'},{qty:150,unit:'g',item:'beansprouts'},{qty:1,unit:'',item:'lime (wedges)'}],
    steps:['Fry paste; add chicken.','Add coconut milk and water; simmer.','Add noodles and sprouts; finish with lime.']},

  {k:'pho-beef', name:'Beef Pho (Weeknight Shortcut)', cuisine:'Vietnamese', tags:['world','gluten-free'], allergens:['soy*','fish*'], img:'', servings:4,
    macros:{kcal:510,p:34,c:68,f:10},
    adds:['rice noodles','thin beef','stock','star anise','cinnamon','ginger'],
    ingredients:[{qty:300,unit:'g',item:'rice noodles'},{qty:350,unit:'g',item:'beef sirloin (thinly sliced)'},{qty:1.2,unit:'L',item:'beef stock'},{qty:2,unit:'',item:'star anise'},{qty:1,unit:'stick',item:'cinnamon'},{qty:1,unit:'',item:'thumb ginger (charred)'}],
    steps:['Simmer stock with spices and charred ginger 20 minutes.','Cook noodles.','Ladle hot broth over raw thin beef and noodles; serve with herbs.']},

  {k:'mapo-tofu', name:'Mapo Tofu (Lean, Adjustable Heat)', cuisine:'Chinese', tags:['world','quick','gluten-free*'], allergens:['soy','sesame*','gluten*'], img:'', servings:4,
    macros:{kcal:420,p:28,c:28,f:20},
    adds:['silken/firm tofu','lean pork mince','doubanjiang','chilli oil','Sichuan pepper'],
    ingredients:[{qty:400,unit:'g',item:'tofu (firm or silken, cubed)'},{qty:300,unit:'g',item:'lean pork mince'},{qty:1,unit:'tbsp',item:'doubanjiang'},{qty:1,unit:'tsp',item:'chilli oil (to taste)'},{qty:0.5,unit:'tsp',item:'ground Sichuan pepper'}],
    steps:['Brown mince.','Fry doubanjiang briefly; add water.','Add tofu; simmer.','Finish with chilli oil and Sichuan pepper.']},

  {k:'shawarma-bowl', name:'Chicken Shawarma Bowl', cuisine:'Middle Eastern', tags:['world','high-protein','gluten-free*','quick'], allergens:['sesame*','dairy*'], img:'', servings:4,
    macros:{kcal:540,p:42,c:48,f:18},
    adds:['chicken','shawarma spice','yoghurt garlic sauce','rice or bulgur','salad'],
    ingredients:[{qty:800,unit:'g',item:'chicken thighs (strips)'},{qty:2,unit:'tbsp',item:'shawarma spice'},{qty:150,unit:'g',item:'yoghurt (garlic + lemon)'},{qty:600,unit:'g',item:'cooked rice or bulgur'},{qty:200,unit:'g',item:'salad veg'}],
    steps:['Marinate chicken in spice and a little yoghurt.','Pan-sear until charred.','Serve over grains with salad and sauce.']},

  {k:'jerk-chicken', name:'Jerk Chicken with Rice and Peas', cuisine:'Caribbean', tags:['world','high-protein','batch'], allergens:['soy*'], img:'', servings:5,
    macros:{kcal:600,p:44,c:68,f:16},
    adds:['chicken','jerk paste','rice','kidney beans','coconut milk','spring onion','thyme'],
    ingredients:[{qty:1.2,unit:'kg',item:'chicken pieces'},{qty:3,unit:'tbsp',item:'jerk paste'},{qty:400,unit:'g',item:'long-grain rice'},{qty:1,unit:'tin',item:'kidney beans'},{qty:1,unit:'tin',item:'coconut milk'},{qty:2,unit:'',item:'spring onions'},{qty:1,unit:'tsp',item:'thyme'}],
    steps:['Marinate and roast chicken.','Cook rice with coconut milk, thyme and beans.','Serve together.']},

  {k:'peri-peri-chicken', name:'Peri-Peri Chicken Traybake', cuisine:'Portuguese', tags:['world','high-protein','simple'], allergens:[], img:'', servings:4,
    macros:{kcal:520,p:42,c:30,f:22},
    adds:['chicken thigh','peri-peri marinade','peppers','onion','potatoes'],
    ingredients:[{qty:800,unit:'g',item:'chicken thighs'},{qty:3,unit:'tbsp',item:'peri-peri marinade'},{qty:2,unit:'',item:'peppers (chunks)'},{qty:1,unit:'',item:'onion (wedges)'},{qty:500,unit:'g',item:'potatoes (chunks)'}],
    steps:['Toss everything with marinade and oil.','Roast at 200°C for 35–40 minutes until charred and cooked.']},

  {k:'harira', name:'Harira (Moroccan Lentil and Chickpea Soup)', cuisine:'Moroccan', tags:['world','veg','budget','batch','gluten-free'], allergens:[], img:'', servings:6,
    macros:{kcal:300,p:16,c:48,f:6},
    adds:['lentils','chickpeas','tomato','celery','onion','spice mix'],
    ingredients:[{qty:200,unit:'g',item:'red or brown lentils'},{qty:1,unit:'tin',item:'chickpeas'},{qty:400,unit:'g',item:'tomatoes (tin)'},{qty:2,unit:'sticks',item:'celery (diced)'},{qty:1,unit:'',item:'onion (chopped)'},{qty:2,unit:'tsp',item:'cumin + paprika + cinnamon'}],
    steps:['Sauté aromatics.','Add legumes, tomato, spices and water; simmer until lentils are soft.']},

  {k:'shakshuka', name:'Shakshuka with Peppers', cuisine:'Middle Eastern', tags:['veg','world','gluten-free','simple'], allergens:['egg'], img:'', servings:3,
    macros:{kcal:360,p:20,c:22,f:20},
    adds:['eggs','tomato','peppers','onion','cumin','paprika'],
    ingredients:[{qty:6,unit:'',item:'eggs'},{qty:2,unit:'',item:'peppers (sliced)'},{qty:1,unit:'',item:'onion (sliced)'},{qty:400,unit:'g',item:'tomatoes (tin)'},{qty:1,unit:'tsp',item:'cumin'},{qty:1,unit:'tsp',item:'paprika'}],
    steps:['Simmer peppers, onion and tomatoes with spices.','Make wells; crack eggs; cover and cook until set.']}
]);

addRecipes([
  {k:'chole-bhature-lite', name:'Chole Masala (Lite; Serve with Flatbread)', cuisine:'Indian', tags:['veg','world','budget','batch','gluten-free*'], allergens:['gluten (with bhature/roti)*'], img:'', servings:5,
    macros:{kcal:460,p:18,c:70,f:10},
    adds:['chickpeas','onion','tomato','ginger garlic','chole masala'],
    ingredients:[{qty:2,unit:'tins',item:'chickpeas (drained)'},{qty:1,unit:'',item:'onion (chopped)'},{qty:2,unit:'',item:'tomatoes (pureed)'},{qty:1,unit:'tbsp',item:'ginger garlic paste'},{qty:2,unit:'tsp',item:'chole/channa masala mix'}],
    steps:['Sauté onion and ginger garlic.','Add tomato and masala; cook.','Add chickpeas; simmer to thick gravy.']},

  {k:'dal-makhnilite', name:'Dal Makhani (Lighter)', cuisine:'Indian', tags:['veg','world','batch','gluten-free'], allergens:['dairy*'], img:'', servings:6,
    macros:{kcal:460,p:24,c:60,f:12},
    adds:['whole urad','kidney beans','tomato','ginger garlic','butter or oil','cream or yoghurt'],
    ingredients:[{qty:300,unit:'g',item:'whole urad (black lentils)'},{qty:80,unit:'g',item:'kidney beans'},{qty:2,unit:'',item:'tomatoes (pureed)'},{qty:1,unit:'tbsp',item:'ginger garlic paste'},{qty:20,unit:'g',item:'butter or oil'},{qty:60,unit:'g',item:'cream or yoghurt'}],
    steps:['Slow-cook lentils and beans until soft.','Add tomato and aromatics; simmer long.','Finish with small amount of cream/yoghurt.']},

  {k:'dosa-sambar', name:'Crisp Dosa with Sambar (Shortcut Batter)', cuisine:'Indian (South)', tags:['veg','world','gluten-free*','simple'], allergens:['gluten*'], img:'', servings:4,
    macros:{kcal:520,p:16,c:92,f:10},
    adds:['ready dosa batter or rice-lentil batter','sambar mix','tamarind','mixed vegetables'],
    ingredients:[{qty:800,unit:'g',item:'dosa batter (ready or homemade)'},{qty:1,unit:'packet',item:'sambar spice mix'},{qty:1,unit:'tbsp',item:'tamarind paste'},{qty:300,unit:'g',item:'mixed vegetables (carrot, drumstick, aubergine)'}],
    steps:['Make sambar with vegetables, spice mix and tamarind.','Cook dosas thin and crisp on a hot pan; serve with sambar.']},

  {k:'paneer-tikka', name:'Oven Paneer Tikka', cuisine:'Indian', tags:['veg','world','high-protein','quick'], allergens:['dairy'], img:'', servings:4,
    macros:{kcal:520,p:34,c:18,f:32},
    adds:['paneer','yoghurt','tikka masala','peppers','onion'],
    ingredients:[{qty:500,unit:'g',item:'paneer (cubed)'},{qty:150,unit:'g',item:'yoghurt'},{qty:1,unit:'tbsp',item:'tikka spice'},{qty:2,unit:'',item:'peppers (chunks)'},{qty:1,unit:'',item:'onion (chunks)'}],
    steps:['Marinate paneer and veg.','Skewer or tray; roast at 220°C 12–15 minutes, turning once.']},

  {k:'veg-korma', name:'Vegetable Korma (Cashew-Lite)', cuisine:'Indian', tags:['veg','world','gluten-free'], allergens:['tree nuts*','dairy*'], img:'', servings:4,
    macros:{kcal:480,p:12,c:48,f:26},
    adds:['mixed vegetables','onion','ginger garlic','korma paste','light coconut milk'],
    ingredients:[{qty:500,unit:'g',item:'mixed vegetables'},{qty:1,unit:'',item:'onion'},{qty:1,unit:'tbsp',item:'ginger garlic paste'},{qty:2,unit:'tbsp',item:'korma paste'},{qty:1,unit:'tin',item:'light coconut milk'}],
    steps:['Sauté aromatics.','Add paste and vegetables; coat.','Pour coconut milk; simmer until tender.']},

  {k:'budget-dal-bowl', name:'Budget Lentil Bowl (Pickle and Yogurt)', cuisine:'Indian', tags:['veg','budget','gluten-free','simple'], allergens:['dairy*'], img:'', servings:4,
    macros:{kcal:520,p:24,c:86,f:8},
    adds:['red lentils','rice','onion','spices','yoghurt','pickle'],
    ingredients:[{qty:300,unit:'g',item:'red lentils'},{qty:320,unit:'g',item:'rice (cooked ~800 g)'},{qty:1,unit:'',item:'onion'},{qty:2,unit:'tsp',item:'turmeric + cumin'},{qty:150,unit:'g',item:'yoghurt'},{qty:50,unit:'g',item:'Indian pickle'}],
    steps:['Cook dal with onion and spices.','Serve over rice with yoghurt and pickle.']},

  {k:'tadka-broccoli', name:'Tadka Broccoli and Peas', cuisine:'Indian', tags:['veg','world','quick','gluten-free','simple'], allergens:[], img:'', servings:4,
    macros:{kcal:180,p:8,c:18,f:8},
    adds:['broccoli','peas','mustard seeds','curry leaves','chilli'],
    ingredients:[{qty:350,unit:'g',item:'broccoli florets'},{qty:150,unit:'g',item:'peas'},{qty:1,unit:'tsp',item:'mustard seeds'},{qty:8,unit:'',item:'curry leaves'},{qty:1,unit:'',item:'green chilli (optional)'}],
    steps:['Temper mustard seeds, curry leaves and chilli in hot oil.','Toss broccoli and peas until bright and crisp.']},

  {k:'kachumber', name:'Kachumber Salad', cuisine:'Indian', tags:['veg','world','quick','simple','gluten-free'], allergens:[], img:'', servings:4,
    macros:{kcal:90,p:3,c:14,f:3},
    adds:['cucumber','tomato','onion','lemon','cumin','coriander'],
    ingredients:[{qty:1,unit:'',item:'cucumber (diced)'},{qty:2,unit:'',item:'tomatoes (diced)'},{qty:0.5,unit:'',item:'onion (fine dice)'},{qty:1,unit:'',item:'lemon (juice)'},{qty:0.5,unit:'tsp',item:'ground cumin'},{qty:2,unit:'tbsp',item:'fresh coriander (chopped)'}],
    steps:['Combine all ingredients; season to taste.']}
]);

addRecipes([
  {k:'beef-bulgogi-bowl', name:'Beef Bulgogi Rice Bowl', cuisine:'Korean', tags:['world','high-protein','quick'], allergens:['soy','sesame','gluten*'], img:'', servings:4,
    macros:{kcal:560,p:34,c:70,f:16},
    adds:['beef','soy sauce','pear or apple','garlic','ginger','rice','spring onion'],
    ingredients:[{qty:700,unit:'g',item:'beef steak (thinly sliced)'},{qty:4,unit:'tbsp',item:'soy sauce'},{qty:0.5,unit:'',item:'pear or apple (grated)'},{qty:2,unit:'cloves',item:'garlic (minced)'},{qty:1,unit:'tsp',item:'ginger (grated)'},{qty:700,unit:'g',item:'cooked rice'},{qty:2,unit:'',item:'spring onions (sliced)'}],
    steps:['Marinate beef briefly.','Sear on high heat until caramelised.','Serve over rice with spring onion.']},

  {k:'prawn-biryani', name:'Prawn Biryani (Oven Finish)', cuisine:'Indian', tags:['world','gluten-free','batch'], allergens:['crustacean','dairy*'], img:'', servings:5,
    macros:{kcal:560,p:30,c:82,f:14},
    adds:['prawns','basmati rice','fried onion','yoghurt','biryani spices','mint'],
    ingredients:[{qty:500,unit:'g',item:'prawns (raw, peeled)'},{qty:400,unit:'g',item:'basmati rice (parboiled)'},{qty:150,unit:'g',item:'fried onions'},{qty:120,unit:'g',item:'yoghurt'},{qty:2,unit:'tbsp',item:'biryani spice mix'},{qty:0.5,unit:'cup',item:'mint + coriander (chopped)'}],
    steps:['Marinate prawns with yoghurt and spices.','Layer parboiled rice, prawns, herbs and onion.','Bake covered 20 minutes at 180°C.']},

  {k:'beef-chilli-con-carne', name:'Beef Chilli con Carne (Cocoa Hint)', cuisine:'Mexican/US', tags:['world','batch','gluten-free','high-protein'], allergens:[], img:'', servings:6,
    macros:{kcal:520,p:40,c:48,f:18},
    adds:['lean beef mince','kidney beans','tomatoes','onion','chilli','cumin','cocoa'],
    ingredients:[{qty:900,unit:'g',item:'lean beef mince'},{qty:1,unit:'tin',item:'kidney beans'},{qty:2,unit:'tins',item:'tomatoes'},{qty:1,unit:'',item:'onion'},{qty:2,unit:'tsp',item:'ground chilli + cumin'},{qty:1,unit:'tsp',item:'unsweetened cocoa'}],
    steps:['Brown mince with onion.','Add spices and tomatoes; simmer.','Add beans and cocoa; reduce until thick.']},

  {k:'med-chicken-pasta', name:'Mediterranean Chicken Pasta', cuisine:'Mediterranean', tags:['world','high-protein','simple'], allergens:['gluten (pasta)','dairy*'], img:'', servings:4,
    macros:{kcal:580,p:40,c:72,f:14},
    adds:['wholewheat pasta','chicken','cherry tomatoes','olives','feta','spinach'],
    ingredients:[{qty:320,unit:'g',item:'wholewheat pasta'},{qty:500,unit:'g',item:'chicken breast (chunks)'},{qty:200,unit:'g',item:'cherry tomatoes'},{qty:60,unit:'g',item:'olives (sliced)'},{qty:120,unit:'g',item:'feta (crumbled)'},{qty:150,unit:'g',item:'spinach'}],
    steps:['Cook pasta.','Pan-sear chicken.','Combine with tomatoes, olives, spinach and feta; loosen with pasta water.']},

  {k:'tofu-peanut-stirfry', name:'Tofu and Peanut Stir-Fry', cuisine:'Thai/Chinese', tags:['veg','world','quick','high-protein'], allergens:['soy','peanut','sesame*','gluten*'], img:'', servings:4,
    macros:{kcal:520,p:28,c:52,f:22},
    adds:['firm tofu','peanuts','soy sauce','chilli','garlic','veg mix','rice'],
    ingredients:[{qty:400,unit:'g',item:'firm tofu (pressed, cubed)'},{qty:60,unit:'g',item:'peanuts (toasted)'},{qty:3,unit:'tbsp',item:'soy sauce'},{qty:1,unit:'',item:'red chilli (sliced)'},{qty:2,unit:'cloves',item:'garlic (minced)'},{qty:400,unit:'g',item:'stir-fry vegetables'},{qty:600,unit:'g',item:'cooked rice'}],
    steps:['Fry tofu until crisp; set aside.','Stir-fry vegetables with garlic and chilli; add soy.','Return tofu and toss with peanuts.']},

  {k:'panzanella', name:'Panzanella (Tuscan Bread Salad)', cuisine:'Italian', tags:['veg','world','budget','simple'], allergens:['gluten','dairy*'], img:'', servings:4,
    macros:{kcal:420,p:12,c:46,f:18},
    adds:['stale bread','tomatoes','cucumber','onion','olive oil','vinegar'],
    ingredients:[{qty:250,unit:'g',item:'stale bread (chunks, lightly toasted)'},{qty:4,unit:'',item:'tomatoes (chopped)'},{qty:0.5,unit:'',item:'cucumber (chopped)'},{qty:0.5,unit:'',item:'red onion (thin slices)'},{qty:3,unit:'tbsp',item:'olive oil'},{qty:1,unit:'tbsp',item:'red wine vinegar'}],
    steps:['Combine all ingredients; let sit 15 minutes to soak flavours.']},

  {k:'spiced-lentil-sweet-pot', name:'Spiced Lentils over Sweet Potato', cuisine:'Global', tags:['veg','budget','gluten-free','simple'], allergens:[], img:'', servings:4,
    macros:{kcal:480,p:18,c:84,f:8},
    adds:['sweet potatoes','red lentils','onion','garam masala','yoghurt*'],
    ingredients:[{qty:4,unit:'',item:'sweet potatoes (baked)'},{qty:250,unit:'g',item:'red lentils'},{qty:1,unit:'',item:'onion (chopped)'},{qty:1,unit:'tbsp',item:'garam masala'},{qty:120,unit:'g',item:'yoghurt (optional)'}],
    steps:['Simmer lentils with onion and spices.','Split sweet potatoes; top with lentils and yoghurt.']},

  {k:'turkey-meatballs-tomato', name:'Turkey Meatballs in Tomato Sauce', cuisine:'Global', tags:['high-protein','simple','batch'], allergens:['egg*','gluten (breadcrumbs)*'], img:'', servings:5,
    macros:{kcal:480,p:42,c:32,f:18},
    adds:['turkey mince','breadcrumbs','egg','garlic','tomato passata','basil'],
    ingredients:[{qty:900,unit:'g',item:'turkey mince'},{qty:80,unit:'g',item:'breadcrumbs'},{qty:1,unit:'',item:'egg'},{qty:2,unit:'cloves',item:'garlic (minced)'},{qty:700,unit:'ml',item:'tomato passata'},{qty:10,unit:'leaves',item:'basil'}],
    steps:['Mix and shape meatballs; bake 12–14 minutes at 220°C.','Simmer passata with garlic; add meatballs; finish with basil.']}
]);
  
addRecipes([
  {k:'protein-banana-pancakes', name:'Protein Banana Pancakes', cuisine:'UK', tags:['high-protein','quick','simple'], allergens:['egg','gluten (oats*)','dairy*'], img:'', servings:1,
    macros:{kcal:430,p:32,c:48,f:12},
    adds:['banana','eggs','oats','protein powder','yoghurt or alternative'],
    ingredients:[{qty:1,unit:'',item:'ripe banana (mashed)'},{qty:2,unit:'',item:'eggs'},{qty:40,unit:'g',item:'oats (blended to flour)'},{qty:20,unit:'g',item:'protein powder (optional)'},{qty:80,unit:'g',item:'yoghurt or alternative (to serve)'}],
    steps:['Blend banana, eggs, oats, protein into a batter.','Cook small pancakes on a non-stick pan 1–2 min each side.','Serve with yoghurt.']},

  {k:'mackerel-avo-rye', name:'Smoked Mackerel and Avocado on Rye', cuisine:'UK', tags:['high-protein','quick','simple','omega-3'], allergens:['fish','gluten (rye)'], img:'', servings:1,
    macros:{kcal:520,p:30,c:32,f:28},
    adds:['smoked mackerel','avocado','rye bread','lemon','black pepper'],
    ingredients:[{qty:80,unit:'g',item:'smoked mackerel (flaked)'},{qty:0.5,unit:'',item:'avocado (sliced)'},{qty:2,unit:'slices',item:'rye bread (toasted)'},{qty:1,unit:'',item:'lemon wedge'},{qty:1,unit:'pinch',item:'black pepper'}],
    steps:['Toast rye.','Top with avocado and mackerel.','Squeeze lemon and season.']},

  {k:'tofu-scramble-wrap', name:'Tofu Scramble Breakfast Wrap', cuisine:'Global', tags:['vegan','high-protein','quick','simple'], allergens:['gluten (wrap)','soy'], img:'', servings:1,
    macros:{kcal:450,p:28,c:50,f:14},
    adds:['firm tofu','wrap','turmeric','spinach','tomato'],
    ingredients:[{qty:150,unit:'g',item:'firm tofu (crumbled)'},{qty:1,unit:'',item:'wrap'},{qty:0.25,unit:'tsp',item:'turmeric'},{qty:1,unit:'handful',item:'spinach'},{qty:1,unit:'',item:'tomato (diced)'}],
    steps:['Sauté tofu with turmeric and a little salt.','Wilt in spinach.','Wrap with tomato; roll and serve.']},

  {k:'cottage-berry-seed-bowl', name:'Cottage Cheese, Berries and Seeds Bowl', cuisine:'UK', tags:['high-protein','quick','simple'], allergens:['dairy'], img:'', servings:1,
    macros:{kcal:360,p:34,c:28,f:12},
    adds:['cottage cheese','mixed berries','mixed seeds','honey*'],
    ingredients:[{qty:200,unit:'g',item:'cottage cheese'},{qty:120,unit:'g',item:'mixed berries'},{qty:15,unit:'g',item:'mixed seeds'},{qty:1,unit:'tsp',item:'honey (optional)'}],
    steps:['Bowl cottage cheese.','Top with berries and seeds.','Drizzle honey if using.']}
]);
  
  addRecipes([
  {k:'quinoa-chickpea-roastveg', name:'Quinoa, Chickpea and Roast Veg Bowl', cuisine:'Mediterranean', tags:['veg','high-fibre','world','simple','gluten-free'], allergens:[], img:'', servings:3,
    macros:{kcal:520,p:20,c:78,f:14},
    adds:['quinoa','chickpeas','courgette','pepper','olive oil','lemon'],
    ingredients:[{qty:240,unit:'g',item:'cooked quinoa (~80 g dry)'},{qty:1,unit:'tin',item:'chickpeas (drained)'},{qty:1,unit:'',item:'courgette (chunks)'},{qty:1,unit:'',item:'red pepper (chunks)'},{qty:1,unit:'tbsp',item:'olive oil'},{qty:0.5,unit:'',item:'lemon (juice)'}],
    steps:['Roast veg with oil 20–25 min.','Toss quinoa, veg and chickpeas.','Finish with lemon and salt.']},

  {k:'salmon-nicoise', name:'Salmon Niçoise Salad', cuisine:'French', tags:['high-protein','omega-3','world','gluten-free','simple'], allergens:['fish','egg'], img:'', servings:2,
    macros:{kcal:530,p:36,c:30,f:28},
    adds:['salmon','eggs','green beans','potatoes','olives','leafy greens'],
    ingredients:[{qty:2,unit:'',item:'eggs (boiled, halved)'},{qty:240,unit:'g',item:'salmon fillets (baked or pan-seared)'},{qty:150,unit:'g',item:'new potatoes (boiled, halved)'},{qty:120,unit:'g',item:'green beans (blanched)'},{qty:40,unit:'g',item:'olives'},{qty:2,unit:'cups',item:'mixed leaves'}],
    steps:['Cook salmon and eggs.','Assemble with beans, potatoes, olives and leaves.','Dress with lemon/olive oil.']},

  {k:'spicy-paneer-wrap', name:'Spicy Paneer Veg Wrap', cuisine:'Indian', tags:['veg','high-protein','world','quick'], allergens:['dairy','gluten (wrap)'], img:'', servings:1,
    macros:{kcal:520,p:30,c:52,f:18},
    adds:['paneer','wrap','peppers','onion','tikka seasoning','yoghurt*'],
    ingredients:[{qty:120,unit:'g',item:'paneer (strips)'},{qty:1,unit:'',item:'wrap'},{qty:0.5,unit:'',item:'onion (sliced)'},{qty:0.5,unit:'',item:'pepper (sliced)'},{qty:1,unit:'tsp',item:'tikka spice'},{qty:1,unit:'tbsp',item:'yoghurt (optional)'}],
    steps:['Sear paneer with veg and tikka spice.','Fill wrap; add yoghurt if using; roll.']},

  {k:'sardine-bean-salad', name:'Sardine and Cannellini Bean Salad', cuisine:'Mediterranean', tags:['budget','high-protein','omega-3','quick','gluten-free'], allergens:['fish'], img:'', servings:2,
    macros:{kcal:480,p:34,c:36,f:20},
    adds:['tinned sardines','cannellini beans','red onion','parsley','lemon'],
    ingredients:[{qty:1,unit:'tin',item:'sardines (in olive oil, drained)'},{qty:1,unit:'tin',item:'cannellini beans (rinsed)'},{qty:0.25,unit:'',item:'red onion (thinly sliced)'},{qty:2,unit:'tbsp',item:'parsley (chopped)'},{qty:0.5,unit:'',item:'lemon (juice)'}],
    steps:['Combine all ingredients.','Season with salt, pepper and lemon.']}
]);

  addRecipes([
  {k:'baked-salmon-newpot-greens', name:'Baked Salmon, New Potatoes and Greens', cuisine:'UK', tags:['high-protein','omega-3','gluten-free','simple'], allergens:['fish'], img:'', servings:2,
    macros:{kcal:560,p:38,c:46,f:22},
    adds:['salmon','new potatoes','tenderstem broccoli','lemon','dill*'],
    ingredients:[{qty:2,unit:'',item:'salmon fillets'},{qty:300,unit:'g',item:'new potatoes (halved)'},{qty:200,unit:'g',item:'tenderstem broccoli'},{qty:1,unit:'',item:'lemon (slices)'},{qty:1,unit:'tsp',item:'dill (optional)'}],
    steps:['Roast potatoes 20 min at 200°C.','Add salmon and broccoli; bake 10–12 min.','Finish with lemon and dill.']},

  {k:'turkey-kofta-bulgur', name:'Turkey Kofta with Bulgur and Salad', cuisine:'Middle Eastern', tags:['high-protein','world','simple'], allergens:['gluten (bulgur)'], img:'', servings:4,
    macros:{kcal:540,p:40,c:60,f:14},
    adds:['turkey mince','spice mix','bulgur','tomato','cucumber','yoghurt*'],
    ingredients:[{qty:600,unit:'g',item:'turkey mince'},{qty:2,unit:'tsp',item:'ground cumin + coriander'},{qty:240,unit:'g',item:'bulgur (cooked ~600 g)'},{qty:2,unit:'',item:'tomatoes (chopped)'},{qty:0.5,unit:'',item:'cucumber (chopped)'},{qty:120,unit:'g',item:'yoghurt (to serve, optional)'}],
    steps:['Season and shape koftas; grill/pan-sear.','Cook bulgur.','Serve koftas with bulgur, salad and yoghurt.']},

  {k:'aubergine-chickpea-tagine', name:'Aubergine and Chickpea Tagine (Couscous)', cuisine:'Moroccan', tags:['vegan','world','high-fibre','budget'], allergens:['gluten (couscous)'], img:'', servings:4,
    macros:{kcal:520,p:16,c:84,f:12},
    adds:['aubergine','chickpeas','tomatoes','apricots','cinnamon','couscous'],
    ingredients:[{qty:2,unit:'',item:'aubergines (chunks)'},{qty:1,unit:'tin',item:'chickpeas'},{qty:1,unit:'tin',item:'tomatoes'},{qty:40,unit:'g',item:'dried apricots (chopped)'},{qty:1,unit:'tsp',item:'cinnamon'},{qty:280,unit:'g',item:'couscous (cooked ~600 g)'}],
    steps:['Sauté aubergine.','Simmer with tomatoes, chickpeas, apricots and cinnamon.','Serve over couscous.']},

  {k:'prawn-cashew-stirfry', name:'Prawn, Veg and Cashew Stir-Fry with Brown Rice', cuisine:'Chinese', tags:['high-protein','world','gluten-free*','quick'], allergens:['crustacean','tree nuts','soy*'], img:'', servings:3,
    macros:{kcal:540,p:34,c:66,f:16},
    adds:['prawns','mixed veg','cashews','brown rice','soy sauce*','garlic'],
    ingredients:[{qty:400,unit:'g',item:'prawns (raw, peeled)'},{qty:400,unit:'g',item:'stir-fry veg mix'},{qty:50,unit:'g',item:'cashews (toasted)'},{qty:600,unit:'g',item:'cooked brown rice'},{qty:2,unit:'tbsp',item:'soy sauce (or tamari)'},
      {qty:2,unit:'cloves',item:'garlic (minced)'}],
    steps:['Stir-fry veg and garlic, add prawns until pink.','Toss with soy and cashews.','Serve over brown rice.']}
]);

  addRecipes([
  {k:'ginger-soy-chicken-soba', name:'Ginger-Soy Chicken with Soba Noodles', cuisine:'Japanese', tags:['world','high-protein','endurance','quick'], allergens:['soy','gluten (soba)*','sesame*'], img:'', servings:3,
    macros:{kcal:620,p:38,c:86,f:12},
    adds:['chicken breast','soba noodles','soy sauce','ginger','spring onion','sesame oil*'],
    ingredients:[{qty:450,unit:'g',item:'chicken breast (strips)'},{qty:270,unit:'g',item:'soba noodles (dry)'},{qty:3,unit:'tbsp',item:'soy sauce'},{qty:1,unit:'tbsp',item:'ginger (grated)'},{qty:2,unit:'',item:'spring onions (sliced)'},{qty:1,unit:'tsp',item:'sesame oil (optional)'}],
    steps:['Cook soba.','Stir-fry chicken; add soy and ginger.','Toss through noodles and spring onion; finish with sesame oil.']},

  {k:'chicken-arrabbiata-pasta', name:'Chicken Arrabbiata Wholewheat Pasta', cuisine:'Italian', tags:['world','high-protein','endurance','simple'], allergens:['gluten (pasta)'], img:'', servings:4,
    macros:{kcal:640,p:42,c:92,f:12},
    adds:['wholewheat pasta','chicken','passata','chilli flakes','garlic'],
    ingredients:[{qty:360,unit:'g',item:'wholewheat pasta'},{qty:600,unit:'g',item:'chicken breast (chunks)'},{qty:500,unit:'ml',item:'passata'},{qty:1,unit:'tsp',item:'chilli flakes'},{qty:2,unit:'cloves',item:'garlic (minced)'}],
    steps:['Cook pasta.','Sear chicken; add garlic, chilli and passata.','Simmer; toss with pasta and a splash of pasta water.']},

  {k:'sweetpot-blackbean-burritos', name:'Sweet Potato and Black Bean Burritos', cuisine:'Mexican', tags:['vegan','world','endurance','high-fibre','batch'], allergens:['gluten (wrap)'], img:'', servings:4,
    macros:{kcal:620,p:20,c:98,f:14},
    adds:['tortilla wraps','sweet potatoes','black beans','corn','spices'],
    ingredients:[{qty:4,unit:'',item:'large wraps'},{qty:600,unit:'g',item:'sweet potatoes (roasted cubes)'},{qty:1,unit:'tin',item:'black beans (rinsed)'},{qty:1,unit:'tin',item:'sweetcorn (drained)'},{qty:2,unit:'tsp',item:'cumin + smoked paprika'}],
    steps:['Roast sweet potato.','Combine with beans, corn and spices.','Fill and roll warm wraps.']},

  {k:'high-protein-rice-pud', name:'High-Protein Rice Pudding (Skyr)', cuisine:'UK', tags:['endurance','simple'], allergens:['dairy'], img:'', servings:3,
    macros:{kcal:480,p:24,c:78,f:6},
    adds:['pudding rice','milk','skyr or high-protein yoghurt','vanilla'],
    ingredients:[{qty:150,unit:'g',item:'pudding rice'},{qty:700,unit:'ml',item:'semi-skimmed milk or alt'},{qty:250,unit:'g',item:'skyr or high-protein yoghurt (stir in at end)'},{qty:0.5,unit:'tsp',item:'vanilla'}],
    steps:['Simmer rice in milk until creamy.','Cool slightly; stir in skyr and vanilla.']}
]);

  addRecipes([
  {k:'hummus-snack-box', name:'Hummus Snack Box (Veg and Pitta)', cuisine:'Levant', tags:['veg','quick','simple','budget'], allergens:['sesame','gluten (pitta)*'], img:'', servings:2,
    macros:{kcal:420,p:14,c:52,f:16},
    adds:['hummus','carrot','cucumber','cherry tomatoes','pitta'],
    ingredients:[{qty:120,unit:'g',item:'hummus'},{qty:2,unit:'',item:'carrots (sticks)'},{qty:0.5,unit:'',item:'cucumber (sticks)'},{qty:150,unit:'g',item:'cherry tomatoes'},{qty:2,unit:'',item:'small pittas (warm)'}],
    steps:['Pack veg and hummus into a box.','Warm pitta; cut into strips; serve for dipping.']},

  {k:'pb-banana-bagel', name:'Peanut Butter Banana Bagel', cuisine:'UK/US', tags:['endurance','quick','budget','simple'], allergens:['peanut','gluten (bagel)'], img:'', servings:1,
    macros:{kcal:520,p:18,c:74,f:16},
    adds:['wholewheat bagel','peanut butter','banana','cinnamon*'],
    ingredients:[{qty:1,unit:'',item:'wholewheat bagel (toasted)'},{qty:2,unit:'tbsp',item:'peanut butter'},{qty:1,unit:'',item:'banana (sliced)'},{qty:1,unit:'pinch',item:'cinnamon (optional)'}],
    steps:['Toast bagel.','Spread peanut butter; top with banana.','Dust cinnamon if using.']},

  {k:'tuna-bean-pot', name:'Tuna, Bean and Sweet Pepper Pot', cuisine:'UK', tags:['high-protein','budget','quick','gluten-free'], allergens:['fish'], img:'', servings:2,
    macros:{kcal:420,p:36,c:36,f:12},
    adds:['tuna','mixed beans','roasted peppers (jar)','parsley','lemon'],
    ingredients:[{qty:1,unit:'tin',item:'tuna (drained)'},{qty:1,unit:'tin',item:'mixed beans (rinsed)'},{qty:80,unit:'g',item:'roasted red peppers (strips)'},{qty:1,unit:'tbsp',item:'parsley (chopped)'},{qty:0.5,unit:'',item:'lemon (juice)'}],
    steps:['Combine all ingredients in a bowl.','Season to taste; chill or eat straight away.']},

  {k:'chia-cocoa-overnight', name:'Chia Cocoa Overnight Pudding', cuisine:'Global', tags:['vegan','high-fibre','quick','simple'], allergens:[], img:'', servings:2,
    macros:{kcal:320,p:10,c:32,f:16},
    adds:['chia seeds','plant milk','cocoa powder','maple syrup*'],
    ingredients:[{qty:50,unit:'g',item:'chia seeds'},{qty:300,unit:'ml',item:'plant milk'},{qty:1,unit:'tbsp',item:'cocoa powder'},{qty:1,unit:'tbsp',item:'maple syrup (optional)'}],
    steps:['Stir everything in a jar.','Chill at least 2 hours or overnight; stir before serving.']}
]);

  addRecipes([
  {k:'bk-protein-granola-skyr', name:'Protein Granola with Skyr and Berries', cuisine:'UK', tags:['high-protein','simple','quick'], allergens:['dairy','gluten (granola)*','nuts*'], img:'', servings:1,
    macros:{kcal:420,p:30,c:48,f:10},
    adds:['skyr','high-protein granola','berries','honey*'],
    ingredients:[{qty:200,unit:'g',item:'skyr'},{qty:50,unit:'g',item:'granola'},{qty:100,unit:'g',item:'mixed berries'},{qty:1,unit:'tsp',item:'honey (optional)'}],
    steps:['Bowl skyr.','Top with granola and berries.','Drizzle honey if using.']},

  {k:'bk-sav-porridge-egg', name:'Savoury Oats with Spinach and Fried Egg', cuisine:'UK', tags:['veg','high-fibre','quick'], allergens:['egg','gluten (oats*)','dairy*'], img:'', servings:1,
    macros:{kcal:380,p:20,c:44,f:12},
    adds:['oats','spinach','egg','parmesan*'],
    ingredients:[{qty:50,unit:'g',item:'oats'},{qty:250,unit:'ml',item:'water or stock'},{qty:1,unit:'',item:'egg'},{qty:1,unit:'handful',item:'spinach'},{qty:10,unit:'g',item:'parmesan (optional)'}],
    steps:['Cook oats in water/stock.','Wilt spinach in.','Top with fried egg and parmesan.']}
]);

  addRecipes([
  {k:'bk-poha-peas', name:'Poha with Peas and Peanuts', cuisine:'Indian', tags:['veg','world','quick'], allergens:['peanut'], img:'', servings:2,
    macros:{kcal:420,p:12,c:64,f:12},
    adds:['poha (beaten rice)','peas','peanuts','turmeric','lemon'],
    ingredients:[{qty:160,unit:'g',item:'poha (rinsed, drained)'},{qty:100,unit:'g',item:'peas'},{qty:30,unit:'g',item:'peanuts'},{qty:0.5,unit:'tsp',item:'turmeric'},{qty:1,unit:'',item:'lemon (wedges)'}],
    steps:['Temper spices and peanuts.','Stir in peas and poha to heat.','Finish with lemon.']},

  {k:'bk-labneh-zataar-flat', name:'Labneh and Za’atar Flatbread', cuisine:'Levant', tags:['veg','simple','quick'], allergens:['dairy','gluten (flatbread)'], img:'', servings:2,
    macros:{kcal:430,p:18,c:52,f:16},
    adds:['flatbread','labneh or thick yoghurt','za’atar','olive oil'],
    ingredients:[{qty:2,unit:'',item:'flatbreads'},{qty:200,unit:'g',item:'labneh or thick yoghurt'},{qty:2,unit:'tsp',item:'za’atar'},{qty:2,unit:'tsp',item:'olive oil'}],
    steps:['Warm flatbreads.','Spread labneh, sprinkle za’atar.','Drizzle oil and serve.']}
]);

  addRecipes([
  {k:'lnch-chicken-grain-bowl', name:'Roast Chicken Grain Bowl with Greens', cuisine:'UK', tags:['high-protein','simple'], allergens:['gluten (some grains)*'], img:'', servings:2,
    macros:{kcal:560,p:42,c:56,f:16},
    adds:['cooked grains (quinoa/bulgur)','roast chicken','spinach','lemon'],
    ingredients:[{qty:300,unit:'g',item:'cooked grains'},{qty:250,unit:'g',item:'roast chicken (shredded)'},{qty:2,unit:'handfuls',item:'spinach'},{qty:1,unit:'',item:'lemon (juice)'}],
    steps:['Toss warm grains with spinach to wilt.','Top with chicken.','Dress with lemon, salt and pepper.']},

  {k:'lnch-egg-mayo-yoghurt-sand', name:'Lighter Egg Mayo Sandwich (Yoghurt Mix)', cuisine:'UK', tags:['budget','simple','quick'], allergens:['egg','gluten (bread)','dairy*'], img:'', servings:1,
    macros:{kcal:420,p:22,c:48,f:12},
    adds:['eggs','wholemeal bread','yoghurt','light mayo','chives'],
    ingredients:[{qty:2,unit:'',item:'eggs (boiled, chopped)'},{qty:2,unit:'slices',item:'wholemeal bread'},{qty:1,unit:'tbsp',item:'yoghurt'},{qty:1,unit:'tsp',item:'light mayo'},{qty:1,unit:'tbsp',item:'chives (chopped)'}],
    steps:['Mix eggs with yoghurt, mayo, chives.','Season and fill sandwich.']}
]);

  addRecipes([
  {k:'lnch-lentil-feta-salad', name:'Brown Lentil, Feta and Herb Salad', cuisine:'Mediterranean', tags:['veg','high-fibre','simple'], allergens:['dairy'], img:'', servings:3,
    macros:{kcal:480,p:22,c:56,f:16},
    adds:['brown lentils','feta','parsley','tomato','olive oil','lemon'],
    ingredients:[{qty:450,unit:'g',item:'cooked brown lentils'},{qty:120,unit:'g',item:'feta (crumbled)'},{qty:0.5,unit:'cup',item:'parsley (chopped)'},{qty:2,unit:'',item:'tomatoes (diced)'},{qty:1,unit:'tbsp',item:'olive oil'},{qty:0.5,unit:'',item:'lemon (juice)'}],
    steps:['Toss all ingredients.','Season well.']},

  {k:'lnch-chicken-gyro-bowl', name:'Chicken Gyro Bowl (Rice or Pitta)', cuisine:'Greek', tags:['high-protein','world'], allergens:['dairy*','gluten (pitta)*'], img:'', servings:3,
    macros:{kcal:560,p:40,c:60,f:16},
    adds:['chicken','oregano','garlic','rice or pitta','yoghurt-cucumber'],
    ingredients:[{qty:600,unit:'g',item:'chicken thighs (strips)'},{qty:1,unit:'tsp',item:'oregano'},{qty:2,unit:'cloves',item:'garlic (minced)'},{qty:600,unit:'g',item:'cooked rice or warm pittas'},{qty:150,unit:'g',item:'yoghurt + cucumber (tzatziki-style)'}],
    steps:['Marinate and pan-sear chicken.','Serve with rice/pitta and yoghurt-cucumber.']}
]);

  addRecipes([
  {k:'dnr-chicken-tikka-skillet', name:'Skillet Chicken Tikka (Yoghurt Marinade)', cuisine:'Indian', tags:['high-protein','world','gluten-free'], allergens:['dairy'], img:'', servings:4,
    macros:{kcal:520,p:44,c:18,f:28},
    adds:['chicken breast','yoghurt','tikka spice','garlic','lemon'],
    ingredients:[{qty:800,unit:'g',item:'chicken breast (chunks)'},{qty:200,unit:'g',item:'yoghurt'},{qty:1,unit:'tbsp',item:'tikka spice'},{qty:2,unit:'cloves',item:'garlic (minced)'},{qty:0.5,unit:'',item:'lemon (juice)'}],
    steps:['Marinate chicken at least 20 minutes.','Sear in a hot pan until charred and cooked.']},

  {k:'dnr-chana-saag', name:'Chana Saag (Chickpeas with Spinach)', cuisine:'Indian', tags:['vegan','world','high-fibre','budget','batch'], allergens:[], img:'', servings:4,
    macros:{kcal:460,p:20,c:64,f:12},
    adds:['chickpeas','spinach','onion','tomato','garam masala'],
    ingredients:[{qty:2,unit:'tins',item:'chickpeas (drained)'},{qty:300,unit:'g',item:'spinach'},{qty:1,unit:'',item:'onion (chopped)'},{qty:1,unit:'tin',item:'tomatoes'},{qty:1,unit:'tsp',item:'garam masala'}],
    steps:['Sauté onion and spices.','Add tomato and chickpeas; simmer.','Wilt in spinach.']}
]);

  addRecipes([
  {k:'dnr-ginger-cod-rice', name:'Steamed Ginger Cod with Rice and Pak Choi', cuisine:'Chinese', tags:['high-protein','gluten-free','simple'], allergens:['fish','soy*'], img:'', servings:2,
    macros:{kcal:480,p:38,c:60,f:10},
    adds:['cod','ginger','spring onion','soy or tamari','rice','pak choi'],
    ingredients:[{qty:2,unit:'',item:'cod fillets'},{qty:1,unit:'tbsp',item:'ginger (matchsticks)'},{qty:2,unit:'',item:'spring onions (sliced)'},{qty:1,unit:'tbsp',item:'soy sauce or tamari'},{qty:300,unit:'g',item:'cooked rice'},{qty:200,unit:'g',item:'pak choi (steamed)'}],
    steps:['Steam cod with ginger.','Pour a little hot oil and soy over.','Serve with rice and pak choi.']},

  {k:'dnr-chicken-katsu-baked', name:'Baked Chicken Katsu with Cabbage and Rice', cuisine:'Japanese', tags:['high-protein','world','endurance'], allergens:['gluten (crumbs)','egg'], img:'', servings:3,
    macros:{kcal:620,p:42,c:78,f:14},
    adds:['chicken breast','breadcrumbs','egg','rice','cabbage','katsu sauce*'],
    ingredients:[{qty:450,unit:'g',item:'chicken breast (butterflied)'},{qty:60,unit:'g',item:'breadcrumbs'},{qty:1,unit:'',item:'egg (beaten)'},{qty:600,unit:'g',item:'cooked rice'},{qty:200,unit:'g',item:'cabbage (shredded)'}],
    steps:['Coat chicken in egg and crumbs.','Bake at 220°C 14–16 minutes.','Slice and serve with rice and cabbage.']}
]);

  addRecipes([
  {k:'end-penne-tuna-tomato', name:'Penne with Tuna, Tomato and Capers', cuisine:'Italian', tags:['endurance','high-protein','simple'], allergens:['fish','gluten (pasta)'], img:'', servings:4,
    macros:{kcal:640,p:36,c:94,f:12},
    adds:['penne','tuna','passata','capers','parsley'],
    ingredients:[{qty:360,unit:'g',item:'penne'},{qty:2,unit:'tins',item:'tuna (drained)'},{qty:500,unit:'ml',item:'passata'},{qty:1,unit:'tbsp',item:'capers'},{qty:2,unit:'tbsp',item:'parsley (chopped)'}],
    steps:['Cook penne.','Simmer passata with capers, add tuna.','Toss pasta and parsley.']},

  {k:'end-chicken-rice-onepot', name:'One-Pot Chicken and Rice', cuisine:'Global', tags:['endurance','high-protein','simple'], allergens:[], img:'', servings:4,
    macros:{kcal:650,p:42,c:92,f:12},
    adds:['chicken thighs','rice','onion','peas','stock'],
    ingredients:[{qty:700,unit:'g',item:'chicken thighs (boneless, chunks)'},{qty:300,unit:'g',item:'rice'},{qty:1,unit:'',item:'onion (chopped)'},{qty:150,unit:'g',item:'peas'},{qty:800,unit:'ml',item:'stock'}],
    steps:['Sauté onion and chicken.','Add rice and stock; simmer until tender.','Stir in peas to finish.']}
]);

  addRecipes([
  {k:'snk-cottage-crackers', name:'Cottage Cheese, Cucumber and Crackers', cuisine:'UK', tags:['high-protein','quick','simple'], allergens:['dairy','gluten (crackers)*'], img:'', servings:1,
    macros:{kcal:260,p:22,c:22,f:8},
    adds:['cottage cheese','cucumber','wholegrain crackers','pepper'],
    ingredients:[{qty:150,unit:'g',item:'cottage cheese'},{qty:0.25,unit:'',item:'cucumber (sliced)'},{qty:3,unit:'',item:'wholegrain crackers'}],
    steps:['Top crackers with cottage cheese and cucumber.','Season with pepper.']},

  {k:'snk-apple-nut-butter', name:'Apple with Almond or Peanut Butter', cuisine:'Global', tags:['simple','quick','high-fibre'], allergens:['tree nuts*','peanut*'], img:'', servings:1,
    macros:{kcal:220,p:6,c:28,f:10},
    adds:['apple','nut butter'],
    ingredients:[{qty:1,unit:'',item:'apple (sliced)'},{qty:1,unit:'tbsp',item:'almond or peanut butter'}],
    steps:['Slice apple.','Dip in nut butter.']}
]);

addRecipes([
  {k:'bk-bagel-egg-white', name:'Egg White Bagel with Light Cheese', cuisine:'UK/US', tags:['high-protein','endurance','quick'], allergens:['egg','gluten (bagel)','dairy*'], img:'', servings:1,
    macros:{kcal:460,p:32,c:62,f:10},
    adds:['bagel','egg whites','light cream cheese','spinach'],
    ingredients:[{qty:1,unit:'',item:'bagel (toasted)'},{qty:150,unit:'ml',item:'egg whites'},{qty:30,unit:'g',item:'light cream cheese'},{qty:1,unit:'handful',item:'spinach'}],
    steps:['Scramble egg whites with spinach.','Fill toasted bagel with eggs and cheese.']},

  {k:'bk-overnight-oats-choc', name:'Chocolate Overnight Oats (High Protein)', cuisine:'UK', tags:['endurance','high-protein','simple'], allergens:['dairy*','gluten (oats*)'], img:'', servings:1,
    macros:{kcal:520,p:34,c:68,f:12},
    adds:['oats','milk or alternative','protein powder','cocoa','banana'],
    ingredients:[{qty:70,unit:'g',item:'oats'},{qty:220,unit:'ml',item:'milk or alternative'},{qty:25,unit:'g',item:'protein powder'},{qty:1,unit:'tbsp',item:'cocoa'},{qty:0.5,unit:'',item:'banana (sliced)'}],
    steps:['Combine oats, milk, protein, cocoa in jar.','Chill overnight; top with banana.']}
]);

  addRecipes([
  {k:'lnch-bun-kebab-lite', name:'Bun Kebab (Lighter, Pan-Seared)', cuisine:'Pakistani', tags:['world','simple'], allergens:['gluten (bun)','egg*'], img:'', servings:2,
    macros:{kcal:540,p:32,c:60,f:18},
    adds:['bun','lean mince patty or lentil patty','onion','chutney'],
    ingredients:[{qty:2,unit:'',item:'buns'},{qty:300,unit:'g',item:'lean beef or lentil patties'},{qty:0.5,unit:'',item:'onion (sliced)'},{qty:2,unit:'tbsp',item:'green chutney'}],
    steps:['Pan-sear patties.','Assemble with onions and chutney.']},

  {k:'lnch-paneer-bhurji-roll', name:'Paneer Bhurji Roll', cuisine:'Indian', tags:['veg','high-protein','world','quick'], allergens:['dairy','gluten (wrap)'], img:'', servings:2,
    macros:{kcal:520,p:30,c:54,f:18},
    adds:['paneer','onion','tomato','spices','wrap'],
    ingredients:[{qty:250,unit:'g',item:'paneer (crumbled)'},{qty:1,unit:'',item:'onion (chopped)'},{qty:1,unit:'',item:'tomato (chopped)'},{qty:1,unit:'tsp',item:'garam masala'},{qty:2,unit:'',item:'wraps'}],
    steps:['Sauté onion and tomato; add paneer and spices.','Fill wraps and roll.']}
]);

  addRecipes([
  {k:'dnr-lamb-kofte-tabbouleh', name:'Lamb Kofte with Herby Tabbouleh', cuisine:'Levant', tags:['world','simple'], allergens:['gluten (bulgur)'], img:'', servings:4,
    macros:{kcal:560,p:32,c:58,f:20},
    adds:['lamb mince','bulgur','parsley','tomato','lemon'],
    ingredients:[{qty:600,unit:'g',item:'lamb mince'},{qty:240,unit:'g',item:'bulgur (cooked ~600 g)'},{qty:0.5,unit:'cup',item:'parsley (chopped)'},{qty:2,unit:'',item:'tomatoes (diced)'},{qty:1,unit:'',item:'lemon (juice)'}],
    steps:['Season and grill kofte.','Make tabbouleh with bulgur, parsley, tomato, lemon.','Serve together.']},

  {k:'dnr-harissa-chicken-tray', name:'Harissa Chicken Traybake with Veg', cuisine:'North African', tags:['high-protein','simple','batch'], allergens:[], img:'', servings:4,
    macros:{kcal:540,p:42,c:34,f:22},
    adds:['chicken thighs','harissa','peppers','onion','courgette'],
    ingredients:[{qty:800,unit:'g',item:'chicken thighs'},{qty:2,unit:'tbsp',item:'harissa paste'},{qty:2,unit:'',item:'peppers (chunks)'},{qty:1,unit:'',item:'onion (wedges)'},{qty:1,unit:'',item:'courgette (chunks)'}],
    steps:['Toss everything with harissa and oil.','Roast at 200°C for 35–40 minutes.']}
]);

  addRecipes([
  {k:'dnr-lean-bangers-mash', name:'Lean Bangers and Mash with Onion Gravy', cuisine:'UK', tags:['simple','high-protein'], allergens:['gluten*','dairy*'], img:'', servings:3,
    macros:{kcal:560,p:34,c:64,f:16},
    adds:['lean sausages','potatoes','onion','stock','peas'],
    ingredients:[{qty:6,unit:'',item:'lean sausages'},{qty:700,unit:'g',item:'potatoes'},{qty:1,unit:'',item:'onion (sliced)'},{qty:300,unit:'ml',item:'stock'},{qty:150,unit:'g',item:'peas'}],
    steps:['Grill or pan-cook sausages.','Make onion gravy with stock.','Serve with mash and peas.']},

  {k:'dnr-caulicheese-chicken', name:'Cauli “Cheese” Bake with Shredded Chicken', cuisine:'UK', tags:['high-protein','low-ish carb','simple'], allergens:['dairy'], img:'', servings:4,
    macros:{kcal:520,p:42,c:24,f:26},
    adds:['cauliflower','light cheese sauce','shredded chicken'],
    ingredients:[{qty:1,unit:'head',item:'cauliflower (florets)'},{qty:400,unit:'g',item:'cooked shredded chicken'},{qty:300,unit:'ml',item:'light cheese sauce'}],
    steps:['Steam cauliflower.','Combine with chicken and sauce; bake 15 minutes to bubble.']}
]);

  addRecipes([
  {k:'veg-bulgur-stuffed-peppers', name:'Bulgur and Lentil Stuffed Peppers', cuisine:'Mediterranean', tags:['veg','high-fibre','budget'], allergens:['gluten (bulgur)'], img:'', servings:4,
    macros:{kcal:480,p:18,c:78,f:10},
    adds:['bulgur','lentils','peppers','tomato','herbs'],
    ingredients:[{qty:250,unit:'g',item:'cooked bulgur'},{qty:250,unit:'g',item:'cooked lentils'},{qty:4,unit:'',item:'peppers (tops off, seeded)'},{qty:200,unit:'g',item:'tomato (diced)'},{qty:2,unit:'tbsp',item:'parsley (chopped)'}],
    steps:['Mix bulgur, lentils, tomato, herbs.','Stuff peppers; bake 25 minutes.']},

  {k:'veg-squash-bean-chilli', name:'Butternut Squash and Bean Chilli', cuisine:'UK', tags:['veg','batch','gluten-free','budget'], allergens:[], img:'', servings:5,
    macros:{kcal:480,p:18,c:72,f:12},
    adds:['butternut squash','mixed beans','tomatoes','spices'],
    ingredients:[{qty:600,unit:'g',item:'butternut squash (cubes)'},{qty:2,unit:'tins',item:'mixed beans'},{qty:2,unit:'tins',item:'tomatoes'},{qty:2,unit:'tsp',item:'chilli + cumin'}],
    steps:['Roast squash.','Simmer tomatoes and spices; add beans and squash.']}
]);

  addRecipes([
  {k:'krn-gochujang-tofu-bowl', name:'Gochujang Tofu Rice Bowl', cuisine:'Korean', tags:['veg','world','high-protein'], allergens:['soy','gluten*','sesame*'], img:'', servings:3,
    macros:{kcal:540,p:28,c:72,f:14},
    adds:['tofu','gochujang','soy','rice','spring onion'],
    ingredients:[{qty:450,unit:'g',item:'firm tofu (pressed, cubed)'},{qty:1,unit:'tbsp',item:'gochujang'},{qty:2,unit:'tbsp',item:'soy sauce'},{qty:600,unit:'g',item:'cooked rice'},{qty:2,unit:'',item:'spring onions (sliced)'}],
    steps:['Crisp tofu in pan/air-fryer.','Glaze with gochujang and soy.','Serve over rice with spring onion.']},

  {k:'krn-airfry-wings-lite', name:'Air-Fried Korean-Style Wings (Light)', cuisine:'Korean', tags:['world','high-protein','quick'], allergens:['soy','gluten*','sesame*'], img:'', servings:4,
    macros:{kcal:520,p:40,c:30,f:24},
    adds:['chicken wings','cornflour','gochujang','soy','honey','garlic'],
    ingredients:[{qty:1,unit:'kg',item:'chicken wings (split)'},{qty:60,unit:'g',item:'cornflour'},{qty:2,unit:'tbsp',item:'gochujang'},{qty:2,unit:'tbsp',item:'soy sauce'},{qty:1,unit:'tbsp',item:'honey'},{qty:2,unit:'cloves',item:'garlic (minced)'}],
    steps:['Dust wings with cornflour; air-fry 24–28 minutes at 200°C, shaking.','Warm sauce; toss and air-fry 2 more minutes.']}
]);

  addRecipes([
  {k:'carib-salmon-ricepeas', name:'Jerk Salmon with Rice and Peas', cuisine:'Caribbean', tags:['world','high-protein'], allergens:['fish','soy*'], img:'', servings:3,
    macros:{kcal:620,p:40,c:72,f:18},
    adds:['salmon','jerk paste','rice','kidney beans','coconut milk'],
    ingredients:[{qty:3,unit:'',item:'salmon fillets'},{qty:2,unit:'tbsp',item:'jerk paste'},{qty:300,unit:'g',item:'rice'},{qty:1,unit:'tin',item:'kidney beans'},{qty:200,unit:'ml',item:'coconut milk (light)'}],
    steps:['Marinate salmon; bake 10–12 minutes.','Cook rice with coconut milk and beans.']},

  {k:'latam-chicken-fajita-bowl', name:'Chicken Fajita Bowl', cuisine:'Mexican/US', tags:['world','high-protein','simple'], allergens:[], img:'', servings:4,
    macros:{kcal:560,p:40,c:64,f:14},
    adds:['chicken','peppers','onions','fajita spice','rice'],
    ingredients:[{qty:700,unit:'g',item:'chicken breast (strips)'},{qty:2,unit:'',item:'peppers (sliced)'},{qty:1,unit:'',item:'onion (sliced)'},{qty:2,unit:'tsp',item:'fajita seasoning'},{qty:600,unit:'g',item:'cooked rice'}],
    steps:['Sear chicken and veg with seasoning.','Serve over rice with lime if desired.']}
]);

  addRecipes([
  {k:'soup-chicken-veg-barley', name:'Chicken, Vegetable and Barley Soup', cuisine:'UK', tags:['batch','high-fibre'], allergens:['gluten (barley)'], img:'', servings:6,
    macros:{kcal:320,p:24,c:40,f:6},
    adds:['chicken','barley','carrots','celery','stock'],
    ingredients:[{qty:400,unit:'g',item:'cooked chicken (shredded)'},{qty:120,unit:'g',item:'pearled barley'},{qty:2,unit:'',item:'carrots (diced)'},{qty:2,unit:'sticks',item:'celery (diced)'},{qty:1.5,unit:'L',item:'stock'}],
    steps:['Simmer barley and veg in stock until tender.','Stir in chicken to warm.']},

  {k:'soup-tomato-lentil', name:'Tomato and Red Lentil Soup', cuisine:'UK', tags:['veg','budget','batch','gluten-free'], allergens:[], img:'', servings:5,
    macros:{kcal:250,p:14,c:36,f:4},
    adds:['red lentils','tinned tomatoes','onion','garlic','stock'],
    ingredients:[{qty:250,unit:'g',item:'red lentils'},{qty:2,unit:'tins',item:'tomatoes'},{qty:1,unit:'',item:'onion'},{qty:2,unit:'cloves',item:'garlic'},{qty:1.2,unit:'L',item:'veg stock'}],
    steps:['Sauté onion/garlic.','Add tomatoes, stock, lentils; simmer until soft; blend if you like.']}
]);

  addRecipes([
  {k:'sea-garlic-prawns-couscous', name:'Garlic Prawns with Lemon Couscous', cuisine:'Mediterranean', tags:['high-protein','quick'], allergens:['crustacean','gluten (couscous)'], img:'', servings:2,
    macros:{kcal:520,p:34,c:66,f:12},
    adds:['prawns','garlic','couscous','lemon','parsley'],
    ingredients:[{qty:300,unit:'g',item:'prawns (raw, peeled)'},{qty:2,unit:'cloves',item:'garlic (minced)'},{qty:160,unit:'g',item:'couscous (dry)'},{qty:1,unit:'',item:'lemon'},{qty:2,unit:'tbsp',item:'parsley (chopped)'}],
    steps:['Steam couscous.','Pan-fry prawns with garlic.','Toss couscous with lemon and parsley; top with prawns.']},

  {k:'sea-mackerel-potato-salad', name:'Warm Mackerel and New Potato Salad', cuisine:'UK', tags:['omega-3','simple'], allergens:['fish'], img:'', servings:2,
    macros:{kcal:560,p:32,c:46,f:26},
    adds:['smoked mackerel','new potatoes','green beans','mustard','yoghurt*'],
    ingredients:[{qty:2,unit:'',item:'smoked mackerel fillets (flaked)'},{qty:300,unit:'g',item:'new potatoes (boiled, halved)'},{qty:150,unit:'g',item:'green beans (blanched)'},{qty:1,unit:'tsp',item:'mustard'},{qty:2,unit:'tbsp',item:'yoghurt (optional)'}],
    steps:['Combine potatoes and beans.','Fold in mackerel and dressing of yoghurt and mustard.']}
]);

  addRecipes([
  {k:'sand-chicken-pesto-mozz', name:'Chicken Pesto Mozzarella Toastie (Light)', cuisine:'UK/Italian', tags:['high-protein','simple'], allergens:['dairy','gluten (bread)','nuts*'], img:'', servings:1,
    macros:{kcal:520,p:36,c:48,f:18},
    adds:['chicken','pesto','light mozzarella','bread'],
    ingredients:[{qty:120,unit:'g',item:'cooked chicken (slices)'},{qty:1,unit:'tbsp',item:'pesto'},{qty:60,unit:'g',item:'light mozzarella (slices)'},{qty:2,unit:'slices',item:'bread'}],
    steps:['Assemble toastie with pesto, chicken, mozzarella.','Pan-toast or press until melted.']},

  {k:'wrap-tuna-harissa', name:'Tuna Harissa Crunch Wrap', cuisine:'Mediterranean', tags:['high-protein','quick','budget'], allergens:['fish','gluten (wrap)'], img:'', servings:1,
    macros:{kcal:480,p:32,c:52,f:14},
    adds:['tuna','harissa','yoghurt*','lettuce','wrap'],
    ingredients:[{qty:1,unit:'tin',item:'tuna (drained)'},{qty:1,unit:'tsp',item:'harissa'},{qty:1,unit:'tbsp',item:'yoghurt (optional)'},{qty:2,unit:'leaves',item:'lettuce'},{qty:1,unit:'',item:'wrap'}],
    steps:['Mix tuna with harissa and yoghurt.','Wrap with lettuce and serve.']}
]);

  addRecipes([
  {k:'dess-protein-mousse', name:'Chocolate Protein Mousse', cuisine:'Global', tags:['high-protein','simple'], allergens:['dairy*'], img:'', servings:2,
    macros:{kcal:260,p:24,c:18,f:8},
    adds:['high-protein yoghurt','cocoa','protein powder'],
    ingredients:[{qty:300,unit:'g',item:'high-protein yoghurt'},{qty:1,unit:'tbsp',item:'cocoa'},{qty:25,unit:'g',item:'chocolate or vanilla protein powder'}],
    steps:['Whisk all until fluffy; chill 10 minutes.']},

  {k:'dess-baked-apples-walnut', name:'Baked Apples with Walnuts and Cinnamon', cuisine:'UK', tags:['veg','high-fibre','simple'], allergens:['tree nuts'], img:'', servings:2,
    macros:{kcal:280,p:4,c:40,f:12},
    adds:['apples','walnuts','cinnamon','maple syrup*'],
    ingredients:[{qty:2,unit:'',item:'apples (cored)'},{qty:30,unit:'g',item:'walnuts (chopped)'},{qty:0.5,unit:'tsp',item:'cinnamon'},{qty:1,unit:'tsp',item:'maple syrup (optional)'}],
    steps:['Stuff apples with walnuts and cinnamon.','Bake 20 minutes at 190°C; drizzle syrup if using.']}
]);

  addRecipes([
  {k:'quick-sardine-toast', name:'Sardine Lemon Pepper Toast', cuisine:'UK', tags:['omega-3','budget','quick'], allergens:['fish','gluten (bread)'], img:'', servings:1,
    macros:{kcal:420,p:28,c:36,f:16},
    adds:['tinned sardines','wholemeal toast','lemon','pepper'],
    ingredients:[{qty:1,unit:'tin',item:'sardines (drained)'},{qty:2,unit:'slices',item:'wholemeal bread (toasted)'},{qty:1,unit:'',item:'lemon wedge'}],
    steps:['Top toast with sardines.','Squeeze lemon; pepper to taste.']},

  {k:'quick-yoghurt-savoury', name:'Savoury Yoghurt Bowl (Cucumber and Herbs)', cuisine:'UK', tags:['high-protein','quick','veg'], allergens:['dairy'], img:'', servings:1,
    macros:{kcal:220,p:20,c:16,f:8},
    adds:['thick yoghurt','cucumber','dill or mint','olive oil*'],
    ingredients:[{qty:200,unit:'g',item:'thick yoghurt'},{qty:0.25,unit:'',item:'cucumber (diced)'},{qty:1,unit:'tbsp',item:'dill or mint (chopped)'},{qty:1,unit:'tsp',item:'olive oil (optional)'}],
    steps:['Stir cucumber and herbs into yoghurt.','Drizzle a little oil if desired; salt and pepper.']}
]);
  
  
/* ============ 7) Recipe Card UI ============ */
function recipeCard(r){
  const tags = (r.tags||[]).map(t=>`<span class="badge">${t}</span>`).join(' ');
  const m = r.macros || {kcal:'—',p:'—',c:'—',f:'—'};
  const allerg = (r.allergens && r.allergens.length)
    ? `Allergens: ${r.allergens.join(', ')} (check labels)`
    : 'Allergens: none listed (check labels)';
  const imgHTML = r.img ? `<figure><img src="${r.img}" alt="${r.name}" loading="lazy" onerror="this.style.display='none'"></figure>` : '';
  return `
  <article class="card" data-tags="${(r.tags||[]).join(',')}">
    ${imgHTML}
    <div class="body">
      <h3>${r.name}</h3>
      <div>${tags} <span class="badge">${r.cuisine||''}</span></div>
      <div class="macros">
        <span>Calories: ${m.kcal}</span>
        <span>Protein: ${m.p} g</span>
        <span>Carbohydrates: ${m.c} g</span>
        <span>Fats: ${m.f} g</span>
      </div>
      <div class="allergens">${allerg}</div>
      <div class="actions" style="display:flex;gap:.5rem;flex-wrap:wrap">
        <button class="btn" data-planner="${r.k}">Add to Planner</button>
        <button class="btn" data-log="${r.k}">Log 1 Serving</button>
        <button class="btn" data-view="${r.k}">Open Recipe Card</button>
        <button class="btn" data-print="${r.k}">Print Recipe Card</button>
      </div>
    </div>
  </article>`;
}

function renderRecipes(){
  const grid = document.getElementById('recipeGrid');
  const active = [...document.querySelectorAll('.filters .tag.active')].map(x=>x.dataset.tag);
  const list = RECIPES.filter(r => active.length===0 || active.every(t=>r.tags.includes(t)));
  grid.innerHTML = list.map(recipeCard).join('');

  grid.querySelectorAll('[data-planner]').forEach(b=>b.addEventListener('click', ()=> addToPlanner(b.getAttribute('data-planner')) ));
  grid.querySelectorAll('[data-log]').forEach(b=>b.addEventListener('click', ()=> logRecipeServing(b.getAttribute('data-log'), 1) ));
  grid.querySelectorAll('[data-view]').forEach(b=>b.addEventListener('click', ()=> openRecipeCard(b.getAttribute('data-view')) ));
  grid.querySelectorAll('[data-print]').forEach(b=>b.addEventListener('click', ()=> printRecipe(b.getAttribute('data-print')) ));
}

/* Filters */
const filtersWrap = document.getElementById('recipeFilters');
if(filtersWrap){
  filtersWrap.addEventListener('click', e=>{
    if(!e.target.classList.contains('tag')) return;
    e.target.classList.toggle('active');
    renderRecipes();
  });
  filtersWrap.addEventListener('keydown', e=>{
    if(e.key==='Enter' && e.target.classList.contains('tag')) e.target.click();
  });
}

/* Pantry match */
function pantryMatch(){
  const raw = prompt('Type ingredients you have (comma-separated):\nExample: rice, chickpeas, tomatoes, onion, eggs');
  if(!raw) return;
  const have = raw.toLowerCase().split(',').map(s=>s.trim()).filter(Boolean);
  const score = (r)=>{
    const list = (r.adds||[]).concat((r.ingredients||[]).map(i=>i.item));
    let hit = 0;
    list.forEach(item=>{
      const it = String(item).toLowerCase();
      if(have.some(h => it.includes(h))) hit++;
    });
    return hit;
  };
  const ranked = RECIPES.map(r=>({r, s:score(r)})).filter(x=>x.s>0).sort((a,b)=>b.s-a.s).slice(0,18).map(x=>x.r);
  const grid = document.getElementById('recipeGrid');
  grid.innerHTML = ranked.length ? ranked.map(recipeCard).join('') : '<p class="note">No strong matches. Try broader ingredients (e.g., "beans", "rice", "eggs").</p>';
  if(ranked.length){
    grid.querySelectorAll('[data-planner]').forEach(b=>b.addEventListener('click', ()=> addToPlanner(b.getAttribute('data-planner')) ));
    grid.querySelectorAll('[data-log]').forEach(b=>b.addEventListener('click', ()=> logRecipeServing(b.getAttribute('data-log'), 1) ));
    grid.querySelectorAll('[data-view]').forEach(b=>b.addEventListener('click', ()=> openRecipeCard(b.getAttribute('data-view')) ));
    grid.querySelectorAll('[data-print]').forEach(b=>b.addEventListener('click', ()=> printRecipe(b.getAttribute('data-print')) ));
  }
}
(function addPantryButton(){
  const btn = document.createElement('button');
  btn.textContent = 'Pantry Match';
  btn.className = 'btn';
  btn.style.cssText = 'position:sticky;top:8px;margin-bottom:8px';
  const filters = document.getElementById('recipeFilters');
  if(filters){ filters.after(btn); btn.addEventListener('click', pantryMatch); }
})();

/* In-page Recipe Card dialog (uses your <dialog>) */
function openRecipeCard(k){
  const r = RECIPES.find(x=>x.k===k); if(!r) return;
  const dlg = document.getElementById('recipeModal'); if(!dlg) return;

  const s = r.servings || 1;
  const fmt = v => (typeof v!=='number') ? v : ((Math.round(v*10)/10).toString());

  document.getElementById('rm-title').textContent = r.name;
  document.getElementById('rm-meta').innerHTML =
    `<strong>Cuisine:</strong> ${r.cuisine||''} · <strong>Base servings:</strong> ${s}<br>
     <strong>Macros per serving:</strong> Calories ${r.macros.kcal} — Protein ${r.macros.p} g / Carbohydrates ${r.macros.c} g / Fats ${r.macros.f} g<br>
     <strong>Allergens:</strong> ${(r.allergens&&r.allergens.length)?r.allergens.join(', '):'none listed'} (check labels)`;

  const ul = document.getElementById('rm-ing');
  ul.innerHTML = (r.ingredients||[]).map(it=>`<li>${fmt(it.qty)} ${it.unit} ${it.item}</li>`).join('');

  const ol = document.getElementById('rm-steps');
  ol.innerHTML = (r.steps||[]).map(step=>`<li>${step}</li>`).join('');

  // shareable link ?recipe=ID
  const share = document.getElementById('rm-share');
  const url = new URL(location.href);
  url.searchParams.set('recipe', r.k);
  share.textContent = 'Card link: ' + url.toString();

  document.getElementById('rm-close').onclick = ()=> dlg.close();
  document.getElementById('rm-print').onclick = ()=> window.print();
  document.getElementById('rm-copy').onclick = async ()=>{
    try{ await navigator.clipboard.writeText(url.toString()); alert('Link copied to clipboard'); }
    catch(e){ alert('Copy failed'); }
  };

  if(typeof dlg.showModal === 'function') dlg.showModal(); else dlg.show();
}

/* Print recipe card (new window; scaled servings) */
function printRecipe(k){
  const r = RECIPES.find(x=>x.k===k); if(!r) return;
  const s = +prompt('Servings for print (default '+(r.servings||1)+'):', r.servings||1) || (r.servings||1);
  const scale = s / (r.servings||1);
  const fmtQty = v => { if(typeof v!=='number') return v; const n=Math.round(v*10)/10; return (n%1===0)? n.toString(): n.toFixed(1); };
  let adds = r.adds || [];
  if(budgetMode){
    adds = adds.map(x=>{
      const key = Object.keys(budgetSwaps).find(k=>x.toLowerCase().includes(k));
      return key ? (budgetSwaps[key] + ' (swap)') : x;
    });
  }
  const win = window.open('','PRINT','width=760,height=940'); if(!win) return;
  win.document.write(`
    <h2>${r.name}</h2>
    <p><strong>Cuisine:</strong> ${r.cuisine||''} · <strong>Servings:</strong> ${s}</p>
    <p><strong>Macros per serving (base):</strong> Calories ${r.macros.kcal} — Protein ${r.macros.p} g / Carbohydrates ${r.macros.c} g / Fats ${r.macros.f} g</p>
    <p><strong>Allergens:</strong> ${(r.allergens&&r.allergens.length)?r.allergens.join(', '):'none listed'} (check labels and cross-contamination)</p>
    <h3>Ingredients</h3>
    <ul>${(r.ingredients||[]).map(it=>`<li>${fmtQty(it.qty*scale)} ${it.unit} ${it.item}</li>`).join('')}</ul>
    <h3>Method</h3>
    <ol>${(r.steps||[]).map(s=>`<li>${s}</li>`).join('')}</ol>
    <h3>Shopping Items</h3>
    <ul>${(adds||[]).map(a=>`<li>${a}</li>`).join('')}</ul>
    <hr><p style="font-size:0.9rem;color:#555">Nutrition values are estimates. Check labels for allergens.</p>
  `);
  win.document.close(); win.focus(); win.print();
}

/* ============ 8) Planner (manual) ============ */
const WEEKDAYS = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
const MEALS = ['Breakfast','Lunch','Dinner','Snacks'];
const planKey = 'fff-plan-week';

function loadPlan(){
  try{ const raw = localStorage.getItem(planKey); if(raw) return JSON.parse(raw); }catch(e){}
  const blank = {}; WEEKDAYS.forEach(d=>{ blank[d]={}; MEALS.forEach(m=>blank[d][m]=[]); }); return blank;
}
function savePlan(p){ localStorage.setItem(planKey, JSON.stringify(p)); }

function renderPlanner(){
  const body = document.getElementById('planBody');
  const plan = loadPlan();
  body.innerHTML = WEEKDAYS.map(d=>{
    const tds = MEALS.map(m=>{
      const items = plan[d][m]||[];
      const html = items.map((it,idx)=>`
        <div class="item"><span>${it.name}</span>
          <button title="Remove" data-del="${d}|${m}|${idx}">×</button>
        </div>`).join('');
      return `<td><div class="slot">${html}</div></td>`;
    }).join('');
    return `<tr><th>${d}</th>${tds}</tr>`;
  }).join('');
  body.querySelectorAll('[data-del]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const [dd,mm,i] = btn.getAttribute('data-del').split('|');
      const plan = loadPlan();
      plan[dd][mm].splice(+i,1);
      savePlan(plan); renderPlanner();
    });
  });
}

function addToPlanner(k){
  const r = RECIPES.find(x=>x.k===k); if(!r) return;
  const day = prompt('Add to which day? (Mon/Tue/Wed/Thu/Fri/Sat/Sun)','Mon');
  if(!WEEKDAYS.includes(day)) return;
  const meal = prompt('Meal slot? (Breakfast/Lunch/Dinner/Snacks)','Dinner');
  if(!MEALS.includes(meal)) return;
  const plan = loadPlan(); plan[day][meal].push({ref:r.k, name:r.name});
  savePlan(plan); renderPlanner();
}

const clearPlanBtn = document.getElementById('clearPlan');
if(clearPlanBtn){ clearPlanBtn.addEventListener('click', ()=>{ if(confirm('Clear the whole week?')){ localStorage.removeItem(planKey); renderPlanner(); } }); }

/* Shopping list */
function aggregateList(){
  const plan = loadPlan(); const items = [];
  WEEKDAYS.forEach(d=>MEALS.forEach(m=>{
    (plan[d][m]||[]).forEach(it=>{
      const r = RECIPES.find(x=>x.k===it.ref); if(!r) return;
      let adds = [...(r.adds||[])];
      if(budgetMode){
        adds = adds.map(x=>{
          const key = Object.keys(budgetSwaps).find(k=>x.toLowerCase().includes(k));
          return key ? (budgetSwaps[key] + ' (swap)') : x;
        });
      }
      items.push(...adds);
    });
  }));
  return [...new Set(items.map(s=>s.toLowerCase()))];
}
const printListBtn = document.getElementById('printList');
if(printListBtn){ printListBtn.addEventListener('click', ()=>{
  const items = aggregateList();
  const w = window.open('','PRINT','width=600,height=700');
  if(!w) return;
  w.document.write('<h3>Shopping List</h3><ul>'+items.map(i=>'<li>'+i+'</li>').join('')+'</ul>');
  w.document.close(); w.focus(); w.print();
});}
const csvListBtn = document.getElementById('csvList');
if(csvListBtn){ csvListBtn.addEventListener('click', ()=>{
  const items = aggregateList();
  const csv = 'item\n' + items.map(x=>'"'+x.replace(/"/g,'""')+'"').join('\n');
  const blob = new Blob([csv], {type:'text/csv'}); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='shopping-list.csv'; a.click(); URL.revokeObjectURL(url);
});}

/* ============ 9) Auto 7-Day Planner (smart) ============ */
function apGuessCategory(r){
  const nm = (r.name||'').toLowerCase();
  const has = s => nm.includes(s);
  if (has('oat') || has('yoghurt') || has('parfait') || has('omelette') || (has('egg') && !has('shakshuka'))) return 'breakfast';
  if (has('wrap') || has('sandwich') || ((has('salad') || has('bowl')) && !has('rice and chicken'))) return 'lunch';
  if (has('snack') || has('parfait') || has('chia')) return 'snack';
  return 'dinner';
}
function apPoolBy(cat){ return RECIPES.filter(r => apGuessCategory(r)===cat); }
function apKcal(r){ return r?.macros?.kcal || 400; }
function apPickClosest(pool, target){
  let best=null, diff=1e9;
  pool.forEach(r=>{ const d=Math.abs(apKcal(r)-target); if(d<diff){diff=d; best=r;} });
  return best;
}
function apBuildDay(kcalTarget, currentDay){
  const shares = {breakfast:.25, lunch:.30, dinner:.35, snack:.10};
  const out = {breakfast:null,lunch:null,dinner:null,snack:null,total:0};
  ['breakfast','lunch','dinner','snack'].forEach(cat=>{
    const pool = apPoolBy(cat); if(!pool.length) return;
    const want = kcalTarget * shares[cat];
    out[cat] = currentDay?.[cat] || apPickClosest(pool, want);
  });
  out.total = ['breakfast','lunch','dinner','snack'].reduce((a,k)=> a + (out[k]?apKcal(out[k]):0),0);
  return out;
}
const AP_KEY = 'fff-aplan-v1';
let AP_PLAN = loadAP() || WEEKDAYS.map(()=>({breakfast:null,lunch:null,dinner:null,snack:null,total:0}));
function saveAP(){ localStorage.setItem(AP_KEY, JSON.stringify(AP_PLAN)); }
function loadAP(){ try{ return JSON.parse(localStorage.getItem(AP_KEY)||'null'); }catch(e){ return null; } }

const apGrid = document.getElementById('ap-grid');
function apDayTotal(day){ return ['breakfast','lunch','dinner','snack'].reduce((a,k)=> a + (day[k]?apKcal(day[k]):0),0); }
function apSlotHTML(rec,cat,dayIndex){
  if(!rec){
    const nice = cat[0].toUpperCase()+cat.slice(1);
    return `<div class="ap-slot" data-day="${dayIndex}" data-cat="${cat}">
      <div class="row"><span class="name">${nice}</span><button class="ap-swap" data-swap>Swap</button></div>
      <div class="cal">—</div>
    </div>`;
  }
  return `<div class="ap-slot" data-day="${dayIndex}" data-cat="${cat}">
    <div class="row"><span class="name">${rec.name}</span><button class="ap-swap" data-swap>Swap</button></div>
    <div class="cal">${apKcal(rec)} kcal</div>
  </div>`;
}
function apRender(){
  apGrid.innerHTML = '';
  WEEKDAYS.forEach((d,dayIdx)=>{
    const day = AP_PLAN[dayIdx] || {};
    const col = document.createElement('div');
    col.className = 'ap-day-col';
    col.innerHTML = `
      <h3>${d}</h3>
      ${apSlotHTML(day.breakfast,'breakfast',dayIdx)}
      ${apSlotHTML(day.lunch,'lunch',dayIdx)}
      ${apSlotHTML(day.dinner,'dinner',dayIdx)}
      ${apSlotHTML(day.snack,'snack',dayIdx)}
      <div class="ap-total">≈ ${Math.round(apDayTotal(day))} kcal</div>`;
    apGrid.appendChild(col);
  });
  apHookSwaps();
}
function apHookSwaps(){
  apGrid.querySelectorAll('[data-swap]').forEach(btn=>{
    btn.onclick = ()=>{
      const slot = btn.closest('.ap-slot');
      const day = parseInt(slot.dataset.day,10);
      const cat = slot.dataset.cat;
      const pool = apPoolBy(cat);
      if(!pool.length) return;
      const current = AP_PLAN[day][cat];
      let idx = current ? pool.findIndex(r=>r.k===current.k) : -1;
      for(let j=1;j<=pool.length;j++){
        const cand = pool[(idx+j)%pool.length];
        if(!current || cand.k !== current.k){ AP_PLAN[day][cat] = cand; break; }
      }
      AP_PLAN[day].total = apDayTotal(AP_PLAN[day]);
      saveAP(); apRender();
    };
  });
}
const apGen = document.getElementById('ap-generate');
if(apGen){ apGen.addEventListener('click', ()=>{
  const kcal = +document.getElementById('ap-kcal').value || 2200;
  AP_PLAN = WEEKDAYS.map((_,i)=> apBuildDay(kcal, AP_PLAN[i]) );
  saveAP(); apRender();
});}
const apClear = document.getElementById('ap-clear');
if(apClear){ apClear.addEventListener('click', ()=>{
  if(!confirm('Clear auto-plan for the whole week?')) return;
  AP_PLAN = WEEKDAYS.map(()=>({breakfast:null,lunch:null,dinner:null,snack:null,total:0}));
  saveAP(); apRender();
});}
apRender();

/* ============ 10) Daily Food Log ============ */
const logKey = 'fff-foodlog';
const dateInput = document.getElementById('logDate');
if(dateInput){ dateInput.valueAsNumber = Date.now() - (new Date()).getTimezoneOffset()*60000; }

function getLogStore(){ try{ const raw=localStorage.getItem(logKey); if(raw) return JSON.parse(raw); }catch(e){} return {}; }
function saveLogStore(s){ localStorage.setItem(logKey, JSON.stringify(s)); }
function logFor(ds){ const s=getLogStore(); return s[ds] || {items:[]}; }
function saveLog(ds,data){ const s=getLogStore(); s[ds]=data; saveLogStore(s); }
function sumDay(ds){ const data = logFor(ds); return data.items.reduce((a,x)=>({kcal:a.kcal+x.kcal,p:a.p+x.p,c:a.c+x.c,f:a.f+x.f}),{kcal:0,p:0,c:0,f:0}); }

function renderLog(){
  if(!dateInput) return;
  const ds = dateInput.value || new Date().toISOString().slice(0,10);
  const data = logFor(ds);
  const box = document.getElementById('logItems'); if(!box) return;
  if(!data.items.length){
    box.innerHTML='<p class="note">No items logged yet. Use “Log 1 Serving” on a recipe or add a custom item.</p>';
    updateLogBars(); return;
  }
  box.innerHTML = data.items.map((it,i)=>`
    <div class="slot item">
      <div><strong>${it.name}</strong> — Calories ${it.kcal} · Protein ${it.p} g · Carbohydrates ${it.c} g · Fats ${it.f} g</div>
      <button title="Remove" data-del="${i}">×</button>
    </div>`).join('');
  box.querySelectorAll('[data-del]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const ds2 = dateInput.value || new Date().toISOString().slice(0,10);
      const idx = +btn.getAttribute('data-del');
      const data2 = logFor(ds2);
      data2.items.splice(idx,1); saveLog(ds2,data2); renderLog(); updateLogBars();
    });
  });
}
function updateLogBars(){
  const ds = (dateInput && dateInput.value) || new Date().toISOString().slice(0,10);
  const t = targets || {cal:0,p:0,c:0,f:0};
  const s = sumDay(ds);
  const setTx = (id,txt)=>{ const el=document.getElementById(id); if(el) el.textContent = txt; };
  setTx('txCal',  `${s.kcal} / ${t.cal||0}`);
  setTx('txProt', `${s.p} / ${t.p||0}g`);
  setTx('txCarb', `${s.c} / ${t.c||0}g`);
  setTx('txFat',  `${s.f} / ${t.f||0}g`);
  setBar('pbCal',  pct(s.kcal, t.cal||0));
  setBar('pbProt', pct(s.p,   t.p||0));
  setBar('pbCarb', pct(s.c,   t.c||0));
  setBar('pbFat',  pct(s.f,   t.f||0));
}
const addBtn = document.getElementById('addCustom');
if(addBtn){ addBtn.addEventListener('click', ()=>{
  const name = prompt('Food name (e.g., Apple 150 g or “Custom shake”)','Custom item'); if(!name) return;
  const kcal = +prompt('Calories (kcal per entry):','150')||0;
  const p = +prompt('Protein (g):','10')||0;
  const c = +prompt('Carbohydrates (g):','25')||0;
  const f = +prompt('Fats (g):','5')||0;
  const ds = (dateInput && dateInput.value) || new Date().toISOString().slice(0,10);
  const data = logFor(ds);
  data.items.push({type:'custom', name, servings:1, kcal, p, c, f});
  saveLog(ds, data); renderLog(); updateLogBars();
});}
const clrBtn = document.getElementById('clearLog');
if(clrBtn){ clrBtn.addEventListener('click', ()=>{
  const ds = (dateInput && dateInput.value) || new Date().toISOString().slice(0,10);
  if(confirm('Clear all logged items for '+ds+'?')){ saveLog(ds,{items:[]}); renderLog(); updateLogBars(); }
});}
const expBtn = document.getElementById('exportLog');
if(expBtn){ expBtn.addEventListener('click', ()=>{
  const ds = (dateInput && dateInput.value) || new Date().toISOString().slice(0,10);
  const data = logFor(ds);
  const csv = 'name,servings,calories,protein,carbohydrates,fats\n' + data.items.map(it=>
    [it.name,it.servings,it.kcal,it.p,it.c,it.f].map(v=>'"'+String(v).replace(/"/g,'""')+'"').join(',')
  ).join('\n');
  const blob = new Blob([csv], {type:'text/csv'}); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='foodlog-'+ds+'.csv'; a.click(); URL.revokeObjectURL(url);
});}
if(dateInput){ dateInput.addEventListener('change', ()=>{ renderLog(); updateLogBars(); }); }

/* ============ 11) Boot (restore targets; render UI) ============ */
(function boot(){
  try{
    const saved = JSON.parse(localStorage.getItem('fff-targets')||'null');
    if(saved && saved.targets){
      goal = saved.goal || goal;
      targets = saved.targets;
      document.querySelectorAll('[data-goal]').forEach(x=>{
        x.setAttribute('aria-pressed', x.dataset.goal===goal ? 'true':'false');
      });
      const og=document.getElementById('outGoal'),
            oc=document.getElementById('outCals'),
            op=document.getElementById('outP'),
            ocb=document.getElementById('outC'),
            of=document.getElementById('outF');
      if(og) og.textContent = goal[0].toUpperCase()+goal.slice(1);
      if(oc) oc.textContent = targets.cal+' kilocalories / day';
      if(op) op.textContent = targets.p+' grams';
      if(ocb) ocb.textContent = targets.c+' grams';
      if(of) of.textContent = targets.f+' grams';
      lastCalc=true;
    }
  }catch(e){}
  // open ?recipe=... if present
  const rid = new URL(location.href).searchParams.get('recipe');
  if(rid){ openRecipeCard(rid); }
  renderRecipes();
  renderPlanner();
  renderLog();
  updateLogBars();
})();
</script>
