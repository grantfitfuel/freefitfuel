<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>My Personalised Workout Plan — FreeFitFuel</title>

  <link rel="stylesheet" href="style.css?v=28">

  <style>
    :root{
      --bg:#0b0f14; --ink:#e6e6ea; --inkdim:#b7b7c2;
      --glass:#0f131a; --stroke:#1f2630; --accent:#ff6a00;
      --maxw:1100px;
    }
    body{background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Arial,sans-serif}
    .wrap{max-width:var(--maxw);margin:0 auto;padding:18px 20px}
    h1{margin:.2rem 0 .6rem;font-size:1.8rem}
    .lead{color:var(--inkdim)}

    .section{background:var(--glass);border:1px solid var(--stroke);border-radius:14px;margin:14px 0;padding:14px}
    .section>h2{margin:.15rem 0 .6rem;font-size:1.2rem;color:var(--accent)}
    .block{background:#111418;border:1px solid var(--stroke);border-radius:12px;padding:12px;margin:.7rem 0}

    .days{display:grid;gap:12px}
    @media (min-width:780px){ .days{grid-template-columns:repeat(2,1fr)} }

    .mov{border:1px dashed var(--stroke);border-radius:10px;padding:.55rem .6rem;margin:.45rem 0}
    .mov-head{display:flex;gap:.6rem;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .mov-title a{color:var(--ink);text-decoration:underline dotted}
    .mov-title a:hover{color:var(--accent)}
    .rx{opacity:.9}
    .mov-tools{display:flex;gap:.4rem;align-items:center}
    .btn-sm{border:1px solid var(--stroke);background:var(--glass);color:var(--ink);padding:.35rem .6rem;border-radius:8px;cursor:pointer}

    .drawer{display:none;margin:.45rem 0 0}
    .drawer.open{display:block}
    .log-grid{display:grid;gap:.35rem}
    .log-row{display:grid;grid-template-columns:72px 1fr 1fr 1fr auto;gap:.35rem;align-items:center}
    .log-row input{background:#0b0f14;border:1px solid var(--stroke);border-radius:8px;color:var(--ink);padding:.38rem .45rem}
    .meta-row{display:flex;flex-wrap:wrap;gap:.5rem;align-items:center;margin-top:.35rem}
    .pb{color:#90ee90}
    .badge{border:1px solid var(--accent);
      border-radius:999px;
      padding:.15rem .55rem;
      background:rgba(255,106,0,.15);
      color:var(--accent);
      font-size:.8rem;
      font-weight:600;
      margin-left:.4rem;}
    .quote{font-size:.92rem;color:var(--inkdim);margin-top:.25rem}

    .restbar{display:flex;align-items:center;gap:.4rem;margin:.45rem 0 .1rem;flex-wrap:wrap}
    .restbar .left{opacity:.9;min-width:44px}
    .restbar input[type="number"]{width:84px;background:#0b0f14;border:1px solid var(--stroke);border-radius:8px;color:var(--ink);padding:.34rem .45rem}

    @media (max-width:520px){
      .log-row{grid-template-columns:60px 1fr 1fr; grid-auto-rows:auto}
      .log-row input[placeholder="kg"]{grid-column:1 / span 1}
      .log-row input[placeholder="reps"]{grid-column:2 / span 1}
      .log-row input[placeholder="notes"]{grid-column:1 / span 2}
    }

    .grid{display:grid;gap:.6rem}
    .log-grid-compact{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:.6rem}
    label{display:flex;align-items:center;gap:.5rem}
    input[type="checkbox"]{accent-color:var(--accent)}
    input[type="number"], input[type="text"]{
      background:#0c1118;border:1px solid var(--stroke);border-radius:8px;color:var(--ink);padding:.4rem .5rem;width:100%;
    }
    .warn{background:#23140f;border:1px solid #3a2016;color:#ffb89a;padding:.55rem .6rem;border-radius:8px}
    .ok{background:#142316;border:1px solid #203a23;color:#b9ffb9;padding:.55rem .6rem;border-radius:8px}

    /* Accordion */
    .accordion{border:1px solid var(--stroke); border-radius:12px; background:#111418; padding:12px; margin-bottom:1rem}
    .acc-head{display:flex; align-items:center; justify-content:space-between; gap:.75rem; cursor:pointer}
    .acc-toggle{all:unset; cursor:pointer; color:var(--accent); font-size:1.05rem}
    .accordion .acc-toggle::after{content:"▸"; margin-left:.45rem; opacity:.8}
    .accordion.open .acc-toggle::after{content:"▾"; margin-left:.45rem; opacity:.8}
    .acc-body{margin-top:.5rem}
    [hidden]{display:none !important;}

    .alt-chips{display:flex;flex-wrap:wrap;gap:.35rem;margin-top:.25rem}
    .alt-chip{border:1px solid var(--stroke);border-radius:999px;padding:.15rem .55rem;
      background:rgba(255,255,255,.06);font-size:.85rem}
  </style>
</head>
<body>
  <div id="site-header"></div>
  <script src="/js/header-loader.js" defer></script>
  <div class="wrap">
    <h1>My Workout Plan</h1>
    <p class="lead">Client-side only. Your plan, logs, PBs and checks stay in this browser.</p>

    <section class="section">
      <h2>Daily Wellness Check</h2>
      <div class="log-grid-compact">
        <label><input type="checkbox" id="hydrDone"> Hydration hit</label>
        <label><input type="checkbox" id="sleepDone"> Sleep goal met</label>
        <label><input type="checkbox" id="macroDone"> Macros on target</label>
        <label>
          <input type="checkbox" id="activityCardio" aria-label="Did you walk, cycle or run today?">
          Walk / Bike / Run
        </label>
      </div>
      <p class="quote">Consistency across training, nutrition, sleep & stress = success.</p>
    </section>

    <section class="section">
      <h2>Your Personalised Plan</h2>
      <div id="plan"></div>
      <p id="planMsg" class="meta"></p>
    </section>

    <section class="section">
      <h2>Backup / Reset</h2>
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr))">
        <button class="btn-sm" id="btnExport">Export all workout data (.json)</button>
        <label class="btn-sm" for="importFile" style="cursor:pointer;display:inline-flex;align-items:center;justify-content:center">Import data</label>
        <input id="importFile" type="file" accept="application/json" style="display:none">
        <button class="btn-sm" id="btnReset">Reset (PBs + wellness only)</button>
      </div>
      <p class="meta">Roadmap is read from <code>localStorage["fff.roadmap.plan.v1"]</code>.</p>
    </section>

    <footer class="site-footer">
      <div class="container">
        <img src="img/freefitfuel-logo.svg" alt="FreeFitFuel Logo" height="64">
        <p>&copy; 2025 FreeFitFuel™ · All rights reserved.</p>
        <p class="credit">Created by Grant Cameron Anthony</p>
      </div>
    </footer>
  </div>

<script>
const ROADMAP_KEY   = 'fff.roadmap.plan.v1';
const NS_PB         = 'fff.workoutplan.pb.';
const NS_CHECK      = 'fff.workoutplan.check.';

/* Accordion all closed */
function setupAccordions(){
  document.querySelectorAll('.accordion').forEach(acc=>{
    const btn=acc.querySelector('.acc-toggle');
    const body=acc.querySelector('.acc-body');
    acc.classList.remove('open');btn.setAttribute('aria-expanded','false');body.hidden=true;
    btn.addEventListener('click',()=>{
      const isOpen=acc.classList.contains('open');
      acc.classList.toggle('open',!isOpen);
      btn.setAttribute('aria-expanded',!isOpen?'true':'false');
      body.hidden=isOpen;
    });
  });
}

function yt(q){return 'https://www.youtube.com/results?search_query='+encodeURIComponent(q+' form');}
function pick(arr){return arr[Math.floor(Math.random()*arr.length)];}
const QUOTES=["Small wins compound. Log the set, own the day.","Perfect form, steady breath, then add a little.","Consistency beats intensity when intensity is inconsistent.","One clean rep beats five messy ones.","Show up. Scale smart. Keep going."];

function restControlsHTML(id){
  return `<div class="restbar" data-rest="${id}" data-bound="0">
    <span>⏱ Rest:</span>
    <input type="number" min="5" step="5" value="90" aria-label="Rest seconds">
    <button class="btn-sm" data-act="rest-start">Start</button>
    <button class="btn-sm" data-act="rest-stop">Stop</button>
    <span class="left" aria-live="polite">90s</span>
  </div>`;
}

function hookRestTimers(scope){
  scope.querySelectorAll('.restbar').forEach(bar=>{
    if(bar.dataset.bound==='1')return;bar.dataset.bound='1';
    const input=bar.querySelector('input[type="number"]');
    const left=bar.querySelector('.left');
    const start=bar.querySelector('[data-act="rest-start"]');
    const stop=bar.querySelector('[data-act="rest-stop"]');
    let t=null;
    const fmt=s=>{s=Math.max(0,Math.floor(Number(s)||0));const m=Math.floor(s/60),r=s%60;return m?`${m}:${String(r).padStart(2,'0')}`:`${r}s`;};
    const show=s=>left.textContent=fmt(s);
    show(parseInt(input?.value||'0',10));
    start?.addEventListener('click',()=>{
      let total=Math.max(5,parseInt(input?.value||'0',10)||0);
      clearInterval(t);let remain=total;show(remain);
      t=setInterval(()=>{remain--;show(remain);if(remain<=0){clearInterval(t);left.textContent='Go!';}},1000);
    });
    stop?.addEventListener('click',()=>{clearInterval(t);show(parseInt(input?.value||'0',10));});
  });
}

/* Render Plan */
function renderPlan(){
  const wrap=document.getElementById('plan');const msg=document.getElementById('planMsg');
  let raw=localStorage.getItem(ROADMAP_KEY);if(!raw){wrap.innerHTML=`<div class="warn">No roadmap found.</div>`;return;}
  let data;try{data=JSON.parse(raw);}catch{wrap.innerHTML=`<div class="warn">Unreadable roadmap.</div>`;return;}
  const stages=data.stages||[];if(!stages.length){wrap.innerHTML=`<div class="warn">Empty roadmap.</div>`;return;}

  let html='';stages.forEach((stage,si)=>{
    html+=`<div class="accordion"><div class="acc-head"><button class="acc-toggle" aria-expanded="false">${stage.name||`Stage ${si+1}`}</button></div><div class="acc-body" hidden>`;
    html+=`<div class="days">`;
    (stage.programByDay||[]).forEach((day,di)=>{
      const label=(stage.split||['Mon','Tue','Wed','Thu','Fri','Sat','Sun'])[di];
      html+=`<div class="mov"><div class="mov-head"><div class="mov-title"><strong>${label}</strong></div></div>`;
      (day||[]).forEach((it,ei)=>{
        const presc=(it.type==='cardio')
          ? [it.duration_min?`${it.duration_min} min`:null,it.work_s?`work ${it.work_s}s`:null,it.rest_s?`rest ${it.rest_s}s`:null,it.rounds?`${it.rounds} rounds`:null].filter(Boolean).join(' · ')
          : `${it.sets||'—'}×${it.reps||'—'} · ${it.rir||'—'} RIR · ${it.rest||60}s rest`;
        html+=`<div class="mov"><div class="mov-head"><div class="mov-title">
          <a href="${yt(it.name)}" target="_blank">${it.name}</a>
          ${it.type && it.type!=='cardio' ? `<span class="badge">${it.type}</span>`:''}
        </div><div class="rx">${presc}</div><div class="mov-tools"><button class="btn-sm" data-open>Log</button></div></div>`;
        if(it.cue)html+=`<p class="meta">${it.cue}</p>`;
        if(it.alts)html+=`<div class="alt-chips">${it.alts.map(alt=>`<a class="alt-chip" href="${yt(alt)}" target="_blank">${alt}</a>`).join('')}</div>`;
        html+=`<div class="drawer" data-drawer><div class="log-grid">${[1,2,3,4,5].map(i=>
          `<div class="log-row"><strong>Set ${i}</strong><input placeholder="kg" data-field="w${i}"><input placeholder="reps" data-field="r${i}"><input placeholder="notes" data-field="n${i}"><button class="btn-sm" data-save>Save</button></div>${it.type==='cardio'?'':restControlsHTML('s'+si+'d'+di+'e'+ei+'.s'+i)}`).join('')}</div>
          <div class="meta-row"><span class="pb" data-pb></span><span class="badge" data-badge></span></div><div class="quote" data-quote></div></div></div>`;
      });
      html+=`</div>`;
    });
    html+=`</div></div></div>`;
  });
  wrap.innerHTML=html;setupAccordions();
}

renderPlan();
</script>
</body>
</html>
